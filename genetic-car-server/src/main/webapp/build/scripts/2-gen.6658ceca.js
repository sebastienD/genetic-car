"use strict";function extend(a,b){for(var c in b)a[c]=b[c]}function isInstanceOf(a,b){for(;"object"==typeof a;){if(a.constructor===b)return!0;a=a._super}return!1}!function(){angular.module("gen",["gen.config","gen.resources","gen.home","ui.router","ngSanitize"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("home")}]).run(["$log","$rootScope","$state",function(a,b,c){b.$on("$stateChangeStart",function(b,c,d){a.debug("state should change to state "+c.name)}),b.$on("$stateChangeSuccess",function(b,c,d,e){a.debug("state change with success from "+e.name+" to state "+c.name)})}])}(),angular.module("gen.resources",["gen.config","ngResource"]).factory("SimulationResource",["$resource","config",function(a,b){return a(b.SIMULATION_PATH+"/champions/:team",{},{getAllChampions:{method:"GET",isArray:!0},getChampionForTeam:{method:"GET",isArray:!1}})}]),angular.module("gen.config",[]).config(["$provide",function(a){a.constant("config",{SIMULATION_PATH:"/simulation"})}]),angular.module("gen.car.directives",["gen.car.service","gen.floor.service"]).directive("car",["CarService","FloorService","$interval",function(a,b,c){function d(c){var d=new b2World(o,p),e=b.createFloor(q,d),f=a.createCar(c,o,d);return{world:d,carFilled:f,camera_y:0,camera_x:0,last_drawn_tile:0,floorTiles:e}}function e(a){return a.world.Step(1/m,20,20),a.carFilled.frames++,a.carFilled.checkDeath()?"stop":void 0}function f(a,b){var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height),c.save(),g(a),c.translate(150-a.camera_x*s,120+a.camera_y*s),c.scale(s,-s),h(a,c),j(a,c),c.restore()}function g(a){var b=a.carFilled.getPosition(),c=a.camera_y-b.y,d=a.camera_x-b.x;a.camera_y-=r*c,a.camera_x-=r*d}function h(a,b){b.strokeStyle="#000",b.fillStyle="#666",b.lineWidth=1/s,b.beginPath();a:for(var c=Math.max(0,a.last_drawn_tile-20);c<a.floorTiles.length;c++)for(var d=a.floorTiles[c],e=d.GetFixtureList();e;e=e.m_next){var f=e.GetShape(),g=d.GetWorldPoint(f.m_vertices[0]).x;if(g>a.camera_x-5&&g<a.camera_x+10&&i(d,f.m_vertices,f.m_vertexCount,b),g>a.camera_x+10){a.last_drawn_tile=c;break a}}b.fill(),b.stroke()}function i(a,b,c,d){var e=a.GetWorldPoint(b[0]);d.moveTo(e.x,e.y);for(var f=1;c>f;f++){var g=a.GetWorldPoint(b[f]);d.lineTo(g.x,g.y)}d.lineTo(e.x,e.y)}function j(a,b){if(a.carFilled.alive){var c=a.carFilled.getPosition();if(!(c.x<a.camera_x-5)){b.strokeStyle="#444",b.lineWidth=1/s;for(var d=0;d<a.carFilled.wheels.length;d++)for(var e=a.carFilled.wheels[d],f=e.GetFixtureList();f;f=f.m_next){var g=f.GetShape(),h=Math.round(255-255*(f.m_density-u)/t).toString(),j="rgb("+h+","+h+","+h+")";l(e,g.m_p,g.m_radius,e.m_sweep.a,j,b)}var m=Math.round(100-70*((a.carFilled.car_def.chassis_density-v)/w)).toString()+"%";b.strokeStyle="#c44";var n=a.carFilled.car_def.team;b.fillStyle=k(n,m),b.beginPath();for(var e=a.carFilled.chassis,f=e.GetFixtureList();f;f=f.m_next){var g=f.GetShape();i(e,g.m_vertices,g.m_vertexCount,b)}b.fill(),b.stroke()}}}function k(a,b){var c;return c="BLUE"==a?"hsl(207,90%,"+b+")":"RED"==a?"hsl(4,90%,"+b+")":"GREEN"==a?"hsl(122,39%,"+b+")":"ORANGE"==a?"hsl(36,100%,"+b+")":"YELLOW"==a?"hsl(54,100%,"+b+")":"PURPLE"==a?"hsl(291,64%,"+b+")":"hsl(0,50%,"+b+")"}function l(a,b,c,d,e,f){var g=a.GetWorldPoint(b);f.fillStyle=e,f.beginPath(),f.arc(g.x,g.y,c,0,2*Math.PI,!0),f.moveTo(g.x,g.y),f.lineTo(g.x+c*Math.cos(d),g.y+c*Math.sin(d)),f.fill(),f.stroke()}var m=60,n=60,o=new b2Vec2(0,-9.81),p=!0,q=Math.seedrandom(),r=.05,s=70,t=100,u=40,v=30,w=300;return{restrict:"A",scope:{champion:"=champion"},link:function(b,g){var h=a.createCarDef(b.champion.carScore.car,b.champion.statistic.team),i=d(h),j=c(function(){var a=e(i);"stop"===a&&(b.stop=!0)},Math.round(1e3/m)),k=c(function(){f(i,g[0])},Math.round(1e3/n));b.$watch("stop",function(a,b){a&&(c.cancel(j),c.cancel(k))}),g.on("$destroy",function(){c.cancel(j),c.cancel(k),i.carFilled.kill()})}}}]),angular.module("gen.car.service",[]).service("CarService",["$q",function(a){function b(a,b,d){var e=new b2BodyDef;e.type=b2Body.b2_dynamicBody,e.position.Set(0,4);var f=d.CreateBody(e);return c(f,a[0],a[1],b),c(f,a[1],a[2],b),c(f,a[2],a[3],b),c(f,a[3],a[4],b),c(f,a[4],a[5],b),c(f,a[5],a[6],b),c(f,a[6],a[7],b),c(f,a[7],a[0],b),f.vertex_list=a,f}function c(a,b,c,d){var e=[];e.push(b),e.push(c),e.push(b2Vec2.Make(0,0));var f=new b2FixtureDef;f.shape=new b2PolygonShape,f.density=d,f.friction=10,f.restitution=.2,f.filter.groupIndex=-1,f.shape.SetAsArray(e,3),a.CreateFixture(f)}function d(a,b,c){var d=new b2BodyDef;d.type=b2Body.b2_dynamicBody,d.position.Set(0,0);var e=c.CreateBody(d),f=new b2FixtureDef;return f.shape=new b2CircleShape(a),f.density=b,f.friction=1,f.restitution=.2,f.filter.groupIndex=-1,e.CreateFixture(f),e}var e=0,f=60,g=10*f,h={};return h.createCarDef=function(a,b){var c={};return c.team=b,c.wheelCount=2,c.wheel_radius=[],c.wheel_density=[],c.wheel_vertex=[],c.wheel_radius[0]=a.wheel1.radius,c.wheel_density[0]=a.wheel1.density,c.wheel_vertex[0]=a.wheel1.vertex,c.wheel_radius[1]=a.wheel2.radius,c.wheel_density[1]=a.wheel2.density,c.wheel_vertex[1]=a.wheel2.vertex,c.chassis_density=a.chassi.densite,c.vertex_list=[],c.vertex_list.push(new b2Vec2(a.chassi.vecteurs[0],0)),c.vertex_list.push(new b2Vec2(a.chassi.vecteurs[2],a.chassi.vecteurs[3])),c.vertex_list.push(new b2Vec2(0,a.chassi.vecteurs[5])),c.vertex_list.push(new b2Vec2(a.chassi.vecteurs[6],a.chassi.vecteurs[7])),c.vertex_list.push(new b2Vec2(a.chassi.vecteurs[8],0)),c.vertex_list.push(new b2Vec2(a.chassi.vecteurs[10],a.chassi.vecteurs[11])),c.vertex_list.push(new b2Vec2(0,a.chassi.vecteurs[13])),c.vertex_list.push(new b2Vec2(a.chassi.vecteurs[14],a.chassi.vecteurs[15])),c},h.resetCar=function(a){a.health=g,a.maxPosition=0,a.maxPositiony=0,a.minPositiony=0,a.frames=0,a.alive=!0},h.createCar=function(a,c,f){var h={};h.health=g,h.maxPosition=0,h.maxPositiony=0,h.minPositiony=0,h.frames=0,h.car_def=a,h.alive=!0,h.chassis=b(a.vertex_list,a.chassis_density,f),h.wheels=[];for(var i=0;i<a.wheelCount;i++)h.wheels[i]=d(a.wheel_radius[i],a.wheel_density[i],f);for(var j=h.chassis.GetMass(),i=0;i<a.wheelCount;i++)j+=h.wheels[i].GetMass();for(var k=[],i=0;i<a.wheelCount;i++)k[i]=j*-c.y/a.wheel_radius[i];for(var l=new b2RevoluteJointDef,i=0;i<a.wheelCount;i++){var m=h.chassis.vertex_list[a.wheel_vertex[i]];l.localAnchorA.Set(m.x,m.y),l.localAnchorB.Set(0,0),l.maxMotorTorque=k[i],l.motorSpeed=-e,l.enableMotor=!0,l.bodyA=h.chassis,l.bodyB=h.wheels[i],f.CreateJoint(l)}return h.getPosition=function(){return h.chassis.GetPosition()},h.kill=function(){f.DestroyBody(h.chassis);for(var a=0;a<h.wheels.length;a++)f.DestroyBody(h.wheels[a])},h.checkDeath=function(){var a=h.getPosition();if(a.y>h.maxPositiony&&(h.maxPositiony=a.y),a.y<h.minPositiony&&(h.minPositiony=a.y),a.x>h.maxPosition+.02)h.health=g,h.maxPosition=a.x;else if(a.x>h.maxPosition&&(h.maxPosition=a.x),Math.abs(h.chassis.GetLinearVelocity().x)<.001&&(h.health-=5),h.health--,h.health<=0)return!0},h},h}]),angular.module("gen.floor.service",[]).service("FloorService",["$q",function(a){function b(a,b,d){var g=new b2BodyDef;g.position.Set(a.x,a.y);var h=d.CreateBody(g),i=new b2FixtureDef;i.shape=new b2PolygonShape,i.friction=.5;var j=[];j.push(new b2Vec2(0,0)),j.push(new b2Vec2(0,-f)),j.push(new b2Vec2(e,-f)),j.push(new b2Vec2(e,0));var k=new b2Vec2(0,0),l=c(j,k,b);return i.shape.SetAsArray(l),h.CreateFixture(i),h}function c(a,b,c){for(var d=[],e=0;e<a.length;e++){var f={};f.x=Math.cos(c)*(a[e].x-b.x)-Math.sin(c)*(a[e].y-b.y)+b.x,f.y=Math.sin(c)*(a[e].x-b.x)+Math.cos(c)*(a[e].y-b.y)+b.y,d.push(f)}return d}var d=200,e=1.5,f=.15,g={};return g.createFloor=function(a,c){var e=null,f=new b2Vec2(-5,0),g=[];Math.seedrandom(a);for(var h=0;d>h;h++){e=b(f,1.5*(3*Math.random()-1.5)*h/d,c),g.push(e);var i=e.GetFixtureList(),j=e.GetWorldPoint(i.GetShape().m_vertices[3]);f=j}return g},g}]),angular.module("gen.home",["ui.router","gen.home.service","gen.car.directives"]).config(["$stateProvider",function(a){a.state("home",{url:"/home",templateUrl:"scripts/app/home/home-tpl.html",controller:"HomeController"})}]).controller("HomeController",["$scope","ChampionsService",function(a,b){function c(){a.champions=[],b.connect()}function d(){a.champions=[],b.disconnect()}c(),a.connect=c,a.disconnect=d,b.receive().then(null,null,function(b){_.remove(a.champions,function(a){return a.statistic.team==b.champion.statistic.team}),a.champions.push(b.champion)}),a.$on("$destroy",function(){b.disconnect()})}]),angular.module("gen.home.service",[]).service("ChampionsService",["$q","$log",function(a,b){var c={},d=a.defer(),e={client:null,stomp:null},f=[],g=9e3==location.port?"//localhost:8080":"";c.SOCKET_URL=g+"/status/champions",c.CHAMPIONS_TOPIC="/topic/champions",c.CHAMPIONS_BROKER="/app/status/champions",c.receive=function(){return d.promise},c.send=function(a){var b=Math.floor(1e6*Math.random());e.stomp.send(c.CHAMPIONS_BROKER,{priority:9},JSON.stringify({message:a,id:b})),f.push(b)};var h=function(){b.info("close websocket")},i=function(a){var b=JSON.parse(a),c={champion:b};return _.some(f,c.id)&&(c.self=!0,f=_.remove(f,c.id)),c},j=function(a){e.stomp.subscribe(c.CHAMPIONS_TOPIC,function(a){d.notify(i(a.body))})};return c.connect=function(){e.client||(e.client=new SockJS(c.SOCKET_URL),e.stomp=Stomp.over(e.client),e.stomp.connect({},j),e.stomp.onclose=h)},c.disconnect=function(){e.stomp&&(e.stomp.disconnect(),e={client:null,stomp:null})},c}]);var b2BoundValues=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){this.lowerValues=new Array,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Array,this.upperValues[0]=0,this.upperValues[1]=0},b2BoundValues.prototype.__varz=function(){},b2BoundValues.prototype.lowerValues=null,b2BoundValues.prototype.upperValues=null;var b2PairManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PairManager.prototype.__constructor=function(){this.m_pairs=new Array,this.m_pairBuffer=new Array,this.m_pairCount=0,this.m_pairBufferCount=0,this.m_freePair=null},b2PairManager.prototype.__varz=function(){},b2PairManager.prototype.AddPair=function(a,b){var c=a.pairs[b];return null!=c?c:(null==this.m_freePair&&(this.m_freePair=new b2Pair,this.m_pairs.push(this.m_freePair)),c=this.m_freePair,this.m_freePair=c.next,c.proxy1=a,c.proxy2=b,c.status=0,c.userData=null,c.next=null,a.pairs[b]=c,b.pairs[a]=c,++this.m_pairCount,c)},b2PairManager.prototype.RemovePair=function(a,b){var c=a.pairs[b];if(null==c)return null;var d=c.userData;return delete a.pairs[b],delete b.pairs[a],c.next=this.m_freePair,c.proxy1=null,c.proxy2=null,c.userData=null,c.status=0,this.m_freePair=c,--this.m_pairCount,d},b2PairManager.prototype.Find=function(a,b){return a.pairs[b]},b2PairManager.prototype.ValidateBuffer=function(){},b2PairManager.prototype.ValidateTable=function(){},b2PairManager.prototype.Initialize=function(a){this.m_broadPhase=a},b2PairManager.prototype.AddBufferedPair=function(a,b){var c=this.AddPair(a,b);0==c.IsBuffered()&&(c.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=c,++this.m_pairBufferCount),c.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},b2PairManager.prototype.RemoveBufferedPair=function(a,b){var c=this.Find(a,b);null!=c&&(0==c.IsBuffered()&&(c.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=c,++this.m_pairBufferCount),c.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},b2PairManager.prototype.Commit=function(a){var b=0;for(b=0;b<this.m_pairBufferCount;++b){var c=this.m_pairBuffer[b];c.ClearBuffered();var d=c.proxy1,e=c.proxy2;c.IsRemoved()||0==c.IsFinal()&&a(d.userData,e.userData)}this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},b2PairManager.prototype.m_broadPhase=null,b2PairManager.prototype.m_pairs=null,b2PairManager.prototype.m_freePair=null,b2PairManager.prototype.m_pairCount=0,b2PairManager.prototype.m_pairBuffer=null,b2PairManager.prototype.m_pairBufferCount=0;var b2TimeStep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeStep.prototype.__constructor=function(){},b2TimeStep.prototype.__varz=function(){},b2TimeStep.prototype.Set=function(a){this.dt=a.dt,this.inv_dt=a.inv_dt,this.positionIterations=a.positionIterations,this.velocityIterations=a.velocityIterations,this.warmStarting=a.warmStarting},b2TimeStep.prototype.dt=null,b2TimeStep.prototype.inv_dt=null,b2TimeStep.prototype.dtRatio=null,b2TimeStep.prototype.velocityIterations=0,b2TimeStep.prototype.positionIterations=0,b2TimeStep.prototype.warmStarting=null;var b2Controller=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Controller.prototype.__constructor=function(){},b2Controller.prototype.__varz=function(){},b2Controller.prototype.Step=function(a){},b2Controller.prototype.Draw=function(a){},b2Controller.prototype.AddBody=function(a){var b=new b2ControllerEdge;b.controller=this,b.body=a,b.nextBody=m_bodyList,b.prevBody=null,m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},b2Controller.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),m_bodyList==b&&(m_bodyList=b.nextBody),a.m_controllerList==b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,m_bodyCount--},b2Controller.prototype.Clear=function(){for(;m_bodyList;)this.RemoveBody(m_bodyList.body)},b2Controller.prototype.GetNext=function(){return this.m_next},b2Controller.prototype.GetWorld=function(){return this.m_world},b2Controller.prototype.GetBodyList=function(){return m_bodyList},b2Controller.prototype.m_next=null,b2Controller.prototype.m_prev=null,b2Controller.prototype.m_world=null;var b2GravityController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GravityController.prototype,b2Controller.prototype),b2GravityController.prototype._super=b2Controller.prototype,b2GravityController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2GravityController.prototype.__varz=function(){},b2GravityController.prototype.Step=function(a){var b=null,c=null,d=null,e=0,f=null,g=null,h=null,i=0,j=0,k=0,l=null;if(this.invSqr)for(b=m_bodyList;b;b=b.nextBody)for(c=b.body,d=c.GetWorldCenter(),e=c.GetMass(),f=m_bodyList;f!=b;f=f.nextBody)g=f.body,h=g.GetWorldCenter(),i=h.x-d.x,j=h.y-d.y,k=i*i+j*j,k<Number.MIN_VALUE||(l=new b2Vec2(i,j),l.Multiply(this.G/k/Math.sqrt(k)*e*g.GetMass()),c.IsAwake()&&c.ApplyForce(l,d),l.Multiply(-1),g.IsAwake()&&g.ApplyForce(l,h));else for(b=m_bodyList;b;b=b.nextBody)for(c=b.body,d=c.GetWorldCenter(),e=c.GetMass(),f=m_bodyList;f!=b;f=f.nextBody)g=f.body,h=g.GetWorldCenter(),i=h.x-d.x,j=h.y-d.y,k=i*i+j*j,k<Number.MIN_VALUE||(l=new b2Vec2(i,j),l.Multiply(this.G/k*e*g.GetMass()),c.IsAwake()&&c.ApplyForce(l,d),l.Multiply(-1),g.IsAwake()&&g.ApplyForce(l,h))},b2GravityController.prototype.G=1,b2GravityController.prototype.invSqr=!0;var b2DestructionListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){},b2DestructionListener.prototype.__varz=function(){},b2DestructionListener.prototype.SayGoodbyeJoint=function(a){},b2DestructionListener.prototype.SayGoodbyeFixture=function(a){};var b2ContactEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactEdge.prototype.__constructor=function(){},b2ContactEdge.prototype.__varz=function(){},b2ContactEdge.prototype.other=null,b2ContactEdge.prototype.contact=null,b2ContactEdge.prototype.prev=null,b2ContactEdge.prototype.next=null;var b2EdgeChainDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2EdgeChainDef.prototype.__constructor=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},b2EdgeChainDef.prototype.__varz=function(){},b2EdgeChainDef.prototype.vertices=null,b2EdgeChainDef.prototype.vertexCount=null,b2EdgeChainDef.prototype.isALoop=null;var b2Vec2=function(a,b){2==arguments.length&&(this.x=a,this.y=b)};b2Vec2.Make=function(a,b){return new b2Vec2(a,b)},b2Vec2.prototype.SetZero=function(){this.x=0,this.y=0},b2Vec2.prototype.Set=function(a,b){this.x=a,this.y=b},b2Vec2.prototype.SetV=function(a){this.x=a.x,this.y=a.y},b2Vec2.prototype.GetNegative=function(){return new b2Vec2(-this.x,-this.y)},b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)},b2Vec2.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},b2Vec2.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},b2Vec2.prototype.Multiply=function(a){this.x*=a,this.y*=a},b2Vec2.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y},b2Vec2.prototype.MulTM=function(a){var b=b2Math.Dot(this,a.col1);this.y=b2Math.Dot(this,a.col2),this.x=b},b2Vec2.prototype.CrossVF=function(a){var b=this.x;this.x=a*this.y,this.y=-a*b},b2Vec2.prototype.CrossFV=function(a){var b=this.x;this.x=-a*this.y,this.y=a*b},b2Vec2.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y},b2Vec2.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y},b2Vec2.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},b2Vec2.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},b2Vec2.prototype.IsValid=function(){return b2Math.IsValid(this.x)&&b2Math.IsValid(this.y)},b2Vec2.prototype.x=0,b2Vec2.prototype.y=0;var b2Vec3=function(a,b,c){3==arguments.length&&(this.x=a,this.y=b,this.z=c)};b2Vec3.prototype.SetZero=function(){this.x=this.y=this.z=0},b2Vec3.prototype.Set=function(a,b,c){this.x=a,this.y=b,this.z=c},b2Vec3.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},b2Vec3.prototype.GetNegative=function(){return new b2Vec3(-this.x,-this.y,-this.z)},b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b2Vec3.prototype.Copy=function(){return new b2Vec3(this.x,this.y,this.z)},b2Vec3.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},b2Vec3.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},b2Vec3.prototype.Multiply=function(a){this.x*=a,this.y*=a,this.z*=a},b2Vec3.prototype.x=0,b2Vec3.prototype.y=0,b2Vec3.prototype.z=0;var b2DistanceProxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceProxy.prototype.__constructor=function(){},b2DistanceProxy.prototype.__varz=function(){},b2DistanceProxy.prototype.Set=function(a){switch(a.GetType()){case b2Shape.e_circleShape:var b=a;this.m_vertices=new Array(1),this.m_vertices[0]=b.m_p,this.m_count=1,this.m_radius=b.m_radius;break;case b2Shape.e_polygonShape:var c=a;this.m_vertices=c.m_vertices,this.m_count=c.m_vertexCount,this.m_radius=c.m_radius;break;default:b2Settings.b2Assert(!1)}},b2DistanceProxy.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},b2DistanceProxy.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},b2DistanceProxy.prototype.GetVertex=function(a){return b2Settings.b2Assert(a>=0&&a<this.m_count),this.m_vertices[a]},b2DistanceProxy.prototype.m_vertices=null,b2DistanceProxy.prototype.m_count=0,b2DistanceProxy.prototype.m_radius=null;var b2ContactFactory=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFactory.prototype.__constructor=function(){},b2ContactFactory.prototype.__varz=function(){this.InitializeRegisters()},b2ContactFactory.prototype.AddType=function(a,b,c,d){this.m_registers[c][d].createFcn=a,this.m_registers[c][d].destroyFcn=b,this.m_registers[c][d].primary=!0,c!=d&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Array(b2Shape.e_shapeTypeCount);for(var a=0;a<b2Shape.e_shapeTypeCount;a++){this.m_registers[a]=new Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++)this.m_registers[a][b]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),this.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,b2Shape.e_edgeShape,b2Shape.e_circleShape),this.AddType(b2PolyAndEdgeContact.Create,b2PolyAndEdgeContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_edgeShape)},b2ContactFactory.prototype.Create=function(a,b){var c,d=a.GetType(),e=b.GetType(),f=this.m_registers[d][e];if(f.pool)return c=f.pool,f.pool=c.m_next,f.poolCount--,f.primary?c.Reset(a,b):c.Reset(b,a),c;if(f=this.m_registers[e][d],f.pool)return c=f.pool,f.pool=c.m_next,f.poolCount--,f.primary?c.Reset(b,a):c.Reset(a,b),c;f=this.m_registers[d][e];var g=f.createFcn;return null!=g?f.primary?(c=g(this.m_allocator),c.Reset(a,b),c):(c=g(this.m_allocator),c.Reset(b,a),c):null},b2ContactFactory.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=a.m_fixtureA.GetType(),c=a.m_fixtureB.GetType(),d=this.m_registers[b][c];d.poolCount++,a.m_next=d.pool,d.pool=a;var e=d.destroyFcn;e(a,this.m_allocator)},b2ContactFactory.prototype.m_registers=null,b2ContactFactory.prototype.m_allocator=null;var b2ConstantAccelController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantAccelController.prototype,b2Controller.prototype),b2ConstantAccelController.prototype._super=b2Controller.prototype,b2ConstantAccelController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantAccelController.prototype.__varz=function(){this.A=new b2Vec2(0,0)},b2ConstantAccelController.prototype.Step=function(a){for(var b=new b2Vec2(this.A.x*a.dt,this.A.y*a.dt),c=m_bodyList;c;c=c.nextBody){var d=c.body;d.IsAwake()&&d.SetLinearVelocity(new b2Vec2(d.GetLinearVelocity().x+b.x,d.GetLinearVelocity().y+b.y))}},b2ConstantAccelController.prototype.A=new b2Vec2(0,0);var b2SeparationFunction=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SeparationFunction.prototype.__constructor=function(){},b2SeparationFunction.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2},b2SeparationFunction.e_points=1,b2SeparationFunction.e_faceA=2,b2SeparationFunction.e_faceB=4,b2SeparationFunction.prototype.Initialize=function(a,b,c,d,e){this.m_proxyA=b,this.m_proxyB=d;var f=a.count;b2Settings.b2Assert(f>0&&3>f);var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(1==f)this.m_type=b2SeparationFunction.e_points,g=this.m_proxyA.GetVertex(a.indexA[0]),j=this.m_proxyB.GetVertex(a.indexB[0]),t=g,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=j,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),this.m_axis.x=o-m,this.m_axis.y=p-n,this.m_axis.Normalize();else if(a.indexB[0]==a.indexB[1])this.m_type=b2SeparationFunction.e_faceA,h=this.m_proxyA.GetVertex(a.indexA[0]),i=this.m_proxyA.GetVertex(a.indexA[1]),j=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(h.x+i.x),this.m_localPoint.y=.5*(h.y+i.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(i,h),1),this.m_axis.Normalize(),t=this.m_axis,s=c.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=j,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),u=(o-m)*q+(p-n)*r,0>u&&this.m_axis.NegativeSelf();else if(a.indexA[0]==a.indexA[0])this.m_type=b2SeparationFunction.e_faceB,k=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]),g=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(k.x+l.x),this.m_localPoint.y=.5*(k.y+l.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(l,k),1),this.m_axis.Normalize(),t=this.m_axis,s=e.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=g,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),u=(m-o)*q+(n-p)*r,0>u&&this.m_axis.NegativeSelf();else{h=this.m_proxyA.GetVertex(a.indexA[0]),i=this.m_proxyA.GetVertex(a.indexA[1]),k=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]);var w=(b2Math.MulX(c,g),b2Math.MulMV(c.R,b2Math.SubtractVV(i,h))),x=(b2Math.MulX(e,j),b2Math.MulMV(e.R,b2Math.SubtractVV(l,k))),y=w.x*w.x+w.y*w.y,z=x.x*x.x+x.y*x.y,A=b2Math.SubtractVV(x,w),B=w.x*A.x+w.y*A.y,C=x.x*A.x+x.y*A.y,D=w.x*x.x+w.y*x.y,E=y*z-D*D;u=0,0!=E&&(u=b2Math.Clamp((D*C-B*z)/E,0,1));var F=(D*u+C)/z;0>F&&(F=0,u=b2Math.Clamp((D-B)/y,0,1)),g=new b2Vec2,g.x=h.x+u*(i.x-h.x),g.y=h.y+u*(i.y-h.y),j=new b2Vec2,j.x=k.x+u*(l.x-k.x),j.y=k.y+u*(l.y-k.y),0==u||1==u?(this.m_type=b2SeparationFunction.e_faceB,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(l,k),1),this.m_axis.Normalize(),this.m_localPoint=j,t=this.m_axis,s=e.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=g,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),v=(m-o)*q+(n-p)*r,0>u&&this.m_axis.NegativeSelf()):(this.m_type=b2SeparationFunction.e_faceA,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(i,h),1),this.m_localPoint=g,t=this.m_axis,s=c.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=j,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),v=(o-m)*q+(p-n)*r,0>u&&this.m_axis.NegativeSelf())}},b2SeparationFunction.prototype.Evaluate=function(a,b){var c,d,e,f,g,h,i,j;switch(this.m_type){case b2SeparationFunction.e_points:return c=b2Math.MulTMV(a.R,this.m_axis),d=b2Math.MulTMV(b.R,this.m_axis.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),f=this.m_proxyB.GetSupportVertex(d),g=b2Math.MulX(a,e),h=b2Math.MulX(b,f),i=(h.x-g.x)*this.m_axis.x+(h.y-g.y)*this.m_axis.y;case b2SeparationFunction.e_faceA:return j=b2Math.MulMV(a.R,this.m_axis),g=b2Math.MulX(a,this.m_localPoint),d=b2Math.MulTMV(b.R,j.GetNegative()),f=this.m_proxyB.GetSupportVertex(d),h=b2Math.MulX(b,f),i=(h.x-g.x)*j.x+(h.y-g.y)*j.y;case b2SeparationFunction.e_faceB:return j=b2Math.MulMV(b.R,this.m_axis),h=b2Math.MulX(b,this.m_localPoint),c=b2Math.MulTMV(a.R,j.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),g=b2Math.MulX(a,e),i=(g.x-h.x)*j.x+(g.y-h.y)*j.y;default:return b2Settings.b2Assert(!1),0}},b2SeparationFunction.prototype.m_proxyA=null,b2SeparationFunction.prototype.m_proxyB=null,b2SeparationFunction.prototype.m_type=0,b2SeparationFunction.prototype.m_localPoint=new b2Vec2,b2SeparationFunction.prototype.m_axis=new b2Vec2;var b2DynamicTreePair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreePair.prototype.__constructor=function(){},b2DynamicTreePair.prototype.__varz=function(){},b2DynamicTreePair.prototype.proxyA=null,b2DynamicTreePair.prototype.proxyB=null;var b2ContactConstraintPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraintPoint.prototype.__constructor=function(){},b2ContactConstraintPoint.prototype.__varz=function(){this.localPoint=new b2Vec2,this.rA=new b2Vec2,this.rB=new b2Vec2},b2ContactConstraintPoint.prototype.localPoint=new b2Vec2,b2ContactConstraintPoint.prototype.rA=new b2Vec2,b2ContactConstraintPoint.prototype.rB=new b2Vec2,b2ContactConstraintPoint.prototype.normalImpulse=null,b2ContactConstraintPoint.prototype.tangentImpulse=null,b2ContactConstraintPoint.prototype.normalMass=null,b2ContactConstraintPoint.prototype.tangentMass=null,b2ContactConstraintPoint.prototype.equalizedMass=null,b2ContactConstraintPoint.prototype.velocityBias=null;var b2ControllerEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ControllerEdge.prototype.__constructor=function(){},b2ControllerEdge.prototype.__varz=function(){},b2ControllerEdge.prototype.controller=null,b2ControllerEdge.prototype.body=null,b2ControllerEdge.prototype.prevBody=null,b2ControllerEdge.prototype.nextBody=null,b2ControllerEdge.prototype.prevController=null,b2ControllerEdge.prototype.nextController=null;var b2DistanceInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceInput.prototype.__constructor=function(){},b2DistanceInput.prototype.__varz=function(){},b2DistanceInput.prototype.proxyA=null,b2DistanceInput.prototype.proxyB=null,b2DistanceInput.prototype.transformA=null,b2DistanceInput.prototype.transformB=null,b2DistanceInput.prototype.useRadii=null;var b2Settings=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){},b2Settings.prototype.__varz=function(){},b2Settings.b2MixFriction=function(a,b){return Math.sqrt(a*b)},b2Settings.b2MixRestitution=function(a,b){return a>b?a:b},b2Settings.b2Assert=function(a){if(!a)throw"Assertion Failed"},b2Settings.VERSION="2.1alpha",b2Settings.USHRT_MAX=65535,b2Settings.b2_pi=Math.PI,b2Settings.b2_maxManifoldPoints=2,b2Settings.b2_aabbExtension=.1,b2Settings.b2_aabbMultiplier=2,b2Settings.b2_polygonRadius=2*b2Settings.b2_linearSlop,b2Settings.b2_linearSlop=.005,b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop,b2Settings.b2_maxTOIContactsPerIsland=32,b2Settings.b2_maxTOIJointsPerIsland=32,b2Settings.b2_velocityThreshold=1,b2Settings.b2_maxLinearCorrection=.2,b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,b2Settings.b2_maxTranslation=2,b2Settings.b2_maxTranslationSquared=b2Settings.b2_maxTranslation*b2Settings.b2_maxTranslation,b2Settings.b2_maxRotation=.5*b2Settings.b2_pi,b2Settings.b2_maxRotationSquared=b2Settings.b2_maxRotation*b2Settings.b2_maxRotation,b2Settings.b2_contactBaumgarte=.2,b2Settings.b2_timeToSleep=.5,b2Settings.b2_linearSleepTolerance=.01,b2Settings.b2_angularSleepTolerance=2/180*b2Settings.b2_pi;var b2Proxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Proxy.prototype.__constructor=function(){},b2Proxy.prototype.__varz=function(){this.lowerBounds=new Array(2),this.upperBounds=new Array(2),this.pairs=new Object},b2Proxy.prototype.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid},b2Proxy.prototype.lowerBounds=new Array(2),b2Proxy.prototype.upperBounds=new Array(2),b2Proxy.prototype.overlapCount=0,b2Proxy.prototype.timeStamp=0,b2Proxy.prototype.pairs=new Object,b2Proxy.prototype.next=null,b2Proxy.prototype.userData=null;var b2Point=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Point.prototype.__constructor=function(){},b2Point.prototype.__varz=function(){this.p=new b2Vec2;
},b2Point.prototype.Support=function(a,b,c){return this.p},b2Point.prototype.GetFirstVertex=function(a){return this.p},b2Point.prototype.p=new b2Vec2;var b2WorldManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2WorldManifold.prototype.__constructor=function(){this.m_points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2Vec2},b2WorldManifold.prototype.__varz=function(){this.m_normal=new b2Vec2},b2WorldManifold.prototype.Initialize=function(a,b,c,d,e){if(0!=a.m_pointCount){var f,g,h,i,j,k,l,m,n=0;switch(a.m_type){case b2Manifold.e_circles:g=b.R,f=a.m_localPoint;var o=b.position.x+g.col1.x*f.x+g.col2.x*f.y,p=b.position.y+g.col1.y*f.x+g.col2.y*f.y;g=d.R,f=a.m_points[0].m_localPoint;var q=d.position.x+g.col1.x*f.x+g.col2.x*f.y,r=d.position.y+g.col1.y*f.x+g.col2.y*f.y,s=q-o,t=r-p,u=s*s+t*t;if(u>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(u);this.m_normal.x=s/v,this.m_normal.y=t/v}else this.m_normal.x=1,this.m_normal.y=0;var w=o+c*this.m_normal.x,x=p+c*this.m_normal.y,y=q-e*this.m_normal.x,z=r-e*this.m_normal.y;this.m_points[0].x=.5*(w+y),this.m_points[0].y=.5*(x+z);break;case b2Manifold.e_faceA:for(g=b.R,f=a.m_localPlaneNormal,h=g.col1.x*f.x+g.col2.x*f.y,i=g.col1.y*f.x+g.col2.y*f.y,g=b.R,f=a.m_localPoint,j=b.position.x+g.col1.x*f.x+g.col2.x*f.y,k=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=h,this.m_normal.y=i,n=0;n<a.m_pointCount;n++)g=d.R,f=a.m_points[n].m_localPoint,l=d.position.x+g.col1.x*f.x+g.col2.x*f.y,m=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[n].x=l+.5*(c-(l-j)*h-(m-k)*i-e)*h,this.m_points[n].y=m+.5*(c-(l-j)*h-(m-k)*i-e)*i;break;case b2Manifold.e_faceB:for(g=d.R,f=a.m_localPlaneNormal,h=g.col1.x*f.x+g.col2.x*f.y,i=g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_localPoint,j=d.position.x+g.col1.x*f.x+g.col2.x*f.y,k=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=-h,this.m_normal.y=-i,n=0;n<a.m_pointCount;n++)g=b.R,f=a.m_points[n].m_localPoint,l=b.position.x+g.col1.x*f.x+g.col2.x*f.y,m=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[n].x=l+.5*(e-(l-j)*h-(m-k)*i-c)*h,this.m_points[n].y=m+.5*(e-(l-j)*h-(m-k)*i-c)*i}}},b2WorldManifold.prototype.m_normal=new b2Vec2,b2WorldManifold.prototype.m_points=null;var b2RayCastOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastOutput.prototype.__constructor=function(){},b2RayCastOutput.prototype.__varz=function(){this.normal=new b2Vec2},b2RayCastOutput.prototype.normal=new b2Vec2,b2RayCastOutput.prototype.fraction=null;var b2ConstantForceController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantForceController.prototype,b2Controller.prototype),b2ConstantForceController.prototype._super=b2Controller.prototype,b2ConstantForceController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantForceController.prototype.__varz=function(){this.F=new b2Vec2(0,0)},b2ConstantForceController.prototype.Step=function(a){for(var b=m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.ApplyForce(this.F,c.GetWorldCenter())}},b2ConstantForceController.prototype.F=new b2Vec2(0,0);var b2MassData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2MassData.prototype.__constructor=function(){},b2MassData.prototype.__varz=function(){this.center=new b2Vec2(0,0)},b2MassData.prototype.mass=0,b2MassData.prototype.center=new b2Vec2(0,0),b2MassData.prototype.I=0;var b2DynamicTree=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTree.prototype.__constructor=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},b2DynamicTree.prototype.__varz=function(){},b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;return this.m_freeList=a.parent,a.parent=null,a.child1=null,a.child2=null,a}return new b2DynamicTreeNode},b2DynamicTree.prototype.FreeNode=function(a){a.parent=this.m_freeList,this.m_freeList=a},b2DynamicTree.prototype.InsertLeaf=function(a){if(++this.m_insertionCount,null==this.m_root)return this.m_root=a,void(this.m_root.parent=null);var b=a.aabb.GetCenter(),c=this.m_root;if(0==c.IsLeaf())do{var d=c.child1,e=c.child2,f=Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-b.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-b.y),g=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-b.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-b.y);c=g>f?d:e}while(0==c.IsLeaf());var h=c.parent,i=this.AllocateNode();if(i.parent=h,i.userData=null,i.aabb.Combine(a.aabb,c.aabb),h){c.parent.child1==c?h.child1=i:h.child2=i,i.child1=c,i.child2=a,c.parent=i,a.parent=i;do{if(h.aabb.Contains(i.aabb))break;h.aabb.Combine(h.child1.aabb,h.child2.aabb),i=h,h=h.parent}while(h)}else i.child1=c,i.child2=a,c.parent=i,a.parent=i,this.m_root=i},b2DynamicTree.prototype.RemoveLeaf=function(a){if(a==this.m_root)return void(this.m_root=null);var b,c=a.parent,d=c.parent;if(b=c.child1==a?c.child2:c.child1,d)for(d.child1==c?d.child1=b:d.child2=b,b.parent=d,this.FreeNode(c);d;){var e=d.aabb;if(d.aabb=b2AABB.Combine(d.child1.aabb,d.child2.aabb),e.Contains(d.aabb))break;d=d.parent}else this.m_root=b,b.parent=null,this.FreeNode(c)},b2DynamicTree.prototype.CreateProxy=function(a,b){var c=this.AllocateNode(),d=b2Settings.b2_aabbExtension,e=b2Settings.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-d,c.aabb.lowerBound.y=a.lowerBound.y-e,c.aabb.upperBound.x=a.upperBound.x+d,c.aabb.upperBound.y=a.upperBound.y+e,c.userData=b,this.InsertLeaf(c),c},b2DynamicTree.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),this.FreeNode(a)},b2DynamicTree.prototype.MoveProxy=function(a,b,c){if(b2Settings.b2Assert(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var d=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(c.x>0?c.x:-c.x),e=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(c.y>0?c.y:-c.y);return a.aabb.lowerBound.x=b.lowerBound.x-d,a.aabb.lowerBound.y=b.lowerBound.y-e,a.aabb.upperBound.x=b.upperBound.x+d,a.aabb.upperBound.y=b.upperBound.y+e,this.InsertLeaf(a),!0},b2DynamicTree.prototype.Rebalance=function(a){if(null!=this.m_root)for(var b=0;a>b;b++){for(var c=this.m_root,d=0;0==c.IsLeaf();)c=this.m_path>>d&1?c.child2:c.child1,d=d+1&31;++this.m_path,this.RemoveLeaf(c),this.InsertLeaf(c)}},b2DynamicTree.prototype.GetFatAABB=function(a){return a.aabb},b2DynamicTree.prototype.GetUserData=function(a){return a.userData},b2DynamicTree.prototype.Query=function(a,b){if(null!=this.m_root){var c=new Array,d=0;for(c[d++]=this.m_root;d>0;){var e=c[--d];if(e.aabb.TestOverlap(b))if(e.IsLeaf()){var f=a(e);if(!f)return}else c[d++]=e.child1,c[d++]=e.child2}}},b2DynamicTree.prototype.RayCast=function(a,b){if(null!=this.m_root){var c=b.p1,d=b.p2,e=b2Math.SubtractVV(c,d);e.Normalize();var f,g,h=b2Math.CrossFV(1,e),i=b2Math.AbsV(h),j=b.maxFraction,k=new b2AABB;f=c.x+j*(d.x-c.x),g=c.y+j*(d.y-c.y),k.lowerBound.x=Math.min(c.x,f),k.lowerBound.y=Math.min(c.y,g),k.upperBound.x=Math.max(c.x,f),k.upperBound.y=Math.max(c.y,g);var l=new Array,m=0;for(l[m++]=this.m_root;m>0;){var n=l[--m];if(0!=n.aabb.TestOverlap(k)){var o=n.aabb.GetCenter(),p=n.aabb.GetExtents(),q=Math.abs(h.x*(c.x-o.x)+h.y*(c.y-o.y))-i.x*p.x-i.y*p.y;if(!(q>0))if(n.IsLeaf()){var r=new b2RayCastInput;if(r.p1=b.p1,r.p2=b.p2,r.maxFraction=b.maxFraction,j=a(r,n),0==j)return;f=c.x+j*(d.x-c.x),g=c.y+j*(d.y-c.y),k.lowerBound.x=Math.min(c.x,f),k.lowerBound.y=Math.min(c.y,g),k.upperBound.x=Math.max(c.x,f),k.upperBound.y=Math.max(c.y,g)}else l[m++]=n.child1,l[m++]=n.child2}}}},b2DynamicTree.prototype.m_root=null,b2DynamicTree.prototype.m_freeList=null,b2DynamicTree.prototype.m_path=0,b2DynamicTree.prototype.m_insertionCount=0;var b2JointEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointEdge.prototype.__constructor=function(){},b2JointEdge.prototype.__varz=function(){},b2JointEdge.prototype.other=null,b2JointEdge.prototype.joint=null,b2JointEdge.prototype.prev=null,b2JointEdge.prototype.next=null;var b2RayCastInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastInput.prototype.__constructor=function(){},b2RayCastInput.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2RayCastInput.prototype.p1=new b2Vec2,b2RayCastInput.prototype.p2=new b2Vec2,b2RayCastInput.prototype.maxFraction=null;var Features=function(){this.__varz(),this.__constructor.apply(this,arguments)};Features.prototype.__constructor=function(){},Features.prototype.__varz=function(){},Features.prototype.__defineGetter__("referenceEdge",function(){return this._referenceEdge}),Features.prototype.__defineSetter__("referenceEdge",function(a){this._referenceEdge=a,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}),Features.prototype.__defineGetter__("incidentEdge",function(){return this._incidentEdge}),Features.prototype.__defineSetter__("incidentEdge",function(a){this._incidentEdge=a,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}),Features.prototype.__defineGetter__("incidentVertex",function(){return this._incidentVertex}),Features.prototype.__defineSetter__("incidentVertex",function(a){this._incidentVertex=a,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}),Features.prototype.__defineGetter__("flip",function(){return this._flip}),Features.prototype.__defineSetter__("flip",function(a){this._flip=a,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}),Features.prototype._referenceEdge=0,Features.prototype._incidentEdge=0,Features.prototype._incidentVertex=0,Features.prototype._flip=0,Features.prototype._m_id=null;var b2FilterData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FilterData.prototype.__constructor=function(){},b2FilterData.prototype.__varz=function(){this.categoryBits=1,this.maskBits=65535},b2FilterData.prototype.Copy=function(){var a=new b2FilterData;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},b2FilterData.prototype.categoryBits=1,b2FilterData.prototype.maskBits=65535,b2FilterData.prototype.groupIndex=0;var b2AABB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2AABB.prototype.__constructor=function(){},b2AABB.prototype.__varz=function(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2},b2AABB.Combine=function(a,b){var c=new b2AABB;return c.Combine(a,b),c},b2AABB.prototype.IsValid=function(){var a=this.upperBound.x-this.lowerBound.x,b=this.upperBound.y-this.lowerBound.y,c=a>=0&&b>=0;return c=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},b2AABB.prototype.GetCenter=function(){return new b2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},b2AABB.prototype.GetExtents=function(){return new b2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},b2AABB.prototype.Contains=function(a){var b=this.lowerBound.x<=a.lowerBound.x&&this.lowerBound.y<=a.lowerBound.y&&a.upperBound.x<=this.upperBound.x&&a.upperBound.y<=this.upperBound.y;return b},b2AABB.prototype.RayCast=function(a,b){var c,d,e,f,g,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,j=b.p1.x,k=b.p1.y,l=b.p2.x-b.p1.x,m=b.p2.y-b.p1.y,n=Math.abs(l),o=Math.abs(m),p=a.normal;if(n<Number.MIN_VALUE){if(j<this.lowerBound.x||this.upperBound.x<j)return!1}else if(c=1/l,d=(this.lowerBound.x-j)*c,e=(this.upperBound.x-j)*c,g=-1,d>e&&(f=d,d=e,e=f,g=1),d>h&&(p.x=g,p.y=0,h=d),i=Math.min(i,e),h>i)return!1;if(o<Number.MIN_VALUE){if(k<this.lowerBound.y||this.upperBound.y<k)return!1}else if(c=1/m,d=(this.lowerBound.y-k)*c,e=(this.upperBound.y-k)*c,g=-1,d>e&&(f=d,d=e,e=f,g=1),d>h&&(p.y=g,p.x=0,h=d),i=Math.min(i,e),h>i)return!1;return a.fraction=h,!0},b2AABB.prototype.TestOverlap=function(a){var b=a.lowerBound.x-this.upperBound.x,c=a.lowerBound.y-this.upperBound.y,d=this.lowerBound.x-a.upperBound.x,e=this.lowerBound.y-a.upperBound.y;return b>0||c>0?!1:d>0||e>0?!1:!0},b2AABB.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},b2AABB.prototype.lowerBound=new b2Vec2,b2AABB.prototype.upperBound=new b2Vec2;var b2Jacobian=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Jacobian.prototype.__constructor=function(){},b2Jacobian.prototype.__varz=function(){this.linearA=new b2Vec2,this.linearB=new b2Vec2},b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},b2Jacobian.prototype.Set=function(a,b,c,d){this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},b2Jacobian.prototype.Compute=function(a,b,c,d){return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},b2Jacobian.prototype.linearA=new b2Vec2,b2Jacobian.prototype.angularA=null,b2Jacobian.prototype.linearB=new b2Vec2,b2Jacobian.prototype.angularB=null;var b2Bound=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Bound.prototype.__constructor=function(){},b2Bound.prototype.__varz=function(){},b2Bound.prototype.IsLower=function(){return 0==(1&this.value)},b2Bound.prototype.IsUpper=function(){return 1==(1&this.value)},b2Bound.prototype.Swap=function(a){var b=this.value,c=this.proxy,d=this.stabbingCount;this.value=a.value,this.proxy=a.proxy,this.stabbingCount=a.stabbingCount,a.value=b,a.proxy=c,a.stabbingCount=d},b2Bound.prototype.value=0,b2Bound.prototype.proxy=null,b2Bound.prototype.stabbingCount=0;var b2SimplexVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexVertex.prototype.__constructor=function(){},b2SimplexVertex.prototype.__varz=function(){},b2SimplexVertex.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},b2SimplexVertex.prototype.wA=null,b2SimplexVertex.prototype.wB=null,b2SimplexVertex.prototype.w=null,b2SimplexVertex.prototype.a=null,b2SimplexVertex.prototype.indexA=0,b2SimplexVertex.prototype.indexB=0;var b2Mat22=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat22.prototype.__constructor=function(){this.col1.x=this.col2.y=1},b2Mat22.prototype.__varz=function(){this.col1=new b2Vec2,this.col2=new b2Vec2},b2Mat22.FromAngle=function(a){var b=new b2Mat22;return b.Set(a),b},b2Mat22.FromVV=function(a,b){var c=new b2Mat22;return c.SetVV(a,b),c},b2Mat22.prototype.Set=function(a){var b=Math.cos(a),c=Math.sin(a);this.col1.x=b,this.col2.x=-c,this.col1.y=c,this.col2.y=b},b2Mat22.prototype.SetVV=function(a,b){this.col1.SetV(a),this.col2.SetV(b)},b2Mat22.prototype.Copy=function(){var a=new b2Mat22;return a.SetM(this),a},b2Mat22.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},b2Mat22.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y},b2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},b2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},b2Mat22.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,f=b*e-c*d;return 0!=f&&(f=1/f),a.col1.x=f*e,a.col2.x=-f*c,a.col1.y=-f*d,a.col2.y=f*b,a},b2Mat22.prototype.Solve=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b2Mat22.prototype.col1=new b2Vec2,b2Mat22.prototype.col2=new b2Vec2;var b2SimplexCache=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexCache.prototype.__constructor=function(){},b2SimplexCache.prototype.__varz=function(){this.indexA=new Array(3),this.indexB=new Array(3)},b2SimplexCache.prototype.metric=null,b2SimplexCache.prototype.count=0,b2SimplexCache.prototype.indexA=new Array(3),b2SimplexCache.prototype.indexB=new Array(3);var b2Shape=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(){this.m_type=b2Shape.e_unknownShape,this.m_radius=b2Settings.b2_linearSlop},b2Shape.prototype.__varz=function(){},b2Shape.TestOverlap=function(a,b,c,d){var e=new b2DistanceInput;e.proxyA=new b2DistanceProxy,e.proxyA.Set(a),e.proxyB=new b2DistanceProxy,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0;var f=new b2SimplexCache;f.count=0;var g=new b2DistanceOutput;return b2Distance.Distance(g,f,e),g.distance<10*Number.MIN_VALUE},b2Shape.e_hitCollide=1,b2Shape.e_missCollide=0,b2Shape.e_startsInsideCollide=-1,b2Shape.e_unknownShape=-1,b2Shape.e_circleShape=0,b2Shape.e_polygonShape=1,b2Shape.e_edgeShape=2,b2Shape.e_shapeTypeCount=3,b2Shape.prototype.Copy=function(){return null},b2Shape.prototype.Set=function(a){this.m_radius=a.m_radius},b2Shape.prototype.GetType=function(){return this.m_type},b2Shape.prototype.TestPoint=function(a,b){return!1},b2Shape.prototype.RayCast=function(a,b,c){return!1},b2Shape.prototype.ComputeAABB=function(a,b){},b2Shape.prototype.ComputeMass=function(a,b){},b2Shape.prototype.ComputeSubmergedArea=function(a,b,c,d){return 0},b2Shape.prototype.m_type=0,b2Shape.prototype.m_radius=null;var b2Segment=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Segment.prototype.__constructor=function(){},b2Segment.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2Segment.prototype.TestSegment=function(a,b,c,d){var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y,h=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,j=i,k=-h,l=100*Number.MIN_VALUE,m=-(f*j+g*k);if(m>l){var n=e.x-this.p1.x,o=e.y-this.p1.y,p=n*j+o*k;if(p>=0&&d*m>=p){var q=-f*o+g*n;if(q>=-l*m&&m*(1+l)>=q){p/=m;var r=Math.sqrt(j*j+k*k);return j/=r,k/=r,a[0]=p,b.Set(j,k),!0}}}return!1},b2Segment.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},b2Segment.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:0>b?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:0>c?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*d,this.p2.y=this.p1.y+c*d},b2Segment.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:0>b?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:0>c?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*d,this.p1.y=this.p2.y+c*d},b2Segment.prototype.p1=new b2Vec2,b2Segment.prototype.p2=new b2Vec2;var b2ContactRegister=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactRegister.prototype.__constructor=function(){},b2ContactRegister.prototype.__varz=function(){},b2ContactRegister.prototype.createFcn=null,b2ContactRegister.prototype.destroyFcn=null,b2ContactRegister.prototype.primary=null,b2ContactRegister.prototype.pool=null,b2ContactRegister.prototype.poolCount=0;var b2DebugDraw=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0},b2DebugDraw.prototype.__varz=function(){},b2DebugDraw.e_shapeBit=1,b2DebugDraw.e_jointBit=2,b2DebugDraw.e_aabbBit=4,b2DebugDraw.e_pairBit=8,b2DebugDraw.e_centerOfMassBit=16,b2DebugDraw.e_controllerBit=32,b2DebugDraw.prototype.SetFlags=function(a){this.m_drawFlags=a},b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},b2DebugDraw.prototype.AppendFlags=function(a){this.m_drawFlags|=a},b2DebugDraw.prototype.ClearFlags=function(a){this.m_drawFlags&=~a},b2DebugDraw.prototype.SetSprite=function(a){this.m_sprite=a},b2DebugDraw.prototype.GetSprite=function(){return this.m_sprite},b2DebugDraw.prototype.SetDrawScale=function(a){this.m_drawScale=a},b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},b2DebugDraw.prototype.SetLineThickness=function(a){this.m_lineThickness=a},b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},b2DebugDraw.prototype.SetAlpha=function(a){this.m_alpha=a},b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},b2DebugDraw.prototype.SetFillAlpha=function(a){this.m_fillAlpha=a},b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},b2DebugDraw.prototype.SetXFormScale=function(a){this.m_xformScale=a},b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},b2DebugDraw.prototype.Clear=function(){this.m_sprite.clearRect(0,0,this.m_sprite.canvas.width,this.m_sprite.canvas.height)},b2DebugDraw.prototype.Y=function(a){return this.m_sprite.canvas.height-a},b2DebugDraw.prototype.ToWorldPoint=function(a){return new b2Vec2(a.x/this.m_drawScale,this.Y(a.y)/this.m_drawScale)},b2DebugDraw.prototype.ColorStyle=function(a,b){return"rgba("+a.r+", "+a.g+", "+a.b+", "+b+")"},b2DebugDraw.prototype.DrawPolygon=function(a,b,c){this.m_sprite.graphics.lineStyle(this.m_lineThickness,c.color,this.m_alpha),this.m_sprite.graphics.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);for(var d=1;b>d;d++)this.m_sprite.graphics.lineTo(a[d].x*this.m_drawScale,a[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidPolygon=function(a,b,c){this.m_sprite.strokeSyle=this.ColorStyle(c,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(c,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a[0].x*this.m_drawScale,this.Y(a[0].y*this.m_drawScale));for(var d=1;b>d;d++)this.m_sprite.lineTo(a[d].x*this.m_drawScale,this.Y(a[d].y*this.m_drawScale));this.m_sprite.lineTo(a[0].x*this.m_drawScale,this.Y(a[0].y*this.m_drawScale)),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawCircle=function(a,b,c){this.m_sprite.graphics.lineStyle(this.m_lineThickness,c.color,this.m_alpha),this.m_sprite.graphics.drawCircle(a.x*this.m_drawScale,a.y*this.m_drawScale,b*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidCircle=function(a,b,c,d){this.m_sprite.strokeSyle=this.ColorStyle(d,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(d,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.arc(a.x*this.m_drawScale,this.Y(a.y*this.m_drawScale),b*this.m_drawScale,0,2*Math.PI,!0),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawSegment=function(a,b,c){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(c,this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.x*this.m_drawScale,this.Y(a.y*this.m_drawScale)),this.m_sprite.lineTo(b.x*this.m_drawScale,this.Y(b.y*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawTransform=function(a){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(255,0,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.position.x*this.m_drawScale,this.Y(a.position.y*this.m_drawScale)),this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*this.m_drawScale,this.Y((a.position.y+this.m_xformScale*a.R.col1.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath(),this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(0,255,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.position.x*this.m_drawScale,this.Y(a.position.y*this.m_drawScale)),this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*this.m_drawScale,this.Y((a.position.y+this.m_xformScale*a.R.col2.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.m_drawFlags=0,b2DebugDraw.prototype.m_sprite=null,b2DebugDraw.prototype.m_drawScale=1,b2DebugDraw.prototype.m_lineThickness=1,b2DebugDraw.prototype.m_alpha=1,b2DebugDraw.prototype.m_fillAlpha=1,b2DebugDraw.prototype.m_xformScale=1;var b2Sweep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Sweep.prototype.__constructor=function(){},b2Sweep.prototype.__varz=function(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2},b2Sweep.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},b2Sweep.prototype.Copy=function(){var a=new b2Sweep;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},b2Sweep.prototype.GetTransform=function(a,b){a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y;var c=(1-b)*this.a0+b*this.a;a.R.Set(c);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y,a.position.y-=d.col1.y*this.localCenter.x+d.col2.y*this.localCenter.y},b2Sweep.prototype.Advance=function(a){if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}},b2Sweep.prototype.localCenter=new b2Vec2,b2Sweep.prototype.c0=new b2Vec2,b2Sweep.prototype.c=new b2Vec2,b2Sweep.prototype.a0=null,b2Sweep.prototype.a=null,b2Sweep.prototype.t0=null;var b2DistanceOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceOutput.prototype.__constructor=function(){},b2DistanceOutput.prototype.__varz=function(){this.pointA=new b2Vec2,this.pointB=new b2Vec2},b2DistanceOutput.prototype.pointA=new b2Vec2,b2DistanceOutput.prototype.pointB=new b2Vec2,b2DistanceOutput.prototype.distance=null,b2DistanceOutput.prototype.iterations=0;var b2Mat33=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat33.prototype.__constructor=function(a,b,c){a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},b2Mat33.prototype.__varz=function(){this.col1=new b2Vec3,this.col2=new b2Vec3,this.col3=new b2Vec3},b2Mat33.prototype.SetVVV=function(a,b,c){this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)},b2Mat33.prototype.Copy=function(){return new b2Mat33(this.col1,this.col2,this.col3)},b2Mat33.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},b2Mat33.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},b2Mat33.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b2Mat33.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b2Mat33.prototype.Solve22=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b2Mat33.prototype.Solve33=function(a,b,c,d){var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!=n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a},b2Mat33.prototype.col1=new b2Vec3,b2Mat33.prototype.col2=new b2Vec3,b2Mat33.prototype.col3=new b2Vec3;var b2PositionSolverManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PositionSolverManifold.prototype.__constructor=function(){this.m_normal=new b2Vec2,this.m_separations=new Array(b2Settings.b2_maxManifoldPoints),this.m_points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2Vec2},b2PositionSolverManifold.prototype.__varz=function(){},b2PositionSolverManifold.circlePointA=new b2Vec2,b2PositionSolverManifold.circlePointB=new b2Vec2,b2PositionSolverManifold.prototype.Initialize=function(a){b2Settings.b2Assert(a.pointCount>0);var b,c,d,e,f,g,h=0;switch(a.type){case b2Manifold.e_circles:d=a.bodyA.m_xf.R,e=a.localPoint;var i=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),j=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y);d=a.bodyB.m_xf.R,e=a.points[0].localPoint;var k=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),l=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),m=k-i,n=l-j,o=m*m+n*n;if(o>Number.MIN_VALUE*Number.MIN_VALUE){var p=Math.sqrt(o);this.m_normal.x=m/p,this.m_normal.y=n/p}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(i+k),this.m_points[0].y=.5*(j+l),this.m_separations[0]=m*this.m_normal.x+n*this.m_normal.y-a.radius;break;case b2Manifold.e_faceA:for(d=a.bodyA.m_xf.R,e=a.localPlaneNormal,this.m_normal.x=d.col1.x*e.x+d.col2.x*e.y,this.m_normal.y=d.col1.y*e.x+d.col2.y*e.y,d=a.bodyA.m_xf.R,e=a.localPoint,f=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),g=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),d=a.bodyB.m_xf.R,h=0;h<a.pointCount;++h)e=a.points[h].localPoint,b=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),c=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),this.m_separations[h]=(b-f)*this.m_normal.x+(c-g)*this.m_normal.y-a.radius,this.m_points[h].x=b,this.m_points[h].y=c;break;case b2Manifold.e_faceB:for(d=a.bodyB.m_xf.R,e=a.localPlaneNormal,this.m_normal.x=d.col1.x*e.x+d.col2.x*e.y,this.m_normal.y=d.col1.y*e.x+d.col2.y*e.y,d=a.bodyB.m_xf.R,e=a.localPoint,f=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),g=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),d=a.bodyA.m_xf.R,h=0;h<a.pointCount;++h)e=a.points[h].localPoint,b=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),c=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),this.m_separations[h]=(b-f)*this.m_normal.x+(c-g)*this.m_normal.y-a.radius,this.m_points[h].Set(b,c);this.m_normal.x*=-1,this.m_normal.y*=-1}},b2PositionSolverManifold.prototype.m_normal=null,b2PositionSolverManifold.prototype.m_points=null,b2PositionSolverManifold.prototype.m_separations=null;var b2OBB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2OBB.prototype.__constructor=function(){},b2OBB.prototype.__varz=function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2},b2OBB.prototype.R=new b2Mat22,b2OBB.prototype.center=new b2Vec2,b2OBB.prototype.extents=new b2Vec2;var b2Pair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){},b2Pair.prototype.__varz=function(){},b2Pair.b2_nullProxy=b2Settings.USHRT_MAX,b2Pair.e_pairBuffered=1,b2Pair.e_pairRemoved=2,b2Pair.e_pairFinal=4,b2Pair.prototype.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered},b2Pair.prototype.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered},b2Pair.prototype.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},b2Pair.prototype.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved},b2Pair.prototype.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved},b2Pair.prototype.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},b2Pair.prototype.SetFinal=function(){this.status|=b2Pair.e_pairFinal},b2Pair.prototype.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},b2Pair.prototype.userData=null,b2Pair.prototype.proxy1=null,b2Pair.prototype.proxy2=null,b2Pair.prototype.next=null,b2Pair.prototype.status=0;var b2FixtureDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FixtureDef.prototype.__constructor=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,
this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},b2FixtureDef.prototype.__varz=function(){this.filter=new b2FilterData},b2FixtureDef.prototype.shape=null,b2FixtureDef.prototype.userData=null,b2FixtureDef.prototype.friction=null,b2FixtureDef.prototype.restitution=null,b2FixtureDef.prototype.density=null,b2FixtureDef.prototype.isSensor=null,b2FixtureDef.prototype.filter=new b2FilterData;var b2ContactID=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactID.prototype.__constructor=function(){this.features._m_id=this},b2ContactID.prototype.__varz=function(){this.features=new Features},b2ContactID.prototype.Set=function(a){key=a._key},b2ContactID.prototype.Copy=function(){var a=new b2ContactID;return a.key=key,a},b2ContactID.prototype.__defineSetter__("key",function(){return this._key}),b2ContactID.prototype.__defineSetter__("key",function(a){this._key=a,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}),b2ContactID.prototype._key=0,b2ContactID.prototype.features=new Features;var b2Transform=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Transform.prototype.__constructor=function(a,b){a&&(this.position.SetV(a),this.R.SetM(b))},b2Transform.prototype.__varz=function(){this.position=new b2Vec2,this.R=new b2Mat22},b2Transform.prototype.Initialize=function(a,b){this.position.SetV(a),this.R.SetM(b)},b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},b2Transform.prototype.Set=function(a){this.position.SetV(a.position),this.R.SetM(a.R)},b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},b2Transform.prototype.position=new b2Vec2,b2Transform.prototype.R=new b2Mat22;var b2EdgeShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeShape.prototype,b2Shape.prototype),b2EdgeShape.prototype._super=b2Shape.prototype,b2EdgeShape.prototype.__constructor=function(a,b){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=a,this.m_v2=b,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},b2EdgeShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2,this.m_v1=new b2Vec2,this.m_v2=new b2Vec2,this.m_coreV1=new b2Vec2,this.m_coreV2=new b2Vec2,this.m_normal=new b2Vec2,this.m_direction=new b2Vec2,this.m_cornerDir1=new b2Vec2,this.m_cornerDir2=new b2Vec2},b2EdgeShape.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},b2EdgeShape.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},b2EdgeShape.prototype.TestPoint=function(a,b){return!1},b2EdgeShape.prototype.RayCast=function(a,b,c){var d,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;d=c.R;var g=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),h=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),i=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-h,j=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-g),k=100*Number.MIN_VALUE,l=-(e*i+f*j);if(l>k){var m=b.p1.x-g,n=b.p1.y-h,o=m*i+n*j;if(o>=0&&o<=b.maxFraction*l){var p=-e*n+f*m;if(p>=-k*l&&l*(1+k)>=p){o/=l,a.fraction=o;var q=Math.sqrt(i*i+j*j);return a.normal.x=i/q,a.normal.y=j/q,!0}}}return!1},b2EdgeShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),g=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);f>d?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),g>e?(a.lowerBound.y=e,a.upperBound.y=g):(a.lowerBound.y=g,a.upperBound.y=e)},b2EdgeShape.prototype.ComputeMass=function(a,b){a.mass=0,a.center.SetV(this.m_v1),a.I=0},b2EdgeShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=new b2Vec2(a.x*b,a.y*b),f=b2Math.MulX(c,this.m_v1),g=b2Math.MulX(c,this.m_v2),h=b2Math.Dot(a,f)-b,i=b2Math.Dot(a,g)-b;if(h>0){if(i>0)return 0;f.x=-i/(h-i)*f.x+h/(h-i)*g.x,f.y=-i/(h-i)*f.y+h/(h-i)*g.y}else i>0&&(g.x=-i/(h-i)*f.x+h/(h-i)*g.x,g.y=-i/(h-i)*f.y+h/(h-i)*g.y);return d.x=(e.x+f.x+g.x)/3,d.y=(e.y+f.y+g.y)/3,.5*((f.x-e.x)*(g.y-e.y)-(f.y-e.y)*(g.x-e.x))},b2EdgeShape.prototype.GetLength=function(){return this.m_length},b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},b2EdgeShape.prototype.GetFirstVertex=function(a){var b=a.R;return new b2Vec2(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},b2EdgeShape.prototype.Support=function(a,b,c){var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),h=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return e*b+f*c>g*b+h*c?(this.s_supportVec.x=e,this.s_supportVec.y=f):(this.s_supportVec.x=g,this.s_supportVec.y=h),this.s_supportVec},b2EdgeShape.prototype.s_supportVec=new b2Vec2,b2EdgeShape.prototype.m_v1=new b2Vec2,b2EdgeShape.prototype.m_v2=new b2Vec2,b2EdgeShape.prototype.m_coreV1=new b2Vec2,b2EdgeShape.prototype.m_coreV2=new b2Vec2,b2EdgeShape.prototype.m_length=null,b2EdgeShape.prototype.m_normal=new b2Vec2,b2EdgeShape.prototype.m_direction=new b2Vec2,b2EdgeShape.prototype.m_cornerDir1=new b2Vec2,b2EdgeShape.prototype.m_cornerDir2=new b2Vec2,b2EdgeShape.prototype.m_cornerConvex1=null,b2EdgeShape.prototype.m_cornerConvex2=null,b2EdgeShape.prototype.m_nextEdge=null,b2EdgeShape.prototype.m_prevEdge=null;var b2BuoyancyController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2BuoyancyController.prototype,b2Controller.prototype),b2BuoyancyController.prototype._super=b2Controller.prototype,b2BuoyancyController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2BuoyancyController.prototype.__varz=function(){this.normal=new b2Vec2(0,-1),this.velocity=new b2Vec2(0,0)},b2BuoyancyController.prototype.Step=function(a){if(m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var b=m_bodyList;b;b=b.nextBody){var c=b.body;if(0!=c.IsAwake()){for(var d=new b2Vec2,e=new b2Vec2,f=0,g=0,h=c.GetFixtureList();h;h=h.GetNext()){var i=new b2Vec2,j=h.GetShape().ComputeSubmergedArea(this.normal,this.offset,c.GetTransform(),i);f+=j,d.x+=j*i.x,d.y+=j*i.y;var k;k=(this.useDensity,1),g+=j*k,e.x+=j*i.x*k,e.y+=j*i.y*k}if(d.x/=f,d.y/=f,e.x/=g,e.y/=g,!(f<Number.MIN_VALUE)){var l=this.gravity.GetNegative();l.Multiply(this.density*f),c.ApplyForce(l,e);var m=c.GetLinearVelocityFromWorldPoint(d);m.Subtract(this.velocity),m.Multiply(-this.linearDrag*f),c.ApplyForce(m,d),c.ApplyTorque(-c.GetInertia()/c.GetMass()*f*c.GetAngularVelocity()*this.angularDrag)}}}}},b2BuoyancyController.prototype.Draw=function(a){var b=1e3,c=new b2Vec2,d=new b2Vec2;c.x=this.normal.x*this.offset+this.normal.y*b,c.y=this.normal.y*this.offset-this.normal.x*b,d.x=this.normal.x*this.offset-this.normal.y*b,d.y=this.normal.y*this.offset+this.normal.x*b;var e=new b2Color(0,0,1);a.DrawSegment(c,d,e)},b2BuoyancyController.prototype.normal=new b2Vec2(0,-1),b2BuoyancyController.prototype.offset=0,b2BuoyancyController.prototype.density=0,b2BuoyancyController.prototype.velocity=new b2Vec2(0,0),b2BuoyancyController.prototype.linearDrag=2,b2BuoyancyController.prototype.angularDrag=1,b2BuoyancyController.prototype.useDensity=!1,b2BuoyancyController.prototype.useWorldGravity=!0,b2BuoyancyController.prototype.gravity=null;var b2Body=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Body.prototype.__constructor=function(a,b){this.m_flags=0,a.bullet&&(this.m_flags|=b2Body.e_bulletFlag),a.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag),a.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),a.awake&&(this.m_flags|=b2Body.e_awakeFlag),a.active&&(this.m_flags|=b2Body.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(a.linearVelocity),this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=a.type,this.m_type==b2Body.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=a.inertiaScale,this.m_userData=a.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b2Body.prototype.__varz=function(){this.m_xf=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_force=new b2Vec2},b2Body.b2_staticBody=0,b2Body.b2_kinematicBody=1,b2Body.b2_dynamicBody=2,b2Body.s_xf1=new b2Transform,b2Body.e_islandFlag=1,b2Body.e_awakeFlag=2,b2Body.e_allowSleepFlag=4,b2Body.e_bulletFlag=8,b2Body.e_fixedRotationFlag=16,b2Body.e_activeFlag=32,b2Body.prototype.connectEdges=function(a,b,c){var d=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x),e=Math.tan(.5*(d-c)),f=b2Math.MulFV(e,b.GetDirectionVector());f=b2Math.SubtractVV(f,b.GetNormalVector()),f=b2Math.MulFV(b2Settings.b2_toiSlop,f),f=b2Math.AddVV(f,b.GetVertex1());var g=b2Math.AddVV(a.GetDirectionVector(),b.GetDirectionVector());g.Normalize();var h=b2Math.Dot(a.GetDirectionVector(),b.GetNormalVector())>0;return a.SetNextEdge(b,f,g,h),b.SetPrevEdge(a,f,g,h),d},b2Body.prototype.SynchronizeFixtures=function(){var a=b2Body.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y),a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y);var d,e=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(e,a,this.m_xf)},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},b2Body.prototype.ShouldCollide=function(a){if(this.m_type!=b2Body.b2_dynamicBody&&a.m_type!=b2Body.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&0==b.joint.m_collideConnected)return!1;return!0},b2Body.prototype.Advance=function(a){this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},b2Body.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var b=new b2Fixture;if(b.Create(this,this.m_xf,a),this.m_flags&b2Body.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;b.CreateProxy(c,this.m_xf)}return b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=b2World.e_newFixture,b},b2Body.prototype.CreateFixture2=function(a,b){var c=new b2FixtureDef;return c.shape=a,c.density=b,this.CreateFixture(c)},b2Body.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var b=this.m_fixtureList,c=null,d=!1;null!=b;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next,d=!0;break}c=b,b=b.m_next}for(var e=this.m_contactList;e;){var f=e.contact;e=e.next;var g=f.GetFixtureA(),h=f.GetFixtureB();(a==g||a==h)&&this.m_world.m_contactManager.Destroy(f)}if(this.m_flags&b2Body.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;a.DestroyProxy(i)}a.Destroy(),a.m_body=null,a.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b2Body.prototype.SetPositionAndAngle=function(a,b){var c;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(b),this.m_xf.position.SetV(a);var d=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y,this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b;var f=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(f,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b2Body.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},b2Body.prototype.GetTransform=function(){return this.m_xf},b2Body.prototype.GetPosition=function(){return this.m_xf.position},b2Body.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},b2Body.prototype.GetAngle=function(){return this.m_sweep.a},b2Body.prototype.SetAngle=function(a){this.SetPositionAndAngle(this.GetPosition(),a)},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b2Body.prototype.SetLinearVelocity=function(a){this.m_type!=b2Body.b2_staticBody&&this.m_linearVelocity.SetV(a)},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b2Body.prototype.SetAngularVelocity=function(a){this.m_type!=b2Body.b2_staticBody&&(this.m_angularVelocity=a)},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b2Body.prototype.GetDefinition=function(){var a=new b2BodyDef;return a.type=this.GetType(),a.allowSleep=(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag,a.bullet=(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag,a.awake=(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position=this.GetPosition(),a.userData=this.GetUserData(),a},b2Body.prototype.ApplyForce=function(a,b){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},b2Body.prototype.ApplyTorque=function(a){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=a)},b2Body.prototype.ApplyImpulse=function(a,b){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},b2Body.prototype.Split=function(a){for(var b,c=this.GetLinearVelocity().Copy(),d=this.GetAngularVelocity(),e=this.GetWorldCenter(),f=this,g=this.m_world.CreateBody(this.GetDefinition()),h=f.m_fixtureList;h;)if(a(h)){var i=h.m_next;b?b.m_next=i:f.m_fixtureList=i,f.m_fixtureCount--,h.m_next=g.m_fixtureList,g.m_fixtureList=h,g.m_fixtureCount++,h.m_body=g,h=i}else b=h,h=h.m_next;f.ResetMassData(),g.ResetMassData();var j=f.GetWorldCenter(),k=g.GetWorldCenter(),l=b2Math.AddVV(c,b2Math.CrossFV(d,b2Math.SubtractVV(j,e))),m=b2Math.AddVV(c,b2Math.CrossFV(d,b2Math.SubtractVV(k,e)));return f.SetLinearVelocity(l),g.SetLinearVelocity(m),f.SetAngularVelocity(d),g.SetAngularVelocity(d),f.SynchronizeFixtures(),g.SynchronizeFixtures(),g},b2Body.prototype.Merge=function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=e,b=c}d.m_fixtureCount=0;var d=this,e=a;d.GetWorldCenter(),e.GetWorldCenter(),d.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),d.GetAngularVelocity(),e.GetAngularVelocity();d.ResetMassData(),this.SynchronizeFixtures()},b2Body.prototype.GetMass=function(){return this.m_mass},b2Body.prototype.GetInertia=function(){return this.m_I},b2Body.prototype.GetMassData=function(a){a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter)},b2Body.prototype.SetMassData=function(a){if(b2Settings.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==b2Body.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=a.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,a.I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=b2Body.b2_staticBody&&this.m_type!=b2Body.b2_kinematicBody){for(var a=b2Vec2.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var c=b.GetMassData();this.m_mass+=c.mass,a.x+=c.center.x*c.mass,a.y+=c.center.y*c.mass,this.m_I+=c.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,b2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}},b2Body.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,c=new b2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,c},b2Body.prototype.GetWorldVector=function(a){return b2Math.MulMV(this.m_xf.R,a)},b2Body.prototype.GetLocalPoint=function(a){return b2Math.MulXT(this.m_xf,a)},b2Body.prototype.GetLocalVector=function(a){return b2Math.MulTMV(this.m_xf.R,a)},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(a){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,c=new b2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},b2Body.prototype.SetLinearDamping=function(a){this.m_linearDamping=a},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},b2Body.prototype.SetAngularDamping=function(a){this.m_angularDamping=a},b2Body.prototype.SetType=function(a){if(this.m_type!=a){this.m_type=a,this.ResetMassData(),this.m_type==b2Body.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}},b2Body.prototype.GetType=function(){return this.m_type},b2Body.prototype.SetBullet=function(a){a?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag},b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag},b2Body.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.SetAwake(!0))},b2Body.prototype.SetAwake=function(a){a?(this.m_flags|=b2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b2Body.prototype.IsAwake=function(){return(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag},b2Body.prototype.SetFixedRotation=function(a){a?this.m_flags|=b2Body.e_fixedRotationFlag:this.m_flags&=~b2Body.e_fixedRotationFlag,this.ResetMassData()},b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag},b2Body.prototype.SetActive=function(a){if(a!=this.IsActive()){var b,c;if(a)for(this.m_flags|=b2Body.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(b,this.m_xf);else{for(this.m_flags&=~b2Body.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(b);for(var d=this.m_contactList;d;){var e=d;d=d.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}},b2Body.prototype.IsActive=function(){return(this.m_flags&b2Body.e_activeFlag)==b2Body.e_activeFlag},b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},b2Body.prototype.GetJointList=function(){return this.m_jointList},b2Body.prototype.GetControllerList=function(){return this.m_controllerList},b2Body.prototype.GetContactList=function(){return this.m_contactList},b2Body.prototype.GetNext=function(){return this.m_next},b2Body.prototype.GetUserData=function(){return this.m_userData},b2Body.prototype.SetUserData=function(a){this.m_userData=a},b2Body.prototype.GetWorld=function(){return this.m_world},b2Body.prototype.m_flags=0,b2Body.prototype.m_type=0,b2Body.prototype.m_islandIndex=0,b2Body.prototype.m_xf=new b2Transform,b2Body.prototype.m_sweep=new b2Sweep,b2Body.prototype.m_linearVelocity=new b2Vec2,b2Body.prototype.m_angularVelocity=null,b2Body.prototype.m_force=new b2Vec2,b2Body.prototype.m_torque=null,b2Body.prototype.m_world=null,b2Body.prototype.m_prev=null,b2Body.prototype.m_next=null,b2Body.prototype.m_fixtureList=null,b2Body.prototype.m_fixtureCount=0,b2Body.prototype.m_controllerList=null,b2Body.prototype.m_controllerCount=0,b2Body.prototype.m_jointList=null,b2Body.prototype.m_contactList=null,b2Body.prototype.m_mass=null,b2Body.prototype.m_invMass=null,b2Body.prototype.m_I=null,b2Body.prototype.m_invI=null,b2Body.prototype.m_inertiaScale=null,b2Body.prototype.m_linearDamping=null,b2Body.prototype.m_angularDamping=null,b2Body.prototype.m_sleepTime=null,b2Body.prototype.m_userData=null;var b2ContactImpulse=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactImpulse.prototype.__constructor=function(){},b2ContactImpulse.prototype.__varz=function(){this.normalImpulses=new Array(b2Settings.b2_maxManifoldPoints),this.tangentImpulses=new Array(b2Settings.b2_maxManifoldPoints)},b2ContactImpulse.prototype.normalImpulses=new Array(b2Settings.b2_maxManifoldPoints),b2ContactImpulse.prototype.tangentImpulses=new Array(b2Settings.b2_maxManifoldPoints);var b2TensorDampingController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2TensorDampingController.prototype,b2Controller.prototype),b2TensorDampingController.prototype._super=b2Controller.prototype,b2TensorDampingController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2TensorDampingController.prototype.__varz=function(){this.T=new b2Mat22},b2TensorDampingController.prototype.SetAxisAligned=function(a,b){this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,a>0||b>0?this.maxTimestep=1/Math.max(a,b):this.maxTimestep=0},b2TensorDampingController.prototype.Step=function(a){var b=a.dt;if(!(b<=Number.MIN_VALUE)){b>this.maxTimestep&&this.maxTimestep>0&&(b=this.maxTimestep);for(var c=m_bodyList;c;c=c.nextBody){var d=c.body;if(d.IsAwake()){var e=d.GetWorldVector(b2Math.MulMV(this.T,d.GetLocalVector(d.GetLinearVelocity())));d.SetLinearVelocity(new b2Vec2(d.GetLinearVelocity().x+e.x*b,d.GetLinearVelocity().y+e.y*b))}}}},b2TensorDampingController.prototype.T=new b2Mat22,b2TensorDampingController.prototype.maxTimestep=0;var b2ManifoldPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ManifoldPoint.prototype.__constructor=function(){this.Reset()},b2ManifoldPoint.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_id=new b2ContactID},b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},b2ManifoldPoint.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},b2ManifoldPoint.prototype.m_localPoint=new b2Vec2,b2ManifoldPoint.prototype.m_normalImpulse=null,b2ManifoldPoint.prototype.m_tangentImpulse=null,b2ManifoldPoint.prototype.m_id=new b2ContactID;var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype),b2PolygonShape.prototype._super=b2Shape.prototype,b2PolygonShape.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.m_type=b2Shape.e_polygonShape,this.m_centroid=new b2Vec2,this.m_vertices=new Array,this.m_normals=new Array},b2PolygonShape.prototype.__varz=function(){},b2PolygonShape.AsArray=function(a,b){var c=new b2PolygonShape;return c.SetAsArray(a,b),c},b2PolygonShape.AsVector=function(a,b){var c=new b2PolygonShape;return c.SetAsVector(a,b),c},b2PolygonShape.AsBox=function(a,b){var c=new b2PolygonShape;return c.SetAsBox(a,b),c},b2PolygonShape.AsOrientedBox=function(a,b,c,d){var e=new b2PolygonShape;return e.SetAsOrientedBox(a,b,c,d),e},b2PolygonShape.AsEdge=function(a,b){var c=new b2PolygonShape;return c.SetAsEdge(a,b),c},b2PolygonShape.ComputeCentroid=function(a,b){for(var c=new b2Vec2,d=0,e=0,f=0,g=1/3,h=0;b>h;++h){var i=a[h],j=b>h+1?a[parseInt(h+1)]:a[0],k=i.x-e,l=i.y-f,m=j.x-e,n=j.y-f,o=k*n-l*m,p=.5*o;d+=p,c.x+=p*g*(e+i.x+j.x),c.y+=p*g*(f+i.y+j.y)}return c.x*=1/d,c.y*=1/d,c},b2PolygonShape.ComputeOBB=function(a,b,c){var d=0,e=new Array(c+1);for(d=0;c>d;++d)e[d]=b[d];e[c]=e[0];var f=Number.MAX_VALUE;for(d=1;c>=d;++d){var g=e[parseInt(d-1)],h=e[d].x-g.x,i=e[d].y-g.y,j=Math.sqrt(h*h+i*i);h/=j,i/=j;for(var k=-i,l=h,m=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,p=-Number.MAX_VALUE,q=0;c>q;++q){var r=e[q].x-g.x,s=e[q].y-g.y,t=h*r+i*s,u=k*r+l*s;m>t&&(m=t),n>u&&(n=u),t>o&&(o=t),u>p&&(p=u)}var v=(o-m)*(p-n);if(.95*f>v){f=v,a.R.col1.x=h,a.R.col1.y=i,a.R.col2.x=k,a.R.col2.y=l;var w=.5*(m+o),x=.5*(n+p),y=a.R;a.center.x=g.x+(y.col1.x*w+y.col2.x*x),a.center.y=g.y+(y.col1.y*w+y.col2.y*x),a.extents.x=.5*(o-m),a.extents.y=.5*(p-n)}}},b2PolygonShape.s_mat=new b2Mat22,b2PolygonShape.prototype.Validate=function(){return!1},b2PolygonShape.prototype.Reserve=function(a){for(var b=this.m_vertices.length;a>b;b++)this.m_vertices[b]=new b2Vec2,this.m_normals[b]=new b2Vec2},b2PolygonShape.prototype.Copy=function(){var a=new b2PolygonShape;return a.Set(this),a},b2PolygonShape.prototype.Set=function(a){if(this._super.Set.apply(this,[a]),isInstanceOf(a,b2PolygonShape)){var b=a;this.m_centroid.SetV(b.m_centroid),this.m_vertexCount=b.m_vertexCount,this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),this.m_normals[c].SetV(b.m_normals[c])}},b2PolygonShape.prototype.SetAsArray=function(a,b){for(var c=new Array,d=0,e=null;d<a.length,e=a[d];d++)c.push(e);this.SetAsVector(c,b)},b2PolygonShape.prototype.SetAsVector=function(a,b){"undefined"==typeof b&&(b=a.length),b2Settings.b2Assert(b>=2),this.m_vertexCount=b,this.Reserve(b);var c=0;for(c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(a[c]);for(c=0;c<this.m_vertexCount;++c){var d=c,e=c+1<this.m_vertexCount?c+1:0,f=b2Math.SubtractVV(this.m_vertices[e],this.m_vertices[d]);b2Settings.b2Assert(f.LengthSquared()>Number.MIN_VALUE),this.m_normals[c].SetV(b2Math.CrossVF(f,1)),this.m_normals[c].Normalize()}this.m_centroid=b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},b2PolygonShape.prototype.SetAsBox=function(a,b){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},b2PolygonShape.prototype.SetAsOrientedBox=function(a,b,c,d){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c;var e=new b2Transform;e.position=c,e.R.Set(d);for(var f=0;f<this.m_vertexCount;++f)this.m_vertices[f]=b2Math.MulX(e,this.m_vertices[f]),this.m_normals[f]=b2Math.MulMV(e.R,this.m_normals[f])},b2PolygonShape.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y),this.m_normals[0]=b2Math.CrossVF(b2Math.SubtractVV(b,a),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},b2PolygonShape.prototype.TestPoint=function(a,b){for(var c,d=a.R,e=b.x-a.position.x,f=b.y-a.position.y,g=e*d.col1.x+f*d.col1.y,h=e*d.col2.x+f*d.col2.y,i=0;i<this.m_vertexCount;++i){c=this.m_vertices[i],e=g-c.x,f=h-c.y,c=this.m_normals[i];var j=c.x*e+c.y*f;if(j>0)return!1}return!0},b2PolygonShape.prototype.RayCast=function(a,b,c){var d,e,f,g,h=0,i=b.maxFraction;d=b.p1.x-c.position.x,e=b.p1.y-c.position.y,f=c.R;var j=d*f.col1.x+e*f.col1.y,k=d*f.col2.x+e*f.col2.y;d=b.p2.x-c.position.x,e=b.p2.y-c.position.y,f=c.R;for(var l=d*f.col1.x+e*f.col1.y,m=d*f.col2.x+e*f.col2.y,n=l-j,o=m-k,p=-1,q=0;q<this.m_vertexCount;++q){g=this.m_vertices[q],d=g.x-j,e=g.y-k,g=this.m_normals[q];var r=g.x*d+g.y*e,s=g.x*n+g.y*o;if(0==s){if(0>r)return!1;
}else 0>s&&h*s>r?(h=r/s,p=q):s>0&&i*s>r&&(i=r/s);if(i<h-Number.MIN_VALUE)return!1}return p>=0?(a.fraction=h,f=c.R,g=this.m_normals[p],a.normal.x=f.col1.x*g.x+f.col2.x*g.y,a.normal.y=f.col1.y*g.x+f.col2.y*g.y,!0):!1},b2PolygonShape.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],e=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),f=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=e,h=f,i=1;i<this.m_vertexCount;++i){d=this.m_vertices[i];var j=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),k=b.position.y+(c.col1.y*d.x+c.col2.y*d.y);e=j>e?e:j,f=k>f?f:k,g=g>j?g:j,h=h>k?h:k}a.lowerBound.x=e-this.m_radius,a.lowerBound.y=f-this.m_radius,a.upperBound.x=g+this.m_radius,a.upperBound.y=h+this.m_radius},b2PolygonShape.prototype.ComputeMass=function(a,b){if(2==this.m_vertexCount)return a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,void(a.I=0);for(var c=0,d=0,e=0,f=0,g=0,h=0,i=1/3,j=0;j<this.m_vertexCount;++j){var k=this.m_vertices[j],l=j+1<this.m_vertexCount?this.m_vertices[parseInt(j+1)]:this.m_vertices[0],m=k.x-g,n=k.y-h,o=l.x-g,p=l.y-h,q=m*p-n*o,r=.5*q;e+=r,c+=r*i*(g+k.x+l.x),d+=r*i*(h+k.y+l.y);var s=g,t=h,u=m,v=n,w=o,x=p,y=i*(.25*(u*u+w*u+w*w)+(s*u+s*w))+.5*s*s,z=i*(.25*(v*v+x*v+x*x)+(t*v+t*x))+.5*t*t;f+=q*(y+z)}a.mass=b*e,c*=1/e,d*=1/e,a.center.Set(c,d),a.I=b*f},b2PolygonShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=b2Math.MulTMV(c.R,a),f=b-b2Math.Dot(a,c.position),g=new Array,h=0,i=-1,j=-1,k=!1,l=0;for(l=0;l<this.m_vertexCount;++l){g[l]=b2Math.Dot(e,this.m_vertices[l])-f;var m=g[l]<-Number.MIN_VALUE;l>0&&(m?k||(i=l-1,h++):k&&(j=l-1,h++)),k=m}switch(h){case 0:if(k){var n=new b2MassData;return this.ComputeMass(n,1),d.SetV(b2Math.MulX(c,n.center)),n.mass}return 0;case 1:-1==i?i=this.m_vertexCount-1:j=this.m_vertexCount-1}var o,p=(i+1)%this.m_vertexCount,q=(j+1)%this.m_vertexCount,r=(0-g[i])/(g[p]-g[i]),s=(0-g[j])/(g[q]-g[j]),t=new b2Vec2(this.m_vertices[i].x*(1-r)+this.m_vertices[p].x*r,this.m_vertices[i].y*(1-r)+this.m_vertices[p].y*r),u=new b2Vec2(this.m_vertices[j].x*(1-s)+this.m_vertices[q].x*s,this.m_vertices[j].y*(1-s)+this.m_vertices[q].y*s),v=0,w=new b2Vec2,x=this.m_vertices[p];for(l=p;l!=q;){l=(l+1)%this.m_vertexCount,o=l==q?u:this.m_vertices[l];var y=.5*((x.x-t.x)*(o.y-t.y)-(x.y-t.y)*(o.x-t.x));v+=y,w.x+=y*(t.x+x.x+o.x)/3,w.y+=y*(t.y+x.y+o.y)/3,x=o}return w.Multiply(1/v),d.SetV(b2Math.MulX(c,w)),v},b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},b2PolygonShape.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},b2PolygonShape.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},b2PolygonShape.prototype.m_centroid=null,b2PolygonShape.prototype.m_vertices=null,b2PolygonShape.prototype.m_normals=null,b2PolygonShape.prototype.m_vertexCount=0;var b2Fixture=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Fixture.prototype.__constructor=function(){this.m_aabb=new b2AABB,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},b2Fixture.prototype.__varz=function(){this.m_filter=new b2FilterData},b2Fixture.prototype.Create=function(a,b,c){this.m_userData=c.userData,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_body=a,this.m_next=null,this.m_filter=c.filter.Copy(),this.m_isSensor=c.isSensor,this.m_shape=c.shape.Copy(),this.m_density=c.density},b2Fixture.prototype.Destroy=function(){this.m_shape=null},b2Fixture.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},b2Fixture.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},b2Fixture.prototype.Synchronize=function(a,b,c){if(this.m_proxy){var d=new b2AABB,e=new b2AABB;this.m_shape.ComputeAABB(d,b),this.m_shape.ComputeAABB(e,c),this.m_aabb.Combine(d,e);var f=b2Math.SubtractVV(c.position,b.position);a.MoveProxy(this.m_proxy,this.m_aabb,f)}},b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},b2Fixture.prototype.GetShape=function(){return this.m_shape},b2Fixture.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d==this||e==this)&&c.SetSensor(d.IsSensor()||e.IsSensor()),b=b.next}},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},b2Fixture.prototype.SetFilterData=function(a){if(this.m_filter=a.Copy(),!this.m_body)for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d==this||e==this)&&c.FlagForFiltering(),b=b.next}},b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},b2Fixture.prototype.GetBody=function(){return this.m_body},b2Fixture.prototype.GetNext=function(){return this.m_next},b2Fixture.prototype.GetUserData=function(){return this.m_userData},b2Fixture.prototype.SetUserData=function(a){this.m_userData=a},b2Fixture.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},b2Fixture.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},b2Fixture.prototype.GetMassData=function(a){return null==a&&(a=new b2MassData),this.m_shape.ComputeMass(a,this.m_density),a},b2Fixture.prototype.SetDensity=function(a){this.m_density=a},b2Fixture.prototype.GetDensity=function(){return this.m_density},b2Fixture.prototype.GetFriction=function(){return this.m_friction},b2Fixture.prototype.SetFriction=function(a){this.m_friction=a},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},b2Fixture.prototype.SetRestitution=function(a){this.m_restitution=a},b2Fixture.prototype.GetAABB=function(){return this.m_aabb},b2Fixture.prototype.m_massData=null,b2Fixture.prototype.m_aabb=null,b2Fixture.prototype.m_density=null,b2Fixture.prototype.m_next=null,b2Fixture.prototype.m_body=null,b2Fixture.prototype.m_shape=null,b2Fixture.prototype.m_friction=null,b2Fixture.prototype.m_restitution=null,b2Fixture.prototype.m_proxy=null,b2Fixture.prototype.m_filter=new b2FilterData,b2Fixture.prototype.m_isSensor=null,b2Fixture.prototype.m_userData=null;var b2DynamicTreeNode=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeNode.prototype.__constructor=function(){},b2DynamicTreeNode.prototype.__varz=function(){this.aabb=new b2AABB},b2DynamicTreeNode.prototype.IsLeaf=function(){return null==this.child1},b2DynamicTreeNode.prototype.userData=null,b2DynamicTreeNode.prototype.aabb=new b2AABB,b2DynamicTreeNode.prototype.parent=null,b2DynamicTreeNode.prototype.child1=null,b2DynamicTreeNode.prototype.child2=null;var b2BodyDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BodyDef.prototype.__constructor=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=b2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},b2BodyDef.prototype.__varz=function(){this.position=new b2Vec2,this.linearVelocity=new b2Vec2},b2BodyDef.prototype.type=0,b2BodyDef.prototype.position=new b2Vec2,b2BodyDef.prototype.angle=null,b2BodyDef.prototype.linearVelocity=new b2Vec2,b2BodyDef.prototype.angularVelocity=null,b2BodyDef.prototype.linearDamping=null,b2BodyDef.prototype.angularDamping=null,b2BodyDef.prototype.allowSleep=null,b2BodyDef.prototype.awake=null,b2BodyDef.prototype.fixedRotation=null,b2BodyDef.prototype.bullet=null,b2BodyDef.prototype.active=null,b2BodyDef.prototype.userData=null,b2BodyDef.prototype.inertiaScale=null;var b2DynamicTreeBroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeBroadPhase.prototype.__constructor=function(){},b2DynamicTreeBroadPhase.prototype.__varz=function(){this.m_tree=new b2DynamicTree,this.m_moveBuffer=new Array,this.m_pairBuffer=new Array},b2DynamicTreeBroadPhase.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(a){var b=this.m_moveBuffer.indexOf(a);this.m_moveBuffer.splice(b,1)},b2DynamicTreeBroadPhase.prototype.ComparePairs=function(a,b){return 0},b2DynamicTreeBroadPhase.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return++this.m_proxyCount,this.BufferMove(c),c},b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(a){this.UnBufferMove(a),--this.m_proxyCount,this.m_tree.DestroyProxy(a)},b2DynamicTreeBroadPhase.prototype.MoveProxy=function(a,b,c){var d=this.m_tree.MoveProxy(a,b,c);d&&this.BufferMove(a)},b2DynamicTreeBroadPhase.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},b2DynamicTreeBroadPhase.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)},b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(a){function b(a){if(a==d)return!0;e.m_pairCount==e.m_pairBuffer.length&&(e.m_pairBuffer[e.m_pairCount]=new b2DynamicTreePair);var b=e.m_pairBuffer[e.m_pairCount];return b.proxyA=d>a?a:d,b.proxyB=a>=d?a:d,++e.m_pairCount,!0}this.m_pairCount=0;for(var c=0,d=null;c<this.m_moveBuffer.length,d=this.m_moveBuffer[c];c++){var e=this,f=this.m_tree.GetFatAABB(d);this.m_tree.Query(b,f)}this.m_moveBuffer.length=0;for(var c=0;c<this.m_pairCount;){var g=this.m_pairBuffer[c],h=this.m_tree.GetUserData(g.proxyA),i=this.m_tree.GetUserData(g.proxyB);for(a(h,i),++c;c<this.m_pairCount;){var j=this.m_pairBuffer[c];if(j.proxyA!=g.proxyA||j.proxyB!=g.proxyB)break;++c}}},b2DynamicTreeBroadPhase.prototype.Query=function(a,b){this.m_tree.Query(a,b)},b2DynamicTreeBroadPhase.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},b2DynamicTreeBroadPhase.prototype.Validate=function(){},b2DynamicTreeBroadPhase.prototype.Rebalance=function(a){this.m_tree.Rebalance(a)},b2DynamicTreeBroadPhase.prototype.m_tree=new b2DynamicTree,b2DynamicTreeBroadPhase.prototype.m_proxyCount=0,b2DynamicTreeBroadPhase.prototype.m_moveBuffer=new Array,b2DynamicTreeBroadPhase.prototype.m_pairBuffer=new Array,b2DynamicTreeBroadPhase.prototype.m_pairCount=0;var b2BroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BroadPhase.prototype.__constructor=function(a){var b=0;for(this.m_pairManager.Initialize(this),this.m_worldAABB=a,this.m_proxyCount=0,this.m_bounds=new Array,b=0;2>b;b++)this.m_bounds[b]=new Array;var c=a.upperBound.x-a.lowerBound.x,d=a.upperBound.y-a.lowerBound.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/c,this.m_quantizationFactor.y=b2Settings.USHRT_MAX/d,this.m_timeStamp=1,this.m_queryResultCount=0},b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager,this.m_proxyPool=new Array,this.m_querySortKeys=new Array,this.m_queryResults=new Array,this.m_quantizationFactor=new b2Vec2},b2BroadPhase.BinarySearch=function(a,b,c){for(var d=0,e=b-1;e>=d;){var f=Math.round((d+e)/2),g=a[f];if(g.value>c)e=f-1;else{if(!(g.value<c))return parseInt(f);d=f+1}}return parseInt(d)},b2BroadPhase.s_validate=!1,b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX,b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX,b2BroadPhase.prototype.ComputeBounds=function(a,b,c){var d=c.lowerBound.x,e=c.lowerBound.y;d=b2Math.Min(d,this.m_worldAABB.upperBound.x),e=b2Math.Min(e,this.m_worldAABB.upperBound.y),d=b2Math.Max(d,this.m_worldAABB.lowerBound.x),e=b2Math.Max(e,this.m_worldAABB.lowerBound.y);var f=c.upperBound.x,g=c.upperBound.y;f=b2Math.Min(f,this.m_worldAABB.upperBound.x),g=b2Math.Min(g,this.m_worldAABB.upperBound.y),f=b2Math.Max(f,this.m_worldAABB.lowerBound.x),g=b2Math.Max(g,this.m_worldAABB.lowerBound.y),a[0]=parseInt(this.m_quantizationFactor.x*(d-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1,b[0]=parseInt(this.m_quantizationFactor.x*(f-this.m_worldAABB.lowerBound.x))%65535|1,a[1]=parseInt(this.m_quantizationFactor.y*(e-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1,b[1]=parseInt(this.m_quantizationFactor.y*(g-this.m_worldAABB.lowerBound.y))%65535|1},b2BroadPhase.prototype.TestOverlapValidate=function(a,b){for(var c=0;2>c;++c){var d=this.m_bounds[c],e=d[a.lowerBounds[c]],f=d[b.upperBounds[c]];if(e.value>f.value)return!1;if(e=d[a.upperBounds[c]],f=d[b.lowerBounds[c]],e.value<f.value)return!1}return!0},b2BroadPhase.prototype.QueryAxis=function(a,b,c,d,e,f,g){for(var h,i=b2BroadPhase.BinarySearch(e,f,c),j=b2BroadPhase.BinarySearch(e,f,d),k=i;j>k;++k)h=e[k],h.IsLower()&&this.IncrementOverlapCount(h.proxy);if(i>0){var l=i-1;h=e[l];for(var m=h.stabbingCount;m;){if(h=e[l],h.IsLower()){var n=h.proxy;i<=n.upperBounds[g]&&(this.IncrementOverlapCount(h.proxy),--m)}--l}}a[0]=i,b[0]=j},b2BroadPhase.prototype.IncrementOverlapCount=function(a){a.timeStamp<this.m_timeStamp?(a.timeStamp=this.m_timeStamp,a.overlapCount=1):(a.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=a,++this.m_queryResultCount)},b2BroadPhase.prototype.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var a=0;a<this.m_proxyPool.length;++a)this.m_proxyPool[a].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},b2BroadPhase.prototype.InRange=function(a){var b,c,d,e;return b=a.lowerBound.x,c=a.lowerBound.y,b-=this.m_worldAABB.upperBound.x,c-=this.m_worldAABB.upperBound.y,d=this.m_worldAABB.lowerBound.x,e=this.m_worldAABB.lowerBound.y,d-=a.upperBound.x,e-=a.upperBound.y,b=b2Math.Max(b,d),c=b2Math.Max(c,e),b2Math.Max(b,c)<0},b2BroadPhase.prototype.CreateProxy=function(a,b){var c,d=0,e=0,f=0;if(!this.m_freeProxy)for(this.m_freeProxy=this.m_proxyPool[this.m_proxyCount]=new b2Proxy,this.m_freeProxy.next=null,this.m_freeProxy.timeStamp=0,this.m_freeProxy.overlapCount=b2BroadPhase.b2_invalid,this.m_freeProxy.userData=null,e=0;2>e;e++)f=2*this.m_proxyCount,this.m_bounds[e][f++]=new b2Bound,this.m_bounds[e][f]=new b2Bound;c=this.m_freeProxy,this.m_freeProxy=c.next,c.overlapCount=0,c.userData=b;var g=2*this.m_proxyCount,h=new Array,i=new Array;this.ComputeBounds(h,i,a);for(var j=0;2>j;++j){var k=this.m_bounds[j],l=0,m=0,n=new Array;n.push(l);var o=new Array;o.push(m),this.QueryAxis(n,o,h[j],i[j],k,g,j),l=n[0],m=o[0],k.splice(m,0,k[k.length-1]),k.length--,k.splice(l,0,k[k.length-1]),k.length--,++m;var p=k[l],q=k[m];p.value=h[j],p.proxy=c,q.value=i[j],q.proxy=c;var r=k[parseInt(l-1)];for(p.stabbingCount=0==l?0:r.stabbingCount,r=k[parseInt(m-1)],q.stabbingCount=r.stabbingCount,d=l;m>d;++d)r=k[d],r.stabbingCount++;for(d=l;g+2>d;++d){p=k[d];var s=p.proxy;p.IsLower()?s.lowerBounds[j]=d:s.upperBounds[j]=d}}for(++this.m_proxyCount,e=0;e<this.m_queryResultCount;++e)this.m_pairManager.AddBufferedPair(c,this.m_queryResults[e]);return this.m_queryResultCount=0,this.IncrementTimeStamp(),c},b2BroadPhase.prototype.DestroyProxy=function(a){for(var b,c,d=a,e=2*this.m_proxyCount,f=0;2>f;++f){var g=this.m_bounds[f],h=d.lowerBounds[f],i=d.upperBounds[f];b=g[h];var j=b.value;c=g[i];var k=c.value;g.splice(i,1),g.splice(h,1),g.push(b),g.push(c);for(var l=e-2,m=h;l>m;++m){b=g[m];var n=b.proxy;b.IsLower()?n.lowerBounds[f]=m:n.upperBounds[f]=m}l=i-1;for(var o=h;l>o;++o)b=g[o],b.stabbingCount--;var p=new Array;this.QueryAxis(p,p,j,k,g,e-2,f)}for(var q=0;q<this.m_queryResultCount;++q)this.m_pairManager.RemoveBufferedPair(d,this.m_queryResults[q]);this.m_queryResultCount=0,this.IncrementTimeStamp(),d.userData=null,d.overlapCount=b2BroadPhase.b2_invalid,d.lowerBounds[0]=b2BroadPhase.b2_invalid,d.lowerBounds[1]=b2BroadPhase.b2_invalid,d.upperBounds[0]=b2BroadPhase.b2_invalid,d.upperBounds[1]=b2BroadPhase.b2_invalid,d.next=this.m_freeProxy,this.m_freeProxy=d,--this.m_proxyCount},b2BroadPhase.prototype.MoveProxy=function(a,b,c){var d,e,f,g,h,i=a,j=0,k=0,l=0;if(null!=i&&0!=b.IsValid()){var m=2*this.m_proxyCount,n=new b2BoundValues;this.ComputeBounds(n.lowerValues,n.upperValues,b);var o=new b2BoundValues;for(k=0;2>k;++k)e=this.m_bounds[k][i.lowerBounds[k]],o.lowerValues[k]=e.value,e=this.m_bounds[k][i.upperBounds[k]],o.upperValues[k]=e.value;for(k=0;2>k;++k){var p=this.m_bounds[k],q=i.lowerBounds[k],r=i.upperBounds[k],s=n.lowerValues[k],t=n.upperValues[k];e=p[q];var u=s-e.value;e.value=s,e=p[r];var v=t-e.value;if(e.value=t,0>u)for(l=q;l>0&&s<p[parseInt(l-1)].value;){e=p[l],f=p[parseInt(l-1)];var w=f.proxy;f.stabbingCount++,1==f.IsUpper()?(this.TestOverlapBound(n,w)&&this.m_pairManager.AddBufferedPair(i,w),d=w.upperBounds,j=d[k],j++,d[k]=j,e.stabbingCount++):(d=w.lowerBounds,j=d[k],j++,d[k]=j,e.stabbingCount--),d=i.lowerBounds,j=d[k],j--,d[k]=j,e.Swap(f),--l}if(v>0)for(l=r;m-1>l&&p[parseInt(l+1)].value<=t;)e=p[l],g=p[parseInt(l+1)],h=g.proxy,g.stabbingCount++,1==g.IsLower()?(this.TestOverlapBound(n,h)&&this.m_pairManager.AddBufferedPair(i,h),d=h.lowerBounds,j=d[k],j--,d[k]=j,e.stabbingCount++):(d=h.upperBounds,j=d[k],j--,d[k]=j,e.stabbingCount--),d=i.upperBounds,j=d[k],j++,d[k]=j,e.Swap(g),l++;if(u>0)for(l=q;m-1>l&&p[parseInt(l+1)].value<=s;)e=p[l],g=p[parseInt(l+1)],h=g.proxy,g.stabbingCount--,g.IsUpper()?(this.TestOverlapBound(o,h)&&this.m_pairManager.RemoveBufferedPair(i,h),d=h.upperBounds,j=d[k],j--,d[k]=j,e.stabbingCount--):(d=h.lowerBounds,j=d[k],j--,d[k]=j,e.stabbingCount++),d=i.lowerBounds,j=d[k],j++,d[k]=j,e.Swap(g),l++;if(0>v)for(l=r;l>0&&t<p[parseInt(l-1)].value;)e=p[l],f=p[parseInt(l-1)],w=f.proxy,f.stabbingCount--,1==f.IsLower()?(this.TestOverlapBound(o,w)&&this.m_pairManager.RemoveBufferedPair(i,w),d=w.lowerBounds,j=d[k],j++,d[k]=j,e.stabbingCount--):(d=w.upperBounds,j=d[k],j++,d[k]=j,e.stabbingCount++),d=i.upperBounds,j=d[k],j--,d[k]=j,e.Swap(f),l--}}},b2BroadPhase.prototype.UpdatePairs=function(a){this.m_pairManager.Commit(a)},b2BroadPhase.prototype.TestOverlap=function(a,b){var c=a,d=b;return c.lowerBounds[0]>d.upperBounds[0]?!1:d.lowerBounds[0]>c.upperBounds[0]?!1:c.lowerBounds[1]>d.upperBounds[1]?!1:d.lowerBounds[1]>c.upperBounds[1]?!1:!0},b2BroadPhase.prototype.GetUserData=function(a){return a.userData},b2BroadPhase.prototype.GetFatAABB=function(a){var b=new b2AABB,c=a;return b.lowerBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][c.lowerBounds[0]].value/this.m_quantizationFactor.x,b.lowerBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][c.lowerBounds[1]].value/this.m_quantizationFactor.y,b.upperBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][c.upperBounds[0]].value/this.m_quantizationFactor.x,b.upperBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][c.upperBounds[1]].value/this.m_quantizationFactor.y,b},b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2BroadPhase.prototype.Query=function(a,b){var c=new Array,d=new Array;this.ComputeBounds(c,d,b);var e=0,f=0,g=new Array;g.push(e);var h=new Array;h.push(f),this.QueryAxis(g,h,c[0],d[0],this.m_bounds[0],2*this.m_proxyCount,0),this.QueryAxis(g,h,c[1],d[1],this.m_bounds[1],2*this.m_proxyCount,1);for(var i=0;i<this.m_queryResultCount;++i){var j=this.m_queryResults[i];if(!a(j))break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.Validate=function(){for(var a=0;2>a;++a)for(var b=this.m_bounds[a],c=2*this.m_proxyCount,d=0,e=0;c>e;++e){var f=b[e];1==f.IsLower()?d++:d--}},b2BroadPhase.prototype.Rebalance=function(a){},b2BroadPhase.prototype.RayCast=function(a,b){var c=new b2RayCastInput;c.p1.SetV(b.p1),c.p2.SetV(b.p2),c.maxFraction=b.maxFraction;var d=(b.p2.x-b.p1.x)*this.m_quantizationFactor.x,e=(b.p2.y-b.p1.y)*this.m_quantizationFactor.y,f=d<-Number.MIN_VALUE?-1:d>Number.MIN_VALUE?1:0,g=e<-Number.MIN_VALUE?-1:e>Number.MIN_VALUE?1:0,h=this.m_quantizationFactor.x*(b.p1.x-this.m_worldAABB.lowerBound.x),i=this.m_quantizationFactor.y*(b.p1.y-this.m_worldAABB.lowerBound.y),j=new Array,k=new Array;j[0]=parseInt(h)&b2Settings.USHRT_MAX-1,j[1]=parseInt(i)&b2Settings.USHRT_MAX-1,k[0]=j[0]+1,k[1]=j[1]+1;var l,m=(new Array,0),n=0,o=0,p=0,q=new Array;q.push(o);var r=new Array;r.push(p),this.QueryAxis(q,r,j[0],k[0],this.m_bounds[0],2*this.m_proxyCount,0),m=f>=0?r[0]-1:q[0],this.QueryAxis(q,r,j[1],k[1],this.m_bounds[1],2*this.m_proxyCount,1),n=g>=0?r[0]-1:q[0];for(var s=0;s<this.m_queryResultCount;s++)c.maxFraction=a(this.m_queryResults[s],c);for(;;){var t=0,u=0;if(m+=f>=0?1:-1,0>m||m>=2*this.m_proxyCount)break;if(0!=f&&(t=(this.m_bounds[0][m].value-h)/d),n+=g>=0?1:-1,0>n||n>=2*this.m_proxyCount)break;for(0!=g&&(u=(this.m_bounds[1][n].value-i)/e);;)if(0==g||0!=f&&u>t){if(t>c.maxFraction)break;if((f>0?this.m_bounds[0][m].IsLower():this.m_bounds[0][m].IsUpper())&&(l=this.m_bounds[0][m].proxy,g>=0?l.lowerBounds[1]<=n-1&&l.upperBounds[1]>=n&&(c.maxFraction=a(l,c)):l.lowerBounds[1]<=n&&l.upperBounds[1]>=n+1&&(c.maxFraction=a(l,c))),0==c.maxFraction)break;if(f>0){if(m++,m==2*this.m_proxyCount)break}else if(m--,0>m)break;t=(this.m_bounds[0][m].value-h)/d}else{if(u>c.maxFraction)break;if((g>0?this.m_bounds[1][n].IsLower():this.m_bounds[1][n].IsUpper())&&(l=this.m_bounds[1][n].proxy,f>=0?l.lowerBounds[0]<=m-1&&l.upperBounds[0]>=m&&(c.maxFraction=a(l,c)):l.lowerBounds[0]<=m&&l.upperBounds[0]>=m+1&&(c.maxFraction=a(l,c))),0==c.maxFraction)break;if(g>0){if(n++,n==2*this.m_proxyCount)break}else if(n--,0>n)break;u=(this.m_bounds[1][n].value-i)/e}break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.TestOverlapBound=function(a,b){for(var c=0;2>c;++c){var d=this.m_bounds[c],e=d[b.upperBounds[c]];if(a.lowerValues[c]>e.value)return!1;if(e=d[b.lowerBounds[c]],a.upperValues[c]<e.value)return!1}return!0},b2BroadPhase.prototype.m_pairManager=new b2PairManager,b2BroadPhase.prototype.m_proxyPool=new Array,b2BroadPhase.prototype.m_freeProxy=null,b2BroadPhase.prototype.m_bounds=null,b2BroadPhase.prototype.m_querySortKeys=new Array,b2BroadPhase.prototype.m_queryResults=new Array,b2BroadPhase.prototype.m_queryResultCount=0,b2BroadPhase.prototype.m_worldAABB=null,b2BroadPhase.prototype.m_quantizationFactor=new b2Vec2,b2BroadPhase.prototype.m_proxyCount=0,b2BroadPhase.prototype.m_timeStamp=0;var b2Manifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Manifold.prototype.__constructor=function(){this.m_points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2ManifoldPoint;this.m_localPlaneNormal=new b2Vec2,this.m_localPoint=new b2Vec2},b2Manifold.prototype.__varz=function(){},b2Manifold.e_circles=1,b2Manifold.e_faceA=2,b2Manifold.e_faceB=4,b2Manifold.prototype.Reset=function(){for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},b2Manifold.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.m_points[b].Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},b2Manifold.prototype.Copy=function(){var a=new b2Manifold;return a.Set(this),a},b2Manifold.prototype.m_points=null,b2Manifold.prototype.m_localPlaneNormal=null,b2Manifold.prototype.m_localPoint=null,b2Manifold.prototype.m_type=0,b2Manifold.prototype.m_pointCount=0;var b2CircleShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype),b2CircleShape.prototype._super=b2Shape.prototype,b2CircleShape.prototype.__constructor=function(a){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_circleShape,this.m_radius=a},b2CircleShape.prototype.__varz=function(){this.m_p=new b2Vec2},b2CircleShape.prototype.Copy=function(){var a=new b2CircleShape;return a.Set(this),a},b2CircleShape.prototype.Set=function(a){if(this._super.Set.apply(this,[a]),isInstanceOf(a,b2CircleShape)){var b=a;this.m_p.SetV(b.m_p)}},b2CircleShape.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);return d=b.x-d,e=b.y-e,d*d+e*e<=this.m_radius*this.m_radius},b2CircleShape.prototype.RayCast=function(a,b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),f=c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y),g=b.p1.x-e,h=b.p1.y-f,i=g*g+h*h-this.m_radius*this.m_radius,j=b.p2.x-b.p1.x,k=b.p2.y-b.p1.y,l=g*j+h*k,m=j*j+k*k,n=l*l-m*i;if(0>n||m<Number.MIN_VALUE)return!1;var o=-(l+Math.sqrt(n));return o>=0&&o<=b.maxFraction*m?(o/=m,a.fraction=o,a.normal.x=g+o*j,a.normal.y=h+o*k,a.normal.Normalize(),!0):!1},b2CircleShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,e-this.m_radius),a.upperBound.Set(d+this.m_radius,e+this.m_radius)},b2CircleShape.prototype.ComputeMass=function(a,b){a.mass=b*b2Settings.b2_pi*this.m_radius*this.m_radius,a.center.SetV(this.m_p),a.I=a.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b2CircleShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=b2Math.MulX(c,this.m_p),f=-(b2Math.Dot(a,e)-b);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return d.SetV(e),Math.PI*this.m_radius*this.m_radius;var g=this.m_radius*this.m_radius,h=f*f,i=g*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(g-h),j=-2/3*Math.pow(g-h,1.5)/i;return d.x=e.x+a.x*j,d.y=e.y+a.y*j,i},b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},b2CircleShape.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},b2CircleShape.prototype.GetRadius=function(){return this.m_radius},b2CircleShape.prototype.SetRadius=function(a){this.m_radius=a},b2CircleShape.prototype.m_p=new b2Vec2;var b2Joint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(a){b2Settings.b2Assert(a.bodyA!=a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},b2Joint.prototype.__varz=function(){this.m_edgeA=new b2JointEdge,this.m_edgeB=new b2JointEdge,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2},b2Joint.Create=function(a,b){var c=null;switch(a.type){case b2Joint.e_distanceJoint:c=new b2DistanceJoint(a);break;case b2Joint.e_mouseJoint:c=new b2MouseJoint(a);break;case b2Joint.e_prismaticJoint:c=new b2PrismaticJoint(a);break;case b2Joint.e_revoluteJoint:c=new b2RevoluteJoint(a);break;case b2Joint.e_pulleyJoint:c=new b2PulleyJoint(a);break;case b2Joint.e_gearJoint:c=new b2GearJoint(a);break;case b2Joint.e_lineJoint:c=new b2LineJoint(a);break;case b2Joint.e_weldJoint:c=new b2WeldJoint(a);break;case b2Joint.e_frictionJoint:c=new b2FrictionJoint(a)}return c},b2Joint.Destroy=function(a,b){},b2Joint.e_unknownJoint=0,b2Joint.e_revoluteJoint=1,b2Joint.e_prismaticJoint=2,b2Joint.e_distanceJoint=3,b2Joint.e_pulleyJoint=4,b2Joint.e_mouseJoint=5,b2Joint.e_gearJoint=6,b2Joint.e_lineJoint=7,b2Joint.e_weldJoint=8,b2Joint.e_frictionJoint=9,b2Joint.e_inactiveLimit=0,b2Joint.e_atLowerLimit=1,b2Joint.e_atUpperLimit=2,b2Joint.e_equalLimits=3,b2Joint.prototype.InitVelocityConstraints=function(a){},b2Joint.prototype.SolveVelocityConstraints=function(a){},b2Joint.prototype.FinalizeVelocityConstraints=function(){},b2Joint.prototype.SolvePositionConstraints=function(a){return!1},b2Joint.prototype.GetType=function(){return this.m_type},b2Joint.prototype.GetAnchorA=function(){return null},b2Joint.prototype.GetAnchorB=function(){return null},b2Joint.prototype.GetReactionForce=function(a){return null},b2Joint.prototype.GetReactionTorque=function(a){return 0},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},b2Joint.prototype.GetNext=function(){return this.m_next},b2Joint.prototype.GetUserData=function(){return this.m_userData},b2Joint.prototype.SetUserData=function(a){this.m_userData=a},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},b2Joint.prototype.m_type=0,b2Joint.prototype.m_prev=null,b2Joint.prototype.m_next=null,b2Joint.prototype.m_edgeA=new b2JointEdge,b2Joint.prototype.m_edgeB=new b2JointEdge,b2Joint.prototype.m_bodyA=null,b2Joint.prototype.m_bodyB=null,b2Joint.prototype.m_islandFlag=null,b2Joint.prototype.m_collideConnected=null,b2Joint.prototype.m_userData=null,b2Joint.prototype.m_localCenterA=new b2Vec2,b2Joint.prototype.m_localCenterB=new b2Vec2,b2Joint.prototype.m_invMassA=null,b2Joint.prototype.m_invMassB=null,b2Joint.prototype.m_invIA=null,b2Joint.prototype.m_invIB=null;var b2LineJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJoint.prototype,b2Joint.prototype),b2LineJoint.prototype._super=b2Joint.prototype,b2LineJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2LineJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat22,this.m_impulse=new b2Vec2},b2LineJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_localCenterA.SetV(d.GetLocalCenter()),this.m_localCenterB.SetV(e.GetLocalCenter());var f=d.GetTransform();e.GetTransform();b=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=e.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c;var k=e.m_sweep.c.x+i-d.m_sweep.c.x-g,l=e.m_sweep.c.y+j-d.m_sweep.c.y-h;this.m_invMassA=d.m_invMass,this.m_invMassB=e.m_invMass,this.m_invIA=d.m_invI,this.m_invIB=e.m_invI,this.m_axis.SetV(b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(k+g)*this.m_axis.y-(l+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(k+g)*this.m_perp.y-(l+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x;var m=this.m_invMassA,n=this.m_invMassB,o=this.m_invIA,p=this.m_invIB;if(this.m_K.col1.x=m+n+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+n+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var q=this.m_axis.x*k+this.m_axis.y*l;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,
this.m_impulse.y=0):q>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var r=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,t=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,u=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;d.m_linearVelocity.x-=this.m_invMassA*r,d.m_linearVelocity.y-=this.m_invMassA*s,d.m_angularVelocity-=this.m_invIA*t,e.m_linearVelocity.x+=this.m_invMassB*r,e.m_linearVelocity.y+=this.m_invMassB*s,e.m_angularVelocity+=this.m_invIB*u}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2LineJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f=this.m_bodyA,g=this.m_bodyB,h=f.m_linearVelocity,i=f.m_angularVelocity,j=g.m_linearVelocity,k=g.m_angularVelocity;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var l=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,m=this.m_motorMass*(this.m_motorSpeed-l),n=this.m_motorImpulse,o=a.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+m,-o,o),m=this.m_motorImpulse-n,b=m*this.m_axis.x,c=m*this.m_axis.y,d=m*this.m_a1,e=m*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}var p=this.m_perp.x*(j.x-h.x)+this.m_perp.y*(j.y-h.y)+this.m_s2*k-this.m_s1*i;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var q=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,r=this.m_impulse.Copy(),s=this.m_K.Solve(new b2Vec2,-p,-q);this.m_impulse.Add(s),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.y=b2Math.Max(this.m_impulse.y,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.y=b2Math.Min(this.m_impulse.y,0));var t,u=-p-(this.m_impulse.y-r.y)*this.m_K.col2.x;t=0!=this.m_K.col1.x?u/this.m_K.col1.x+r.x:r.x,this.m_impulse.x=t,s.x=this.m_impulse.x-r.x,s.y=this.m_impulse.y-r.y,b=s.x*this.m_perp.x+s.y*this.m_axis.x,c=s.x*this.m_perp.y+s.y*this.m_axis.y,d=s.x*this.m_s1+s.y*this.m_a1,e=s.x*this.m_s2+s.y*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}else{var v;v=0!=this.m_K.col1.x?-p/this.m_K.col1.x:0,this.m_impulse.x+=v,b=v*this.m_perp.x,c=v*this.m_perp.y,d=v*this.m_s1,e=v*this.m_s2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}f.m_linearVelocity.SetV(h),f.m_angularVelocity=i,g.m_linearVelocity.SetV(j),g.m_angularVelocity=k},b2LineJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g,h=this.m_bodyA,i=this.m_bodyB,j=h.m_sweep.c,k=h.m_sweep.a,l=i.m_sweep.c,m=i.m_sweep.a,n=0,o=0,p=!1,q=0,r=b2Mat22.FromAngle(k),s=b2Mat22.FromAngle(m);b=r;var t=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*t+b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=c,b=s;var v=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=c;var x=l.x+v-j.x-t,y=l.y+w-j.y-u;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(r,this.m_localXAxis1),this.m_a1=(x+t)*this.m_axis.y-(y+u)*this.m_axis.x,this.m_a2=v*this.m_axis.y-w*this.m_axis.x;var z=this.m_axis.x*x+this.m_axis.y*y;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(q=b2Math.Clamp(z,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),n=b2Math.Abs(z),p=!0):z<=this.m_lowerTranslation?(q=b2Math.Clamp(z-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-z,p=!0):z>=this.m_upperTranslation&&(q=b2Math.Clamp(z-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),n=z-this.m_upperTranslation,p=!0)}this.m_perp=b2Math.MulMV(r,this.m_localYAxis1),this.m_s1=(x+t)*this.m_perp.y-(y+u)*this.m_perp.x,this.m_s2=v*this.m_perp.y-w*this.m_perp.x;var A=new b2Vec2,B=this.m_perp.x*x+this.m_perp.y*y;if(n=b2Math.Max(n,b2Math.Abs(B)),o=0,p)d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+e+f*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve(A,-B,-q);else{d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB;var C,D=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2;C=0!=D?-B/D:0,A.x=C,A.y=0}var E=A.x*this.m_perp.x+A.y*this.m_axis.x,F=A.x*this.m_perp.y+A.y*this.m_axis.y,G=A.x*this.m_s1+A.y*this.m_a1,H=A.x*this.m_s2+A.y*this.m_a2;return j.x-=this.m_invMassA*E,j.y-=this.m_invMassA*F,k-=this.m_invIA*G,l.x+=this.m_invMassB*E,l.y+=this.m_invMassB*F,m+=this.m_invIB*H,h.m_sweep.a=k,i.m_sweep.a=m,h.SynchronizeTransform(),i.SynchronizeTransform(),n<=b2Settings.b2_linearSlop&&o<=b2Settings.b2_angularSlop},b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2LineJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},b2LineJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},b2LineJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1),h=g.x*e+g.y*f;return h},b2LineJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity,t=m*-r*o.y+n*r*o.x+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d));return t},b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2LineJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2LineJoint.prototype.SetLimits=function(a,b){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2LineJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},b2LineJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2LineJoint.prototype.SetMaxMotorForce=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2LineJoint.prototype.m_localAnchor1=new b2Vec2,b2LineJoint.prototype.m_localAnchor2=new b2Vec2,b2LineJoint.prototype.m_localXAxis1=new b2Vec2,b2LineJoint.prototype.m_localYAxis1=new b2Vec2,b2LineJoint.prototype.m_axis=new b2Vec2,b2LineJoint.prototype.m_perp=new b2Vec2,b2LineJoint.prototype.m_s1=null,b2LineJoint.prototype.m_s2=null,b2LineJoint.prototype.m_a1=null,b2LineJoint.prototype.m_a2=null,b2LineJoint.prototype.m_K=new b2Mat22,b2LineJoint.prototype.m_impulse=new b2Vec2,b2LineJoint.prototype.m_motorMass=null,b2LineJoint.prototype.m_motorImpulse=null,b2LineJoint.prototype.m_lowerTranslation=null,b2LineJoint.prototype.m_upperTranslation=null,b2LineJoint.prototype.m_maxMotorForce=null,b2LineJoint.prototype.m_motorSpeed=null,b2LineJoint.prototype.m_enableLimit=null,b2LineJoint.prototype.m_enableMotor=null,b2LineJoint.prototype.m_limitState=0;var b2ContactSolver=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactSolver.prototype.__constructor=function(){},b2ContactSolver.prototype.__varz=function(){this.m_step=new b2TimeStep,this.m_constraints=new Array},b2ContactSolver.s_worldManifold=new b2WorldManifold,b2ContactSolver.s_psm=new b2PositionSolverManifold,b2ContactSolver.prototype.Initialize=function(a,b,c,d){var e;this.m_step.Set(a),this.m_allocator=d;var f=0;for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b2ContactConstraint;for(f=0;c>f;++f){e=b[f];var g=e.m_fixtureA,h=e.m_fixtureB,i=g.m_shape,j=h.m_shape,k=i.m_radius,l=j.m_radius,m=g.m_body,n=h.m_body,o=e.GetManifold(),p=b2Settings.b2MixFriction(g.GetFriction(),h.GetFriction()),q=b2Settings.b2MixRestitution(g.GetRestitution(),h.GetRestitution()),r=m.m_linearVelocity.x,s=m.m_linearVelocity.y,t=n.m_linearVelocity.x,u=n.m_linearVelocity.y,v=m.m_angularVelocity,w=n.m_angularVelocity;b2Settings.b2Assert(o.m_pointCount>0),b2ContactSolver.s_worldManifold.Initialize(o,m.m_xf,k,n.m_xf,l);var x=b2ContactSolver.s_worldManifold.m_normal.x,y=b2ContactSolver.s_worldManifold.m_normal.y,z=this.m_constraints[f];z.bodyA=m,z.bodyB=n,z.manifold=o,z.normal.x=x,z.normal.y=y,z.pointCount=o.m_pointCount,z.friction=p,z.restitution=q,z.localPlaneNormal.x=o.m_localPlaneNormal.x,z.localPlaneNormal.y=o.m_localPlaneNormal.y,z.localPoint.x=o.m_localPoint.x,z.localPoint.y=o.m_localPoint.y,z.radius=k+l,z.type=o.m_type;for(var A=0;A<z.pointCount;++A){var B=o.m_points[A],C=z.points[A];C.normalImpulse=B.m_normalImpulse,C.tangentImpulse=B.m_tangentImpulse,C.localPoint.SetV(B.m_localPoint);var D=C.rA.x=b2ContactSolver.s_worldManifold.m_points[A].x-m.m_sweep.c.x,E=C.rA.y=b2ContactSolver.s_worldManifold.m_points[A].y-m.m_sweep.c.y,F=C.rB.x=b2ContactSolver.s_worldManifold.m_points[A].x-n.m_sweep.c.x,G=C.rB.y=b2ContactSolver.s_worldManifold.m_points[A].y-n.m_sweep.c.y,H=D*y-E*x,I=F*y-G*x;H*=H,I*=I;var J=m.m_invMass+n.m_invMass+m.m_invI*H+n.m_invI*I;C.normalMass=1/J;var K=m.m_mass*m.m_invMass+n.m_mass*n.m_invMass;K+=m.m_mass*m.m_invI*H+n.m_mass*n.m_invI*I,C.equalizedMass=1/K;var L=y,M=-x,N=D*M-E*L,O=F*M-G*L;N*=N,O*=O;var P=m.m_invMass+n.m_invMass+m.m_invI*N+n.m_invI*O;C.tangentMass=1/P,C.velocityBias=0;var Q=t+-w*G-r- -v*E,R=u+w*F-s-v*D,S=z.normal.x*Q+z.normal.y*R;S<-b2Settings.b2_velocityThreshold&&(C.velocityBias+=-z.restitution*S)}if(2==z.pointCount){var T=z.points[0],U=z.points[1],V=m.m_invMass,W=m.m_invI,X=n.m_invMass,Y=n.m_invI,Z=T.rA.x*y-T.rA.y*x,$=T.rB.x*y-T.rB.y*x,_=U.rA.x*y-U.rA.y*x,aa=U.rB.x*y-U.rB.y*x,ba=V+X+W*Z*Z+Y*$*$,ca=V+X+W*_*_+Y*aa*aa,da=V+X+W*Z*_+Y*$*aa,ea=100;ea*(ba*ca-da*da)>ba*ba?(z.K.col1.Set(ba,da),z.K.col2.Set(da,ca),z.K.GetInverse(z.normalMass)):z.pointCount=1}}},b2ContactSolver.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],d=c.bodyA,e=c.bodyB,f=d.m_invMass,g=d.m_invI,h=e.m_invMass,i=e.m_invI,j=c.normal.x,k=c.normal.y,l=k,m=-j,n=0,o=0;if(a.warmStarting)for(o=c.pointCount,n=0;o>n;++n){var p=c.points[n];p.normalImpulse*=a.dtRatio,p.tangentImpulse*=a.dtRatio;var q=p.normalImpulse*j+p.tangentImpulse*l,r=p.normalImpulse*k+p.tangentImpulse*m;d.m_angularVelocity-=g*(p.rA.x*r-p.rA.y*q),d.m_linearVelocity.x-=f*q,d.m_linearVelocity.y-=f*r,e.m_angularVelocity+=i*(p.rB.x*r-p.rB.y*q),e.m_linearVelocity.x+=h*q,e.m_linearVelocity.y+=h*r}else for(o=c.pointCount,n=0;o>n;++n){var s=c.points[n];s.normalImpulse=0,s.tangentImpulse=0}}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=0,s=0;s<this.m_constraintCount;++s){var t=this.m_constraints[s],u=t.bodyA,v=t.bodyB,w=u.m_angularVelocity,x=v.m_angularVelocity,y=u.m_linearVelocity,z=v.m_linearVelocity,A=u.m_invMass,B=u.m_invI,C=v.m_invMass,D=v.m_invI,E=t.normal.x,F=t.normal.y,G=F,H=-E,I=t.friction;for(r=0;r<t.pointCount;r++)a=t.points[r],b=z.x-x*a.rB.y-y.x+w*a.rA.y,c=z.y+x*a.rB.x-y.y-w*a.rA.x,e=b*G+c*H,f=a.tangentMass*-e,g=I*a.normalImpulse,h=b2Math.Clamp(a.tangentImpulse+f,-g,g),f=h-a.tangentImpulse,i=f*G,j=f*H,y.x-=A*i,y.y-=A*j,w-=B*(a.rA.x*j-a.rA.y*i),z.x+=C*i,z.y+=C*j,x+=D*(a.rB.x*j-a.rB.y*i),a.tangentImpulse=h;t.pointCount;if(1==t.pointCount)a=t.points[0],b=z.x+-x*a.rB.y-y.x- -w*a.rA.y,c=z.y+x*a.rB.x-y.y-w*a.rA.x,d=b*E+c*F,f=-a.normalMass*(d-a.velocityBias),h=a.normalImpulse+f,h=h>0?h:0,f=h-a.normalImpulse,i=f*E,j=f*F,y.x-=A*i,y.y-=A*j,w-=B*(a.rA.x*j-a.rA.y*i),z.x+=C*i,z.y+=C*j,x+=D*(a.rB.x*j-a.rB.y*i),a.normalImpulse=h;else{var J=t.points[0],K=t.points[1],L=J.normalImpulse,M=K.normalImpulse,N=z.x-x*J.rB.y-y.x+w*J.rA.y,O=z.y+x*J.rB.x-y.y-w*J.rA.x,P=z.x-x*K.rB.y-y.x+w*K.rA.y,Q=z.y+x*K.rB.x-y.y-w*K.rA.x,R=N*E+O*F,S=P*E+Q*F,T=R-J.velocityBias,U=S-K.velocityBias;q=t.K,T-=q.col1.x*L+q.col2.x*M,U-=q.col1.y*L+q.col2.y*M;for(;;){q=t.normalMass;var V=-(q.col1.x*T+q.col2.x*U),W=-(q.col1.y*T+q.col2.y*U);if(V>=0&&W>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}if(V=-J.normalMass*T,W=0,R=0,S=t.K.col1.y*V+U,V>=0&&S>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}if(V=0,W=-K.normalMass*U,R=t.K.col2.x*W+T,S=0,W>=0&&R>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}if(V=0,W=0,R=T,S=U,R>=0&&S>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}break}}u.m_angularVelocity=w,v.m_angularVelocity=x}},b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,d=0;d<b.pointCount;++d){var e=c.m_points[d],f=b.points[d];e.m_normalImpulse=f.normalImpulse,e.m_tangentImpulse=f.tangentImpulse}},b2ContactSolver.prototype.SolvePositionConstraints=function(a){for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;b2ContactSolver.s_psm.Initialize(d);for(var k=b2ContactSolver.s_psm.m_normal,l=0;l<d.pointCount;l++){var m=d.points[l],n=b2ContactSolver.s_psm.m_points[l],o=b2ContactSolver.s_psm.m_separations[l],p=n.x-e.m_sweep.c.x,q=n.y-e.m_sweep.c.y,r=n.x-f.m_sweep.c.x,s=n.y-f.m_sweep.c.y;b=o>b?b:o;var t=b2Math.Clamp(a*(o+b2Settings.b2_linearSlop),-b2Settings.b2_maxLinearCorrection,0),u=-m.equalizedMass*t,v=u*k.x,w=u*k.y;e.m_sweep.c.x-=g*v,e.m_sweep.c.y-=g*w,e.m_sweep.a-=h*(p*w-q*v),e.SynchronizeTransform(),f.m_sweep.c.x+=i*v,f.m_sweep.c.y+=i*w,f.m_sweep.a+=j*(r*w-s*v),f.SynchronizeTransform()}}return b>-1.5*b2Settings.b2_linearSlop},b2ContactSolver.prototype.m_step=new b2TimeStep,b2ContactSolver.prototype.m_allocator=null,b2ContactSolver.prototype.m_constraints=new Array,b2ContactSolver.prototype.m_constraintCount=0;var b2Simplex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Simplex.prototype.__constructor=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},b2Simplex.prototype.__varz=function(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=new Array(3)},b2Simplex.prototype.ReadCache=function(a,b,c,d,e){b2Settings.b2Assert(0<=a.count&&a.count<=3);var f,g;this.m_count=a.count;for(var h=this.m_vertices,i=0;i<this.m_count;i++){var j=h[i];j.indexA=a.indexA[i],j.indexB=a.indexB[i],f=b.GetVertex(j.indexA),g=d.GetVertex(j.indexB),j.wA=b2Math.MulX(c,f),j.wB=b2Math.MulX(e,g),j.w=b2Math.SubtractVV(j.wB,j.wA),j.a=0}if(this.m_count>1){var k=a.metric,l=this.GetMetric();(.5*k>l||l>2*k||l<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(j=h[0],j.indexA=0,j.indexB=0,f=b.GetVertex(0),g=d.GetVertex(0),j.wA=b2Math.MulX(c,f),j.wB=b2Math.MulX(e,g),j.w=b2Math.SubtractVV(j.wB,j.wA),this.m_count=1)},b2Simplex.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=parseInt(this.m_count);for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=parseInt(b[c].indexA),a.indexB[c]=parseInt(b[c].indexB)},b2Simplex.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b=b2Math.CrossVV(a,this.m_v1.w.GetNegative());return b>0?b2Math.CrossFV(1,a):b2Math.CrossVF(a,1);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),new b2Vec2;case 1:return this.m_v1.w;case 2:return new b2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:b2Settings.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:b2Settings.b2Assert(!1)}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),0;case 1:return 0;case 2:return b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b2Math.SubtractVV(this.m_v3.w,this.m_v1.w));default:return b2Settings.b2Assert(!1),0}},b2Simplex.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=b2Math.SubtractVV(b,a),d=-(a.x*c.x+a.y*c.y);if(0>=d)return this.m_v1.a=1,void(this.m_count=1);var e=b.x*c.x+b.y*c.y;if(0>=e)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var f=1/(e+d);this.m_v1.a=e*f,this.m_v2.a=d*f,this.m_count=2},b2Simplex.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=b2Math.SubtractVV(b,a),e=b2Math.Dot(a,d),f=b2Math.Dot(b,d),g=f,h=-e,i=b2Math.SubtractVV(c,a),j=b2Math.Dot(a,i),k=b2Math.Dot(c,i),l=k,m=-j,n=b2Math.SubtractVV(c,b),o=b2Math.Dot(b,n),p=b2Math.Dot(c,n),q=p,r=-o,s=b2Math.CrossVV(d,i),t=s*b2Math.CrossVV(b,c),u=s*b2Math.CrossVV(c,a),v=s*b2Math.CrossVV(a,b);if(0>=h&&0>=m)return this.m_v1.a=1,void(this.m_count=1);if(g>0&&h>0&&0>=v){var w=1/(g+h);return this.m_v1.a=g*w,this.m_v2.a=h*w,void(this.m_count=2)}if(l>0&&m>0&&0>=u){var x=1/(l+m);return this.m_v1.a=l*x,this.m_v3.a=m*x,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(0>=g&&0>=r)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(0>=l&&0>=q)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(q>0&&r>0&&0>=t){var y=1/(q+r);return this.m_v2.a=q*y,this.m_v3.a=r*y,this.m_count=2,void this.m_v1.Set(this.m_v3)}var z=1/(t+u+v);this.m_v1.a=t*z,this.m_v2.a=u*z,this.m_v3.a=v*z,this.m_count=3},b2Simplex.prototype.m_v1=new b2SimplexVertex,b2Simplex.prototype.m_v2=new b2SimplexVertex,b2Simplex.prototype.m_v3=new b2SimplexVertex,b2Simplex.prototype.m_vertices=new Array(3),b2Simplex.prototype.m_count=0;var b2WeldJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJoint.prototype,b2Joint.prototype),b2WeldJoint.prototype._super=b2Joint.prototype,b2WeldJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new b2Mat33},b2WeldJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2WeldJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=j*this.m_impulse.x,d.m_linearVelocity.y-=j*this.m_impulse.y,d.m_angularVelocity-=l*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=k*this.m_impulse.x,e.m_linearVelocity.y+=k*this.m_impulse.y,e.m_angularVelocity+=m*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},b2WeldJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c,b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c;var r=h.x-i*q-f.x+g*o,s=h.y+i*p-f.y-g*n,t=i-g,u=new b2Vec3;this.m_mass.Solve33(u,-r,-s,-t),this.m_impulse.Add(u),f.x-=j*u.x,f.y-=j*u.y,g-=l*(n*u.y-o*u.x+u.z),h.x+=k*u.x,h.y+=k*u.y,i+=m*(p*u.y-q*u.x+u.z),d.m_angularVelocity=g,e.m_angularVelocity=i},b2WeldJoint.prototype.SolvePositionConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI,n=e.m_sweep.c.x+h-d.m_sweep.c.x-f,o=e.m_sweep.c.y+i-d.m_sweep.c.y-g,p=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle,q=10*b2Settings.b2_linearSlop,r=Math.sqrt(n*n+o*o),s=b2Math.Abs(p);r>q&&(l*=1,m*=1),this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m;var t=new b2Vec3;return this.m_mass.Solve33(t,-n,-o,-p),d.m_sweep.c.x-=j*t.x,d.m_sweep.c.y-=j*t.y,d.m_sweep.a-=l*(f*t.y-g*t.x+t.z),e.m_sweep.c.x+=k*t.x,e.m_sweep.c.y+=k*t.y,e.m_sweep.a+=m*(h*t.y-i*t.x+t.z),d.SynchronizeTransform(),e.SynchronizeTransform(),r<=b2Settings.b2_linearSlop&&s<=b2Settings.b2_angularSlop},b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2WeldJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2WeldJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},b2WeldJoint.prototype.m_localAnchorA=new b2Vec2,b2WeldJoint.prototype.m_localAnchorB=new b2Vec2,b2WeldJoint.prototype.m_referenceAngle=null,b2WeldJoint.prototype.m_impulse=new b2Vec3,b2WeldJoint.prototype.m_mass=new b2Mat33;var b2Math=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Math.prototype.__constructor=function(){},b2Math.prototype.__varz=function(){},b2Math.IsValid=function(a){return isFinite(a)},b2Math.Dot=function(a,b){return a.x*b.x+a.y*b.y},b2Math.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},b2Math.CrossVF=function(a,b){var c=new b2Vec2(b*a.y,-b*a.x);return c},b2Math.CrossFV=function(a,b){var c=new b2Vec2(-a*b.y,a*b.x);return c},b2Math.MulMV=function(a,b){var c=new b2Vec2(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);return c},b2Math.MulTMV=function(a,b){var c=new b2Vec2(b2Math.Dot(b,a.col1),b2Math.Dot(b,a.col2));return c},b2Math.MulX=function(a,b){var c=b2Math.MulMV(a.R,b);return c.x+=a.position.x,c.y+=a.position.y,c},b2Math.MulXT=function(a,b){var c=b2Math.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;return c.y=c.x*a.R.col2.x+c.y*a.R.col2.y,c.x=d,c},b2Math.AddVV=function(a,b){var c=new b2Vec2(a.x+b.x,a.y+b.y);return c},b2Math.SubtractVV=function(a,b){var c=new b2Vec2(a.x-b.x,a.y-b.y);return c},b2Math.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b2Math.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},b2Math.MulFV=function(a,b){var c=new b2Vec2(a*b.x,a*b.y);return c},b2Math.AddMM=function(a,b){var c=b2Mat22.FromVV(b2Math.AddVV(a.col1,b.col1),b2Math.AddVV(a.col2,b.col2));return c},b2Math.MulMM=function(a,b){var c=b2Mat22.FromVV(b2Math.MulMV(a,b.col1),b2Math.MulMV(a,b.col2));return c},b2Math.MulTMM=function(a,b){var c=new b2Vec2(b2Math.Dot(a.col1,b.col1),b2Math.Dot(a.col2,b.col1)),d=new b2Vec2(b2Math.Dot(a.col1,b.col2),b2Math.Dot(a.col2,b.col2)),e=b2Mat22.FromVV(c,d);return e},b2Math.Abs=function(a){return a>0?a:-a},b2Math.AbsV=function(a){var b=new b2Vec2(b2Math.Abs(a.x),b2Math.Abs(a.y));return b},b2Math.AbsM=function(a){var b=b2Mat22.FromVV(b2Math.AbsV(a.col1),b2Math.AbsV(a.col2));return b},b2Math.Min=function(a,b){return b>a?a:b},b2Math.MinV=function(a,b){var c=new b2Vec2(b2Math.Min(a.x,b.x),b2Math.Min(a.y,b.y));return c},b2Math.Max=function(a,b){return a>b?a:b},b2Math.MaxV=function(a,b){var c=new b2Vec2(b2Math.Max(a.x,b.x),b2Math.Max(a.y,b.y));return c},b2Math.Clamp=function(a,b,c){return b>a?b:a>c?c:a},b2Math.ClampV=function(a,b,c){return b2Math.MaxV(b,b2Math.MinV(a,c))},b2Math.Swap=function(a,b){var c=a[0];a[0]=b[0],b[0]=c},b2Math.Random=function(){return 2*Math.random()-1},b2Math.RandomRange=function(a,b){var c=Math.random();return c=(b-a)*c+a},b2Math.NextPowerOfTwo=function(a){return a|=a>>1&2147483647,a|=a>>2&1073741823,a|=a>>4&268435455,a|=a>>8&16777215,a|=a>>16&65535,a+1},b2Math.IsPowerOfTwo=function(a){var b=a>0&&0==(a&a-1);return b},b2Math.b2Vec2_zero=new b2Vec2(0,0),b2Math.b2Mat22_identity=b2Mat22.FromVV(new b2Vec2(1,0),new b2Vec2(0,1)),b2Math.b2Transform_identity=new b2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype),b2PulleyJoint.prototype._super=b2Joint.prototype,b2PulleyJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=b2Math.Min(a.maxLengthA,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.Min(a.maxLengthB,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2},b2PulleyJoint.b2_minPulleyLength=2,b2PulleyJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=c.m_sweep.c.x+e,k=c.m_sweep.c.y+f,l=d.m_sweep.c.x+h,m=d.m_sweep.c.y+i,n=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,q=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(j-n,k-o),this.m_u2.Set(l-p,m-q);var r=this.m_u1.Length(),s=this.m_u2.Length();r>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),s>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/s):this.m_u2.SetZero();var t=this.m_constant-r-this.m_ratio*s;t>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=b2Joint.e_atUpperLimit,r<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=b2Joint.e_atUpperLimit,s<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=b2Joint.e_atUpperLimit;var u=e*this.m_u1.y-f*this.m_u1.x,v=h*this.m_u2.y-i*this.m_u2.x;if(this.m_limitMass1=c.m_invMass+c.m_invI*u*u,this.m_limitMass2=d.m_invMass+d.m_invI*v*v,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,a.warmStarting){this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio;var w=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,x=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,y=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,z=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*w,c.m_linearVelocity.y+=c.m_invMass*x,c.m_angularVelocity+=c.m_invI*(e*x-f*w),d.m_linearVelocity.x+=d.m_invMass*y,d.m_linearVelocity.y+=d.m_invMass*z,d.m_angularVelocity+=d.m_invI*(h*z-i*y)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},b2PulleyJoint.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;
var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j,k,l,m,n,o,p,q,r,s,t;this.m_state==b2Joint.e_atUpperLimit&&(j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,r=-(this.m_u1.x*j+this.m_u1.y*k)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*m),s=this.m_pulleyMass*-r,t=this.m_impulse,this.m_impulse=b2Math.Max(0,this.m_impulse+s),s=this.m_impulse-t,n=-s*this.m_u1.x,o=-s*this.m_u1.y,p=-this.m_ratio*s*this.m_u2.x,q=-this.m_ratio*s*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*n,c.m_linearVelocity.y+=c.m_invMass*o,c.m_angularVelocity+=c.m_invI*(e*o-f*n),d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p)),this.m_limitState1==b2Joint.e_atUpperLimit&&(j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,r=-(this.m_u1.x*j+this.m_u1.y*k),s=-this.m_limitMass1*r,t=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.Max(0,this.m_limitImpulse1+s),s=this.m_limitImpulse1-t,n=-s*this.m_u1.x,o=-s*this.m_u1.y,c.m_linearVelocity.x+=c.m_invMass*n,c.m_linearVelocity.y+=c.m_invMass*o,c.m_angularVelocity+=c.m_invI*(e*o-f*n)),this.m_limitState2==b2Joint.e_atUpperLimit&&(l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,r=-(this.m_u2.x*l+this.m_u2.y*m),s=-this.m_limitMass2*r,t=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.Max(0,this.m_limitImpulse2+s),s=this.m_limitImpulse2-t,p=-s*this.m_u2.x,q=-s*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p))},b2PulleyJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=this.m_bodyA,q=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,t=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,v=0;return this.m_state==b2Joint.e_atUpperLimit&&(b=p.m_xf.R,c=this.m_localAnchor1.x-p.m_sweep.localCenter.x,d=this.m_localAnchor1.y-p.m_sweep.localCenter.y,o=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d,c=o,b=q.m_xf.R,e=this.m_localAnchor2.x-q.m_sweep.localCenter.x,f=this.m_localAnchor2.y-q.m_sweep.localCenter.y,o=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=o,g=p.m_sweep.c.x+c,h=p.m_sweep.c.y+d,i=q.m_sweep.c.x+e,j=q.m_sweep.c.y+f,this.m_u1.Set(g-r,h-s),this.m_u2.Set(i-t,j-u),k=this.m_u1.Length(),l=this.m_u2.Length(),k>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/k):this.m_u1.SetZero(),l>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/l):this.m_u2.SetZero(),m=this.m_constant-k-this.m_ratio*l,v=b2Math.Max(v,-m),m=b2Math.Clamp(m+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=-this.m_pulleyMass*m,g=-n*this.m_u1.x,h=-n*this.m_u1.y,i=-this.m_ratio*n*this.m_u2.x,j=-this.m_ratio*n*this.m_u2.y,p.m_sweep.c.x+=p.m_invMass*g,p.m_sweep.c.y+=p.m_invMass*h,p.m_sweep.a+=p.m_invI*(c*h-d*g),q.m_sweep.c.x+=q.m_invMass*i,q.m_sweep.c.y+=q.m_invMass*j,q.m_sweep.a+=q.m_invI*(e*j-f*i),p.SynchronizeTransform(),q.SynchronizeTransform()),this.m_limitState1==b2Joint.e_atUpperLimit&&(b=p.m_xf.R,c=this.m_localAnchor1.x-p.m_sweep.localCenter.x,d=this.m_localAnchor1.y-p.m_sweep.localCenter.y,o=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d,c=o,g=p.m_sweep.c.x+c,h=p.m_sweep.c.y+d,this.m_u1.Set(g-r,h-s),k=this.m_u1.Length(),k>b2Settings.b2_linearSlop?(this.m_u1.x*=1/k,this.m_u1.y*=1/k):this.m_u1.SetZero(),m=this.m_maxLength1-k,v=b2Math.Max(v,-m),m=b2Math.Clamp(m+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=-this.m_limitMass1*m,g=-n*this.m_u1.x,h=-n*this.m_u1.y,p.m_sweep.c.x+=p.m_invMass*g,p.m_sweep.c.y+=p.m_invMass*h,p.m_sweep.a+=p.m_invI*(c*h-d*g),p.SynchronizeTransform()),this.m_limitState2==b2Joint.e_atUpperLimit&&(b=q.m_xf.R,e=this.m_localAnchor2.x-q.m_sweep.localCenter.x,f=this.m_localAnchor2.y-q.m_sweep.localCenter.y,o=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=o,i=q.m_sweep.c.x+e,j=q.m_sweep.c.y+f,this.m_u2.Set(i-t,j-u),l=this.m_u2.Length(),l>b2Settings.b2_linearSlop?(this.m_u2.x*=1/l,this.m_u2.y*=1/l):this.m_u2.SetZero(),m=this.m_maxLength2-l,v=b2Math.Max(v,-m),m=b2Math.Clamp(m+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=-this.m_limitMass2*m,i=-n*this.m_u2.x,j=-n*this.m_u2.y,q.m_sweep.c.x+=q.m_invMass*i,q.m_sweep.c.y+=q.m_invMass*j,q.m_sweep.a+=q.m_invI*(e*j-f*i),q.SynchronizeTransform()),v<b2Settings.b2_linearSlop},b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PulleyJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},b2PulleyJoint.prototype.GetReactionTorque=function(a){return 0},b2PulleyJoint.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},b2PulleyJoint.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},b2PulleyJoint.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},b2PulleyJoint.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},b2PulleyJoint.prototype.m_ground=null,b2PulleyJoint.prototype.m_groundAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_groundAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_u1=new b2Vec2,b2PulleyJoint.prototype.m_u2=new b2Vec2,b2PulleyJoint.prototype.m_constant=null,b2PulleyJoint.prototype.m_ratio=null,b2PulleyJoint.prototype.m_maxLength1=null,b2PulleyJoint.prototype.m_maxLength2=null,b2PulleyJoint.prototype.m_pulleyMass=null,b2PulleyJoint.prototype.m_limitMass1=null,b2PulleyJoint.prototype.m_limitMass2=null,b2PulleyJoint.prototype.m_impulse=null,b2PulleyJoint.prototype.m_limitImpulse1=null,b2PulleyJoint.prototype.m_limitImpulse2=null,b2PulleyJoint.prototype.m_state=0,b2PulleyJoint.prototype.m_limitState1=0,b2PulleyJoint.prototype.m_limitState2=0;var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype),b2PrismaticJoint.prototype._super=b2Joint.prototype,b2PrismaticJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2PrismaticJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat33,this.m_impulse=new b2Vec3},b2PrismaticJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_localCenterA.SetV(d.GetLocalCenter()),this.m_localCenterB.SetV(e.GetLocalCenter());var f=d.GetTransform();e.GetTransform();b=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=e.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c;var k=e.m_sweep.c.x+i-d.m_sweep.c.x-g,l=e.m_sweep.c.y+j-d.m_sweep.c.y-h;this.m_invMassA=d.m_invMass,this.m_invMassB=e.m_invMass,this.m_invIA=d.m_invI,this.m_invIB=e.m_invI,this.m_axis.SetV(b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(k+g)*this.m_axis.y-(l+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(k+g)*this.m_perp.y-(l+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x;var m=this.m_invMassA,n=this.m_invMassB,o=this.m_invIA,p=this.m_invIB;if(this.m_K.col1.x=m+n+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+p*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+p,this.m_K.col2.z=o*this.m_a1+p*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+n+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var q=this.m_axis.x*k+this.m_axis.y*l;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.z=0):q>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var r=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,t=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,u=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;d.m_linearVelocity.x-=this.m_invMassA*r,d.m_linearVelocity.y-=this.m_invMassA*s,d.m_angularVelocity-=this.m_invIA*t,e.m_linearVelocity.x+=this.m_invMassB*r,e.m_linearVelocity.y+=this.m_invMassB*s,e.m_angularVelocity+=this.m_invIB*u}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f=this.m_bodyA,g=this.m_bodyB,h=f.m_linearVelocity,i=f.m_angularVelocity,j=g.m_linearVelocity,k=g.m_angularVelocity;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var l=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,m=this.m_motorMass*(this.m_motorSpeed-l),n=this.m_motorImpulse,o=a.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+m,-o,o),m=this.m_motorImpulse-n,b=m*this.m_axis.x,c=m*this.m_axis.y,d=m*this.m_a1,e=m*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}var p=this.m_perp.x*(j.x-h.x)+this.m_perp.y*(j.y-h.y)+this.m_s2*k-this.m_s1*i,q=k-i;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var r=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,s=this.m_impulse.Copy(),t=this.m_K.Solve33(new b2Vec3,-p,-q,-r);this.m_impulse.Add(t),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.z=b2Math.Max(this.m_impulse.z,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.z=b2Math.Min(this.m_impulse.z,0));var u=-p-(this.m_impulse.z-s.z)*this.m_K.col3.x,v=-q-(this.m_impulse.z-s.z)*this.m_K.col3.y,w=this.m_K.Solve22(new b2Vec2,u,v);w.x+=s.x,w.y+=s.y,this.m_impulse.x=w.x,this.m_impulse.y=w.y,t.x=this.m_impulse.x-s.x,t.y=this.m_impulse.y-s.y,t.z=this.m_impulse.z-s.z,b=t.x*this.m_perp.x+t.z*this.m_axis.x,c=t.x*this.m_perp.y+t.z*this.m_axis.y,d=t.x*this.m_s1+t.y+t.z*this.m_a1,e=t.x*this.m_s2+t.y+t.z*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}else{var x=this.m_K.Solve22(new b2Vec2,-p,-q);this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,b=x.x*this.m_perp.x,c=x.x*this.m_perp.y,d=x.x*this.m_s1+x.y,e=x.x*this.m_s2+x.y,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}f.m_linearVelocity.SetV(h),f.m_angularVelocity=i,g.m_linearVelocity.SetV(j),g.m_angularVelocity=k},b2PrismaticJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g,h=this.m_bodyA,i=this.m_bodyB,j=h.m_sweep.c,k=h.m_sweep.a,l=i.m_sweep.c,m=i.m_sweep.a,n=0,o=0,p=!1,q=0,r=b2Mat22.FromAngle(k),s=b2Mat22.FromAngle(m);b=r;var t=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*t+b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=c,b=s;var v=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=c;var x=l.x+v-j.x-t,y=l.y+w-j.y-u;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(r,this.m_localXAxis1),this.m_a1=(x+t)*this.m_axis.y-(y+u)*this.m_axis.x,this.m_a2=v*this.m_axis.y-w*this.m_axis.x;var z=this.m_axis.x*x+this.m_axis.y*y;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(q=b2Math.Clamp(z,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),n=b2Math.Abs(z),p=!0):z<=this.m_lowerTranslation?(q=b2Math.Clamp(z-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-z,p=!0):z>=this.m_upperTranslation&&(q=b2Math.Clamp(z-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),n=z-this.m_upperTranslation,p=!0)}this.m_perp=b2Math.MulMV(r,this.m_localYAxis1),this.m_s1=(x+t)*this.m_perp.y-(y+u)*this.m_perp.x,this.m_s2=v*this.m_perp.y-w*this.m_perp.x;var A=new b2Vec3,B=this.m_perp.x*x+this.m_perp.y*y,C=m-k-this.m_refAngle;if(n=b2Math.Max(n,b2Math.Abs(B)),o=b2Math.Abs(C),p)d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+g*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+g,this.m_K.col2.z=f*this.m_a1+g*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=d+e+f*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve33(A,-B,-C,-q);else{d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB;var D=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,E=f*this.m_s1+g*this.m_s2,F=f+g;this.m_K.col1.Set(D,E,0),this.m_K.col2.Set(E,F,0);var G=this.m_K.Solve22(new b2Vec2,-B,-C);A.x=G.x,A.y=G.y,A.z=0}var H=A.x*this.m_perp.x+A.z*this.m_axis.x,I=A.x*this.m_perp.y+A.z*this.m_axis.y,J=A.x*this.m_s1+A.y+A.z*this.m_a1,K=A.x*this.m_s2+A.y+A.z*this.m_a2;return j.x-=this.m_invMassA*H,j.y-=this.m_invMassA*I,k-=this.m_invIA*J,l.x+=this.m_invMassB*H,l.y+=this.m_invMassB*I,m+=this.m_invIB*K,h.m_sweep.a=k,i.m_sweep.a=m,h.SynchronizeTransform(),i.SynchronizeTransform(),n<=b2Settings.b2_linearSlop&&o<=b2Settings.b2_angularSlop},b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PrismaticJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b2PrismaticJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},b2PrismaticJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1),h=g.x*e+g.y*f;return h},b2PrismaticJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity,t=m*-r*o.y+n*r*o.x+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d));return t},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2PrismaticJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2PrismaticJoint.prototype.SetLimits=function(a,b){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2PrismaticJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},b2PrismaticJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2PrismaticJoint.prototype.SetMaxMotorForce=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2PrismaticJoint.prototype.m_localAnchor1=new b2Vec2,b2PrismaticJoint.prototype.m_localAnchor2=new b2Vec2,b2PrismaticJoint.prototype.m_localXAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_localYAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_refAngle=null,b2PrismaticJoint.prototype.m_axis=new b2Vec2,b2PrismaticJoint.prototype.m_perp=new b2Vec2,b2PrismaticJoint.prototype.m_s1=null,b2PrismaticJoint.prototype.m_s2=null,b2PrismaticJoint.prototype.m_a1=null,b2PrismaticJoint.prototype.m_a2=null,b2PrismaticJoint.prototype.m_K=new b2Mat33,b2PrismaticJoint.prototype.m_impulse=new b2Vec3,b2PrismaticJoint.prototype.m_motorMass=null,b2PrismaticJoint.prototype.m_motorImpulse=null,b2PrismaticJoint.prototype.m_lowerTranslation=null,b2PrismaticJoint.prototype.m_upperTranslation=null,b2PrismaticJoint.prototype.m_maxMotorForce=null,b2PrismaticJoint.prototype.m_motorSpeed=null,b2PrismaticJoint.prototype.m_enableLimit=null,b2PrismaticJoint.prototype.m_enableMotor=null,b2PrismaticJoint.prototype.m_limitState=0;var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype),b2RevoluteJoint.prototype._super=b2Joint.prototype,b2RevoluteJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit},b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.impulse3=new b2Vec3,this.impulse2=new b2Vec2,this.reduced=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2RevoluteJoint.tImpulse=new b2Vec2,b2RevoluteJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_enableMotor||this.m_enableLimit,b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;if(this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,this.m_motorMass=1/(l+m),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var n=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle;b2Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:n<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atLowerLimit):n>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var o=this.m_impulse.x,p=this.m_impulse.y;d.m_linearVelocity.x-=j*o,d.m_linearVelocity.y-=j*p,d.m_angularVelocity-=l*(f*p-g*o+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=k*o,e.m_linearVelocity.y+=k*p,e.m_angularVelocity+=m*(h*p-i*o+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f,g,h,i=this.m_bodyA,j=this.m_bodyB,k=i.m_linearVelocity,l=i.m_angularVelocity,m=j.m_linearVelocity,n=j.m_angularVelocity,o=i.m_invMass,p=j.m_invMass,q=i.m_invI,r=j.m_invI;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var s=n-l-this.m_motorSpeed,t=this.m_motorMass*-s,u=this.m_motorImpulse,v=a.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+t,-v,v),t=this.m_motorImpulse-u,l-=q*t,n+=r*t}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){b=i.m_xf.R,e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,f=this.m_localAnchor1.y-i.m_sweep.localCenter.y,c=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=c,b=j.m_xf.R,g=this.m_localAnchor2.x-j.m_sweep.localCenter.x,h=this.m_localAnchor2.y-j.m_sweep.localCenter.y,c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c;var w=m.x+-n*h-k.x- -l*f,x=m.y+n*g-k.y-l*e,y=n-l;this.m_mass.Solve33(this.impulse3,-w,-x,-y),this.m_limitState==b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==b2Joint.e_atLowerLimit?(d=this.m_impulse.z+this.impulse3.z,0>d&&(this.m_mass.Solve22(this.reduced,-w,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==b2Joint.e_atUpperLimit&&(d=this.m_impulse.z+this.impulse3.z,d>0&&(this.m_mass.Solve22(this.reduced,-w,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),k.x-=o*this.impulse3.x,k.y-=o*this.impulse3.y,l-=q*(e*this.impulse3.y-f*this.impulse3.x+this.impulse3.z),m.x+=p*this.impulse3.x,m.y+=p*this.impulse3.y,n+=r*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else{b=i.m_xf.R,e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,f=this.m_localAnchor1.y-i.m_sweep.localCenter.y,c=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=c,b=j.m_xf.R,g=this.m_localAnchor2.x-j.m_sweep.localCenter.x,h=this.m_localAnchor2.y-j.m_sweep.localCenter.y,c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c;var z=m.x+-n*h-k.x- -l*f,A=m.y+n*g-k.y-l*e;this.m_mass.Solve22(this.impulse2,-z,-A),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,k.x-=o*this.impulse2.x,k.y-=o*this.impulse2.y,l-=q*(e*this.impulse2.y-f*this.impulse2.x),m.x+=p*this.impulse2.x,m.y+=p*this.impulse2.y,n+=r*(g*this.impulse2.y-h*this.impulse2.x)}i.m_linearVelocity.SetV(k),i.m_angularVelocity=l,j.m_linearVelocity.SetV(m),j.m_angularVelocity=n},b2RevoluteJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g=this.m_bodyA,h=this.m_bodyB,i=0,j=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var k=h.m_sweep.a-g.m_sweep.a-this.m_referenceAngle,l=0;this.m_limitState==b2Joint.e_equalLimits?(b=b2Math.Clamp(k-this.m_lowerAngle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),l=-this.m_motorMass*b,i=b2Math.Abs(b)):this.m_limitState==b2Joint.e_atLowerLimit?(b=k-this.m_lowerAngle,i=-b,b=b2Math.Clamp(b+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),l=-this.m_motorMass*b):this.m_limitState==b2Joint.e_atUpperLimit&&(b=k-this.m_upperAngle,i=b,b=b2Math.Clamp(b-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),l=-this.m_motorMass*b),g.m_sweep.a-=g.m_invI*l,h.m_sweep.a+=h.m_invI*l,g.SynchronizeTransform(),h.SynchronizeTransform()}c=g.m_xf.R;var m=this.m_localAnchor1.x-g.m_sweep.localCenter.x,n=this.m_localAnchor1.y-g.m_sweep.localCenter.y;d=c.col1.x*m+c.col2.x*n,n=c.col1.y*m+c.col2.y*n,m=d,c=h.m_xf.R;var o=this.m_localAnchor2.x-h.m_sweep.localCenter.x,p=this.m_localAnchor2.y-h.m_sweep.localCenter.y;d=c.col1.x*o+c.col2.x*p,p=c.col1.y*o+c.col2.y*p,o=d;var q=h.m_sweep.c.x+o-g.m_sweep.c.x-m,r=h.m_sweep.c.y+p-g.m_sweep.c.y-n,s=q*q+r*r,t=Math.sqrt(s);j=t;var u=g.m_invMass,v=h.m_invMass,w=g.m_invI,x=h.m_invI,y=10*b2Settings.b2_linearSlop;if(s>y*y){var z=u+v,A=1/z;e=A*-q,f=A*-r;var B=.5;g.m_sweep.c.x-=B*u*e,g.m_sweep.c.y-=B*u*f,h.m_sweep.c.x+=B*v*e,h.m_sweep.c.y+=B*v*f,q=h.m_sweep.c.x+o-g.m_sweep.c.x-m,r=h.m_sweep.c.y+p-g.m_sweep.c.y-n}return this.K1.col1.x=u+v,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=u+v,this.K2.col1.x=w*n*n,this.K2.col2.x=-w*m*n,this.K2.col1.y=-w*m*n,this.K2.col2.y=w*m*m,this.K3.col1.x=x*p*p,this.K3.col2.x=-x*o*p,this.K3.col1.y=-x*o*p,this.K3.col2.y=x*o*o,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-q,-r),e=b2RevoluteJoint.tImpulse.x,f=b2RevoluteJoint.tImpulse.y,g.m_sweep.c.x-=g.m_invMass*e,g.m_sweep.c.y-=g.m_invMass*f,g.m_sweep.a-=g.m_invI*(m*f-n*e),h.m_sweep.c.x+=h.m_invMass*e,h.m_sweep.c.y+=h.m_invMass*f,h.m_sweep.a+=h.m_invI*(o*f-p*e),g.SynchronizeTransform(),h.SynchronizeTransform(),j<=b2Settings.b2_linearSlop&&i<=b2Settings.b2_angularSlop},b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2RevoluteJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2RevoluteJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2RevoluteJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},b2RevoluteJoint.prototype.SetLimits=function(a,b){this.m_lowerAngle=a,this.m_upperAngle=b},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b2RevoluteJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a},b2RevoluteJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(a){this.m_maxMotorTorque=a},b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b2RevoluteJoint.prototype.K=new b2Mat22,b2RevoluteJoint.prototype.K1=new b2Mat22,b2RevoluteJoint.prototype.K2=new b2Mat22,b2RevoluteJoint.prototype.K3=new b2Mat22,b2RevoluteJoint.prototype.impulse3=new b2Vec3,b2RevoluteJoint.prototype.impulse2=new b2Vec2,b2RevoluteJoint.prototype.reduced=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor1=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor2=new b2Vec2,b2RevoluteJoint.prototype.m_impulse=new b2Vec3,b2RevoluteJoint.prototype.m_motorImpulse=null,b2RevoluteJoint.prototype.m_mass=new b2Mat33,b2RevoluteJoint.prototype.m_motorMass=null,b2RevoluteJoint.prototype.m_enableMotor=null,b2RevoluteJoint.prototype.m_maxMotorTorque=null,b2RevoluteJoint.prototype.m_motorSpeed=null,b2RevoluteJoint.prototype.m_enableLimit=null,b2RevoluteJoint.prototype.m_referenceAngle=null,b2RevoluteJoint.prototype.m_lowerAngle=null,b2RevoluteJoint.prototype.m_upperAngle=null,b2RevoluteJoint.prototype.m_limitState=0;var b2JointDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointDef.prototype.__constructor=function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},b2JointDef.prototype.__varz=function(){},b2JointDef.prototype.type=0,b2JointDef.prototype.userData=null,b2JointDef.prototype.bodyA=null,b2JointDef.prototype.bodyB=null,b2JointDef.prototype.collideConnected=null;var b2LineJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJointDef.prototype,b2JointDef.prototype),b2LineJointDef.prototype._super=b2JointDef.prototype,b2LineJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b2LineJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2LineJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},b2LineJointDef.prototype.localAnchorA=new b2Vec2,b2LineJointDef.prototype.localAnchorB=new b2Vec2,b2LineJointDef.prototype.localAxisA=new b2Vec2,b2LineJointDef.prototype.enableLimit=null,b2LineJointDef.prototype.lowerTranslation=null,b2LineJointDef.prototype.upperTranslation=null,b2LineJointDef.prototype.enableMotor=null,b2LineJointDef.prototype.maxMotorForce=null,b2LineJointDef.prototype.motorSpeed=null;var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype),b2DistanceJoint.prototype._super=b2Joint.prototype,b2DistanceJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),
this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},b2DistanceJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2},b2DistanceJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c,this.m_u.x=e.m_sweep.c.x+h-d.m_sweep.c.x-f,this.m_u.y=e.m_sweep.c.y+i-d.m_sweep.c.y-g;var j=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);j>b2Settings.b2_linearSlop?this.m_u.Multiply(1/j):this.m_u.SetZero();var k=f*this.m_u.y-g*this.m_u.x,l=h*this.m_u.y-i*this.m_u.x,m=d.m_invMass+d.m_invI*k*k+e.m_invMass+e.m_invI*l*l;if(this.m_mass=0!=m?1/m:0,this.m_frequencyHz>0){var n=j-this.m_length,o=2*Math.PI*this.m_frequencyHz,p=2*this.m_mass*this.m_dampingRatio*o,q=this.m_mass*o*o;this.m_gamma=a.dt*(p+a.dt*q),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=n*a.dt*q*this.m_gamma,this.m_mass=m+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(a.warmStarting){this.m_impulse*=a.dtRatio;var r=this.m_impulse*this.m_u.x,s=this.m_impulse*this.m_u.y;d.m_linearVelocity.x-=d.m_invMass*r,d.m_linearVelocity.y-=d.m_invMass*s,d.m_angularVelocity-=d.m_invI*(f*s-g*r),e.m_linearVelocity.x+=e.m_invMass*r,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(h*s-i*r)}else this.m_impulse=0},b2DistanceJoint.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,n=this.m_u.x*(l-j)+this.m_u.y*(m-k),o=-this.m_mass*(n+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=o;var p=o*this.m_u.x,q=o*this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*p,c.m_linearVelocity.y-=c.m_invMass*q,c.m_angularVelocity-=c.m_invI*(e*q-f*p),d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p)},b2DistanceJoint.prototype.SolvePositionConstraints=function(a){var b;if(this.m_frequencyHz>0)return!0;var c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=d.m_sweep.c.x+h-c.m_sweep.c.x-e,k=d.m_sweep.c.y+i-c.m_sweep.c.y-f,l=Math.sqrt(j*j+k*k);j/=l,k/=l;var m=l-this.m_length;m=b2Math.Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var n=-this.m_mass*m;this.m_u.Set(j,k);var o=n*this.m_u.x,p=n*this.m_u.y;return c.m_sweep.c.x-=c.m_invMass*o,c.m_sweep.c.y-=c.m_invMass*p,c.m_sweep.a-=c.m_invI*(e*p-f*o),d.m_sweep.c.x+=d.m_invMass*o,d.m_sweep.c.y+=d.m_invMass*p,d.m_sweep.a+=d.m_invI*(h*p-i*o),c.SynchronizeTransform(),d.SynchronizeTransform(),b2Math.Abs(m)<b2Settings.b2_linearSlop},b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2DistanceJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},b2DistanceJoint.prototype.GetReactionTorque=function(a){return 0},b2DistanceJoint.prototype.GetLength=function(){return this.m_length},b2DistanceJoint.prototype.SetLength=function(a){this.m_length=a},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2DistanceJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2DistanceJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},b2DistanceJoint.prototype.m_localAnchor1=new b2Vec2,b2DistanceJoint.prototype.m_localAnchor2=new b2Vec2,b2DistanceJoint.prototype.m_u=new b2Vec2,b2DistanceJoint.prototype.m_frequencyHz=null,b2DistanceJoint.prototype.m_dampingRatio=null,b2DistanceJoint.prototype.m_gamma=null,b2DistanceJoint.prototype.m_bias=null,b2DistanceJoint.prototype.m_impulse=null,b2DistanceJoint.prototype.m_mass=null,b2DistanceJoint.prototype.m_length=null;var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype),b2PulleyJointDef.prototype._super=b2JointDef.prototype,b2PulleyJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},b2PulleyJointDef.prototype.__varz=function(){this.groundAnchorA=new b2Vec2,this.groundAnchorB=new b2Vec2,this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2PulleyJointDef.prototype.Initialize=function(a,b,c,d,e,f,g){this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f);var h=e.x-c.x,i=e.y-c.y;this.lengthA=Math.sqrt(h*h+i*i);var j=f.x-d.x,k=f.y-d.y;this.lengthB=Math.sqrt(j*j+k*k),this.ratio=g;var l=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=l-this.ratio*b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(l-b2PulleyJoint.b2_minPulleyLength)/this.ratio},b2PulleyJointDef.prototype.groundAnchorA=new b2Vec2,b2PulleyJointDef.prototype.groundAnchorB=new b2Vec2,b2PulleyJointDef.prototype.localAnchorA=new b2Vec2,b2PulleyJointDef.prototype.localAnchorB=new b2Vec2,b2PulleyJointDef.prototype.lengthA=null,b2PulleyJointDef.prototype.maxLengthA=null,b2PulleyJointDef.prototype.lengthB=null,b2PulleyJointDef.prototype.maxLengthB=null,b2PulleyJointDef.prototype.ratio=null;var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype),b2DistanceJointDef.prototype._super=b2JointDef.prototype,b2DistanceJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},b2DistanceJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2DistanceJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));var e=d.x-c.x,f=d.y-c.y;this.length=Math.sqrt(e*e+f*f),this.frequencyHz=0,this.dampingRatio=0},b2DistanceJointDef.prototype.localAnchorA=new b2Vec2,b2DistanceJointDef.prototype.localAnchorB=new b2Vec2,b2DistanceJointDef.prototype.length=null,b2DistanceJointDef.prototype.frequencyHz=null,b2DistanceJointDef.prototype.dampingRatio=null;var b2FrictionJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJointDef.prototype,b2JointDef.prototype),b2FrictionJointDef.prototype._super=b2JointDef.prototype,b2FrictionJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_frictionJoint,this.maxForce=0,this.maxTorque=0},b2FrictionJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2FrictionJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},b2FrictionJointDef.prototype.localAnchorA=new b2Vec2,b2FrictionJointDef.prototype.localAnchorB=new b2Vec2,b2FrictionJointDef.prototype.maxForce=null,b2FrictionJointDef.prototype.maxTorque=null;var b2WeldJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJointDef.prototype,b2JointDef.prototype),b2WeldJointDef.prototype._super=b2JointDef.prototype,b2WeldJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_weldJoint,this.referenceAngle=0},b2WeldJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2WeldJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2WeldJointDef.prototype.localAnchorA=new b2Vec2,b2WeldJointDef.prototype.localAnchorB=new b2Vec2,b2WeldJointDef.prototype.referenceAngle=null;var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype),b2GearJointDef.prototype._super=b2JointDef.prototype,b2GearJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},b2GearJointDef.prototype.__varz=function(){},b2GearJointDef.prototype.joint1=null,b2GearJointDef.prototype.joint2=null,b2GearJointDef.prototype.ratio=null;var b2Color=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Color.prototype.__constructor=function(a,b,c){this._r=parseInt(255*b2Math.Clamp(a,0,1)),this._g=parseInt(255*b2Math.Clamp(b,0,1)),this._b=parseInt(255*b2Math.Clamp(c,0,1))},b2Color.prototype.__varz=function(){},b2Color.prototype.Set=function(a,b,c){this._r=parseInt(255*b2Math.Clamp(a,0,1)),this._g=parseInt(255*b2Math.Clamp(b,0,1)),this._b=parseInt(255*b2Math.Clamp(c,0,1))},b2Color.prototype.__defineGetter__("r",function(){return this._r}),b2Color.prototype.__defineSetter__("r",function(a){this._r=parseInt(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("g",function(){return this._g}),b2Color.prototype.__defineSetter__("g",function(a){this._g=parseInt(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("b",function(){return this._g}),b2Color.prototype.__defineSetter__("b",function(a){this._b=parseInt(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("color",function(){return this._r<<16|this._g<<8|this._b}),b2Color.prototype._r=0,b2Color.prototype._g=0,b2Color.prototype._b=0;var b2FrictionJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJoint.prototype,b2Joint.prototype),b2FrictionJoint.prototype._super=b2Joint.prototype,b2FrictionJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},b2FrictionJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearImpulse=new b2Vec2,this.m_linearMass=new b2Mat22},b2FrictionJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI,n=new b2Mat22;if(n.col1.x=j+k,n.col2.x=0,n.col1.y=0,n.col2.y=j+k,n.col1.x+=l*g*g,n.col2.x+=-l*f*g,n.col1.y+=-l*f*g,n.col2.y+=l*f*f,n.col1.x+=m*i*i,n.col2.x+=-m*h*i,n.col1.y+=-m*h*i,n.col2.y+=m*h*h,n.GetInverse(this.m_linearMass),this.m_angularMass=l+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting){this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio;var o=this.m_linearImpulse;d.m_linearVelocity.x-=j*o.x,d.m_linearVelocity.y-=j*o.y,d.m_angularVelocity-=l*(f*o.y-g*o.x+this.m_angularImpulse),e.m_linearVelocity.x+=k*o.x,e.m_linearVelocity.y+=k*o.y,e.m_angularVelocity+=m*(h*o.y-i*o.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},b2FrictionJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c,b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c;var r,s=i-g,t=-this.m_angularMass*s,u=this.m_angularImpulse;r=a.dt*this.m_maxTorque,this.m_angularImpulse=b2Math.Clamp(this.m_angularImpulse+t,-r,r),t=this.m_angularImpulse-u,g-=l*t,i+=m*t;var v=h.x-i*q-f.x+g*o,w=h.y+i*p-f.y-g*n,x=b2Math.MulMV(this.m_linearMass,new b2Vec2(-v,-w)),y=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(x),r=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>r*r&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(r)),x=b2Math.SubtractVV(this.m_linearImpulse,y),f.x-=j*x.x,f.y-=j*x.y,g-=l*(n*x.y-o*x.x),h.x+=k*x.x,h.y+=k*x.y,i+=m*(p*x.y-q*x.x),d.m_angularVelocity=g,e.m_angularVelocity=i},b2FrictionJoint.prototype.SolvePositionConstraints=function(a){return!0},b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2FrictionJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},b2FrictionJoint.prototype.GetReactionTorque=function(a){return a*this.m_angularImpulse},b2FrictionJoint.prototype.SetMaxForce=function(a){this.m_maxForce=a},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2FrictionJoint.prototype.SetMaxTorque=function(a){this.m_maxTorque=a},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},b2FrictionJoint.prototype.m_localAnchorA=new b2Vec2,b2FrictionJoint.prototype.m_localAnchorB=new b2Vec2,b2FrictionJoint.prototype.m_linearImpulse=new b2Vec2,b2FrictionJoint.prototype.m_angularImpulse=null,b2FrictionJoint.prototype.m_maxForce=null,b2FrictionJoint.prototype.m_maxTorque=null,b2FrictionJoint.prototype.m_linearMass=new b2Mat22,b2FrictionJoint.prototype.m_angularMass=null;var b2Distance=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){},b2Distance.prototype.__varz=function(){},b2Distance.Distance=function(a,b,c){++b2Distance.b2_gjkCalls;var d=c.proxyA,e=c.proxyB,f=c.transformA,g=c.transformB,h=b2Distance.s_simplex;h.ReadCache(b,d,f,e,g);for(var i,j=h.m_vertices,k=20,l=b2Distance.s_saveA,m=b2Distance.s_saveB,n=0,o=h.GetClosestPoint(),p=o.LengthSquared(),q=p,r=0,s=0;k>s;){for(n=h.m_count,r=0;n>r;r++)l[r]=j[r].indexA,m[r]=j[r].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:b2Settings.b2Assert(!1)}if(3==h.m_count)break;i=h.GetClosestPoint(),q=i.LengthSquared(),p=q;var t=h.GetSearchDirection();if(t.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var u=j[h.m_count];u.indexA=d.GetSupport(b2Math.MulTMV(f.R,t.GetNegative())),u.wA=b2Math.MulX(f,d.GetVertex(u.indexA)),u.indexB=e.GetSupport(b2Math.MulTMV(g.R,t)),u.wB=b2Math.MulX(g,e.GetVertex(u.indexB)),u.w=b2Math.SubtractVV(u.wB,u.wA),++s,++b2Distance.b2_gjkIters;var v=!1;for(r=0;n>r;r++)if(u.indexA==l[r]&&u.indexB==m[r]){v=!0;break}if(v)break;++h.m_count}if(b2Distance.b2_gjkMaxIters=b2Math.Max(b2Distance.b2_gjkMaxIters,s),h.GetWitnessPoints(a.pointA,a.pointB),a.distance=b2Math.SubtractVV(a.pointA,a.pointB).Length(),a.iterations=s,h.WriteCache(b),c.useRadii){var w=d.m_radius,x=e.m_radius;if(a.distance>w+x&&a.distance>Number.MIN_VALUE){a.distance-=w+x;var y=b2Math.SubtractVV(a.pointB,a.pointA);y.Normalize(),a.pointA.x+=w*y.x,a.pointA.y+=w*y.y,a.pointB.x-=x*y.x,a.pointB.y-=x*y.y}else i=new b2Vec2,i.x=.5*(a.pointA.x+a.pointB.x),i.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=i.x,a.pointA.y=a.pointB.y=i.y,a.distance=0}},b2Distance.b2_gjkCalls=0,b2Distance.b2_gjkIters=0,b2Distance.b2_gjkMaxIters=0,b2Distance.s_simplex=new b2Simplex,b2Distance.s_saveA=new Array(3),b2Distance.s_saveB=new Array(3);var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype),b2MouseJoint.prototype._super=b2Joint.prototype,b2MouseJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_beta=0,this.m_gamma=0},b2MouseJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_mass=new b2Mat22,this.m_C=new b2Vec2},b2MouseJoint.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=2*c*this.m_dampingRatio*d,f=c*d*d;this.m_gamma=a.dt*(e+a.dt*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*f*this.m_gamma;var g;g=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,i=this.m_localAnchor.y-b.m_sweep.localCenter.y,j=g.col1.x*h+g.col2.x*i;i=g.col1.y*h+g.col2.y*i,h=j;var k=b.m_invMass,l=b.m_invI;this.K1.col1.x=k,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=k,this.K2.col1.x=l*i*i,this.K2.col2.x=-l*h*i,this.K2.col1.y=-l*h*i,this.K2.col2.y=l*h*h,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+h-this.m_target.x,this.m_C.y=b.m_sweep.c.y+i-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,b.m_linearVelocity.x+=k*this.m_impulse.x,b.m_linearVelocity.y+=k*this.m_impulse.y,b.m_angularVelocity+=l*(h*this.m_impulse.y-i*this.m_impulse.x)},b2MouseJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e=this.m_bodyB;b=e.m_xf.R;var f=this.m_localAnchor.x-e.m_sweep.localCenter.x,g=this.m_localAnchor.y-e.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;var h=e.m_linearVelocity.x+-e.m_angularVelocity*g,i=e.m_linearVelocity.y+e.m_angularVelocity*f;b=this.m_mass,c=h+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,d=i+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var j=-(b.col1.x*c+b.col2.x*d),k=-(b.col1.y*c+b.col2.y*d),l=this.m_impulse.x,m=this.m_impulse.y;this.m_impulse.x+=j,this.m_impulse.y+=k;var n=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>n*n&&this.m_impulse.Multiply(n/this.m_impulse.Length()),j=this.m_impulse.x-l,k=this.m_impulse.y-m,e.m_linearVelocity.x+=e.m_invMass*j,e.m_linearVelocity.y+=e.m_invMass*k,e.m_angularVelocity+=e.m_invI*(f*k-g*j)},b2MouseJoint.prototype.SolvePositionConstraints=function(a){return!0},b2MouseJoint.prototype.GetAnchorA=function(){return this.m_target},b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b2MouseJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2MouseJoint.prototype.GetReactionTorque=function(a){return 0},b2MouseJoint.prototype.GetTarget=function(){return this.m_target},b2MouseJoint.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2MouseJoint.prototype.SetMaxForce=function(a){this.m_maxForce=a},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2MouseJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2MouseJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},b2MouseJoint.prototype.K=new b2Mat22,b2MouseJoint.prototype.K1=new b2Mat22,b2MouseJoint.prototype.K2=new b2Mat22,b2MouseJoint.prototype.m_localAnchor=new b2Vec2,b2MouseJoint.prototype.m_target=new b2Vec2,b2MouseJoint.prototype.m_impulse=new b2Vec2,b2MouseJoint.prototype.m_mass=new b2Mat22,b2MouseJoint.prototype.m_C=new b2Vec2,b2MouseJoint.prototype.m_maxForce=null,b2MouseJoint.prototype.m_frequencyHz=null,b2MouseJoint.prototype.m_dampingRatio=null,b2MouseJoint.prototype.m_beta=null,b2MouseJoint.prototype.m_gamma=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype),b2PrismaticJointDef.prototype._super=b2JointDef.prototype,b2PrismaticJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b2PrismaticJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2PrismaticJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2PrismaticJointDef.prototype.localAnchorA=new b2Vec2,b2PrismaticJointDef.prototype.localAnchorB=new b2Vec2,b2PrismaticJointDef.prototype.localAxisA=new b2Vec2,b2PrismaticJointDef.prototype.referenceAngle=null,b2PrismaticJointDef.prototype.enableLimit=null,b2PrismaticJointDef.prototype.lowerTranslation=null,b2PrismaticJointDef.prototype.upperTranslation=null,b2PrismaticJointDef.prototype.enableMotor=null,b2PrismaticJointDef.prototype.maxMotorForce=null,b2PrismaticJointDef.prototype.motorSpeed=null;var b2TimeOfImpact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){},b2TimeOfImpact.prototype.__varz=function(){},b2TimeOfImpact.TimeOfImpact=function(a){++b2TimeOfImpact.b2_toiCalls;var b=a.proxyA,c=a.proxyB,d=a.sweepA,e=a.sweepB;b2Settings.b2Assert(d.t0==e.t0),b2Settings.b2Assert(1-d.t0>Number.MIN_VALUE);var f=b.m_radius+c.m_radius,g=a.tolerance,h=0,i=1e3,j=0,k=0;for(b2TimeOfImpact.s_cache.count=0,b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(d.GetTransform(b2TimeOfImpact.s_xfA,h),e.GetTransform(b2TimeOfImpact.s_xfB,h),b2TimeOfImpact.s_distanceInput.proxyA=b,b2TimeOfImpact.s_distanceInput.proxyB=c,b2TimeOfImpact.s_distanceInput.transformA=b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_distanceInput.transformB=b2TimeOfImpact.s_xfB,b2Distance.Distance(b2TimeOfImpact.s_distanceOutput,b2TimeOfImpact.s_cache,b2TimeOfImpact.s_distanceInput),b2TimeOfImpact.s_distanceOutput.distance<=0){h=1;break}b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache,b,b2TimeOfImpact.s_xfA,c,b2TimeOfImpact.s_xfB);var l=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(0>=l){h=1;break}if(0==j&&(k=l>f?b2Math.Max(f-g,.75*f):b2Math.Max(l-g,.02*f)),.5*g>l-k){if(0==j){h=1;break}break}var m=h,n=h,o=1,p=l;d.GetTransform(b2TimeOfImpact.s_xfA,o),e.GetTransform(b2TimeOfImpact.s_xfB,o);var q=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(q>=k){h=1;break}for(var r=0;;){var s;s=1&r?n+(k-p)*(o-n)/(q-p):.5*(n+o),d.GetTransform(b2TimeOfImpact.s_xfA,s),e.GetTransform(b2TimeOfImpact.s_xfB,s);var t=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(b2Math.Abs(t-k)<.025*g){m=s;break}if(t>k?(n=s,p=t):(o=s,q=t),++r,++b2TimeOfImpact.b2_toiRootIters,50==r)break}if(b2TimeOfImpact.b2_toiMaxRootIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters,r),m<(1+100*Number.MIN_VALUE)*h)break;if(h=m,j++,++b2TimeOfImpact.b2_toiIters,j==i)break}return b2TimeOfImpact.b2_toiMaxIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxIters,j),h},b2TimeOfImpact.b2_toiCalls=0,b2TimeOfImpact.b2_toiIters=0,b2TimeOfImpact.b2_toiMaxIters=0,b2TimeOfImpact.b2_toiRootIters=0,b2TimeOfImpact.b2_toiMaxRootIters=0,b2TimeOfImpact.s_cache=new b2SimplexCache,b2TimeOfImpact.s_distanceInput=new b2DistanceInput,b2TimeOfImpact.s_xfA=new b2Transform,b2TimeOfImpact.s_xfB=new b2Transform,b2TimeOfImpact.s_fcn=new b2SeparationFunction,b2TimeOfImpact.s_distanceOutput=new b2DistanceOutput;var b2GearJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype),b2GearJoint.prototype._super=b2Joint.prototype,b2GearJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);var b=a.joint1.m_type,c=a.joint2.m_type;this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var d,e;this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b==b2Joint.e_revoluteJoint?(this.m_revolute1=a.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c==b2Joint.e_revoluteJoint?(this.m_revolute2=a.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=d+this.m_ratio*e,this.m_impulse=0},b2GearJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian},b2GearJoint.prototype.InitVelocityConstraints=function(a){var b,c,d,e,f,g,h,i,j=this.m_ground1,k=this.m_ground2,l=this.m_bodyA,m=this.m_bodyB,n=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,n+=l.m_invI):(f=j.m_xf.R,g=this.m_prismatic1.m_localXAxis1,b=f.col1.x*g.x+f.col2.x*g.y,c=f.col1.y*g.x+f.col2.y*g.y,f=l.m_xf.R,d=this.m_localAnchor1.x-l.m_sweep.localCenter.x,e=this.m_localAnchor1.y-l.m_sweep.localCenter.y,i=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=i,h=d*c-e*b,this.m_J.linearA.Set(-b,-c),this.m_J.angularA=-h,n+=l.m_invMass+l.m_invI*h*h),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*m.m_invI):(f=k.m_xf.R,g=this.m_prismatic2.m_localXAxis1,b=f.col1.x*g.x+f.col2.x*g.y,c=f.col1.y*g.x+f.col2.y*g.y,f=m.m_xf.R,d=this.m_localAnchor2.x-m.m_sweep.localCenter.x,e=this.m_localAnchor2.y-m.m_sweep.localCenter.y,i=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=i,h=d*c-e*b,this.m_J.linearB.Set(-this.m_ratio*b,-this.m_ratio*c),this.m_J.angularB=-this.m_ratio*h,n+=this.m_ratio*this.m_ratio*(m.m_invMass+m.m_invI*h*h)),this.m_mass=n>0?1/n:0,a.warmStarting?(l.m_linearVelocity.x+=l.m_invMass*this.m_impulse*this.m_J.linearA.x,l.m_linearVelocity.y+=l.m_invMass*this.m_impulse*this.m_J.linearA.y,l.m_angularVelocity+=l.m_invI*this.m_impulse*this.m_J.angularA,m.m_linearVelocity.x+=m.m_invMass*this.m_impulse*this.m_J.linearB.x,m.m_linearVelocity.y+=m.m_invMass*this.m_impulse*this.m_J.linearB.y,m.m_angularVelocity+=m.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},b2GearJoint.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity),e=-this.m_mass*d;this.m_impulse+=e,b.m_linearVelocity.x+=b.m_invMass*e*this.m_J.linearA.x,b.m_linearVelocity.y+=b.m_invMass*e*this.m_J.linearA.y,b.m_angularVelocity+=b.m_invI*e*this.m_J.angularA,c.m_linearVelocity.x+=c.m_invMass*e*this.m_J.linearB.x,c.m_linearVelocity.y+=c.m_invMass*e*this.m_J.linearB.y,c.m_angularVelocity+=c.m_invI*e*this.m_J.angularB},b2GearJoint.prototype.SolvePositionConstraints=function(a){var b,c,d=0,e=this.m_bodyA,f=this.m_bodyB;b=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),c=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var g=this.m_constant-(b+this.m_ratio*c),h=-this.m_mass*g;return e.m_sweep.c.x+=e.m_invMass*h*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*h*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*h*this.m_J.angularA,f.m_sweep.c.x+=f.m_invMass*h*this.m_J.linearB.x,f.m_sweep.c.y+=f.m_invMass*h*this.m_J.linearB.y,f.m_sweep.a+=f.m_invI*h*this.m_J.angularB,e.SynchronizeTransform(),f.SynchronizeTransform(),d<b2Settings.b2_linearSlop},b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2GearJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},b2GearJoint.prototype.GetReactionTorque=function(a){var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d,c=e;var f=this.m_impulse*this.m_J.linearB.x,g=this.m_impulse*this.m_J.linearB.y;return a*(this.m_impulse*this.m_J.angularB-c*g+d*f)},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},b2GearJoint.prototype.SetRatio=function(a){this.m_ratio=a},b2GearJoint.prototype.m_ground1=null,b2GearJoint.prototype.m_ground2=null,b2GearJoint.prototype.m_revolute1=null,b2GearJoint.prototype.m_prismatic1=null,b2GearJoint.prototype.m_revolute2=null,b2GearJoint.prototype.m_prismatic2=null,b2GearJoint.prototype.m_groundAnchor1=new b2Vec2,b2GearJoint.prototype.m_groundAnchor2=new b2Vec2,b2GearJoint.prototype.m_localAnchor1=new b2Vec2,b2GearJoint.prototype.m_localAnchor2=new b2Vec2,b2GearJoint.prototype.m_J=new b2Jacobian,b2GearJoint.prototype.m_constant=null,b2GearJoint.prototype.m_ratio=null,b2GearJoint.prototype.m_mass=null,b2GearJoint.prototype.m_impulse=null;var b2TOIInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TOIInput.prototype.__constructor=function(){},b2TOIInput.prototype.__varz=function(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep},b2TOIInput.prototype.proxyA=new b2DistanceProxy,b2TOIInput.prototype.proxyB=new b2DistanceProxy,
b2TOIInput.prototype.sweepA=new b2Sweep,b2TOIInput.prototype.sweepB=new b2Sweep,b2TOIInput.prototype.tolerance=null;var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype),b2RevoluteJointDef.prototype._super=b2JointDef.prototype,b2RevoluteJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},b2RevoluteJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2RevoluteJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2RevoluteJointDef.prototype.localAnchorA=new b2Vec2,b2RevoluteJointDef.prototype.localAnchorB=new b2Vec2,b2RevoluteJointDef.prototype.referenceAngle=null,b2RevoluteJointDef.prototype.enableLimit=null,b2RevoluteJointDef.prototype.lowerAngle=null,b2RevoluteJointDef.prototype.upperAngle=null,b2RevoluteJointDef.prototype.enableMotor=null,b2RevoluteJointDef.prototype.motorSpeed=null,b2RevoluteJointDef.prototype.maxMotorTorque=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype),b2MouseJointDef.prototype._super=b2JointDef.prototype,b2MouseJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},b2MouseJointDef.prototype.__varz=function(){this.target=new b2Vec2},b2MouseJointDef.prototype.target=new b2Vec2,b2MouseJointDef.prototype.maxForce=null,b2MouseJointDef.prototype.frequencyHz=null,b2MouseJointDef.prototype.dampingRatio=null;var b2Contact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Contact.prototype.__constructor=function(){},b2Contact.prototype.__varz=function(){this.m_nodeA=new b2ContactEdge,this.m_nodeB=new b2ContactEdge,this.m_manifold=new b2Manifold,this.m_oldManifold=new b2Manifold},b2Contact.s_input=new b2TOIInput,b2Contact.e_sensorFlag=1,b2Contact.e_continuousFlag=2,b2Contact.e_islandFlag=4,b2Contact.e_toiFlag=8,b2Contact.e_touchingFlag=16,b2Contact.e_enabledFlag=32,b2Contact.e_filterFlag=64,b2Contact.prototype.Reset=function(a,b){if(this.m_flags=b2Contact.e_enabledFlag,!a||!b)return this.m_fixtureA=null,void(this.m_fixtureB=null);(a.IsSensor()||b.IsSensor())&&(this.m_flags|=b2Contact.e_sensorFlag);var c=a.GetBody(),d=b.GetBody();(c.GetType()!=b2Body.b2_dynamicBody||c.IsBullet()||d.GetType()!=b2Body.b2_dynamicBody||d.IsBullet())&&(this.m_flags|=b2Contact.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},b2Contact.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=b2Contact.e_enabledFlag;var c=!1,d=(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag,e=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body,g=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b2Contact.e_sensorFlag){if(g){var h=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape(),j=e.GetTransform(),k=f.GetTransform();c=b2Shape.TestOverlap(h,j,i,k)}this.m_manifold.m_pointCount=0}else{if(e.GetType()!=b2Body.b2_dynamicBody||e.IsBullet()||f.GetType()!=b2Body.b2_dynamicBody||f.IsBullet()?this.m_flags|=b2Contact.e_continuousFlag:this.m_flags&=~b2Contact.e_continuousFlag,g){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var l=0;l<this.m_manifold.m_pointCount;++l){var m=this.m_manifold.m_points[l];m.m_normalImpulse=0,m.m_tangentImpulse=0;for(var n=m.m_id,o=0;o<this.m_oldManifold.m_pointCount;++o){var p=this.m_oldManifold.m_points[o];if(p.m_id.key==n.key){m.m_normalImpulse=p.m_normalImpulse,m.m_tangentImpulse=p.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!=d&&(e.SetAwake(!0),f.SetAwake(!0))}c?this.m_flags|=b2Contact.e_touchingFlag:this.m_flags&=~b2Contact.e_touchingFlag,0==d&&1==c&&a.BeginContact(this),1==d&&0==c&&a.EndContact(this),0==(this.m_flags&b2Contact.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},b2Contact.prototype.Evaluate=function(){},b2Contact.prototype.ComputeTOI=function(a,b){return b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),b2Contact.s_input.sweepA=a,b2Contact.s_input.sweepB=b,b2Contact.s_input.tolerance=b2Settings.b2_linearSlop,b2TimeOfImpact.TimeOfImpact(b2Contact.s_input)},b2Contact.prototype.GetManifold=function(){return this.m_manifold},b2Contact.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},b2Contact.prototype.IsTouching=function(){return(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag},b2Contact.prototype.IsContinuous=function(){return(this.m_flags&b2Contact.e_continuousFlag)==b2Contact.e_continuousFlag},b2Contact.prototype.SetSensor=function(a){a?this.m_flags|=b2Contact.e_sensorFlag:this.m_flags&=~b2Contact.e_sensorFlag},b2Contact.prototype.IsSensor=function(){return(this.m_flags&b2Contact.e_sensorFlag)==b2Contact.e_sensorFlag},b2Contact.prototype.SetEnabled=function(a){a?this.m_flags|=b2Contact.e_enabledFlag:this.m_flags&=~b2Contact.e_enabledFlag},b2Contact.prototype.IsEnabled=function(){return(this.m_flags&b2Contact.e_enabledFlag)==b2Contact.e_enabledFlag},b2Contact.prototype.GetNext=function(){return this.m_next},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=b2Contact.e_filterFlag},b2Contact.prototype.m_flags=0,b2Contact.prototype.m_prev=null,b2Contact.prototype.m_next=null,b2Contact.prototype.m_nodeA=new b2ContactEdge,b2Contact.prototype.m_nodeB=new b2ContactEdge,b2Contact.prototype.m_fixtureA=null,b2Contact.prototype.m_fixtureB=null,b2Contact.prototype.m_manifold=new b2Manifold,b2Contact.prototype.m_oldManifold=new b2Manifold,b2Contact.prototype.m_toi=null;var b2ContactConstraint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraint.prototype.__constructor=function(){this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.points[a]=new b2ContactConstraintPoint},b2ContactConstraint.prototype.__varz=function(){this.localPlaneNormal=new b2Vec2,this.localPoint=new b2Vec2,this.normal=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22},b2ContactConstraint.prototype.points=null,b2ContactConstraint.prototype.localPlaneNormal=new b2Vec2,b2ContactConstraint.prototype.localPoint=new b2Vec2,b2ContactConstraint.prototype.normal=new b2Vec2,b2ContactConstraint.prototype.normalMass=new b2Mat22,b2ContactConstraint.prototype.K=new b2Mat22,b2ContactConstraint.prototype.bodyA=null,b2ContactConstraint.prototype.bodyB=null,b2ContactConstraint.prototype.type=0,b2ContactConstraint.prototype.radius=null,b2ContactConstraint.prototype.friction=null,b2ContactConstraint.prototype.restitution=null,b2ContactConstraint.prototype.pointCount=0,b2ContactConstraint.prototype.manifold=null;var b2ContactResult=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactResult.prototype.__constructor=function(){},b2ContactResult.prototype.__varz=function(){this.position=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactResult.prototype.shape1=null,b2ContactResult.prototype.shape2=null,b2ContactResult.prototype.position=new b2Vec2,b2ContactResult.prototype.normal=new b2Vec2,b2ContactResult.prototype.normalImpulse=null,b2ContactResult.prototype.tangentImpulse=null,b2ContactResult.prototype.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype),b2PolygonContact.prototype._super=b2Contact.prototype,b2PolygonContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolygonContact.prototype.__varz=function(){},b2PolygonContact.Create=function(a){return new b2PolygonContact},b2PolygonContact.Destroy=function(a,b){},b2PolygonContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolygonContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var ClipVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){},ClipVertex.prototype.__varz=function(){this.v=new b2Vec2,this.id=new b2ContactID},ClipVertex.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},ClipVertex.prototype.v=new b2Vec2,ClipVertex.prototype.id=new b2ContactID;var b2ContactFilter=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){},b2ContactFilter.prototype.__varz=function(){},b2ContactFilter.b2_defaultFilter=new b2ContactFilter,b2ContactFilter.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();if(c.groupIndex==d.groupIndex&&0!=c.groupIndex)return c.groupIndex>0;var e=0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits);return e},b2ContactFilter.prototype.RayCollide=function(a,b){return a?this.ShouldCollide(a,b):!0};var b2NullContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype),b2NullContact.prototype._super=b2Contact.prototype,b2NullContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2NullContact.prototype.__varz=function(){},b2NullContact.prototype.Evaluate=function(){};var b2ContactListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactListener.prototype.__constructor=function(){},b2ContactListener.prototype.__varz=function(){},b2ContactListener.b2_defaultListener=new b2ContactListener,b2ContactListener.prototype.BeginContact=function(a){},b2ContactListener.prototype.EndContact=function(a){},b2ContactListener.prototype.PreSolve=function(a,b){},b2ContactListener.prototype.PostSolve=function(a,b){};var b2Island=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Island.prototype.__constructor=function(){this.m_bodies=new Array,this.m_contacts=new Array,this.m_joints=new Array},b2Island.prototype.__varz=function(){},b2Island.s_impulse=new b2ContactImpulse,b2Island.prototype.Initialize=function(a,b,c,d,e,f){var g=0;for(this.m_bodyCapacity=a,this.m_contactCapacity=b,this.m_jointCapacity=c,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=d,this.m_listener=e,this.m_contactSolver=f,g=this.m_bodies.length;a>g;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;b>g;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;c>g;g++)this.m_joints[g]=null},b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},b2Island.prototype.Solve=function(a,b,c){var d,e,f=0,g=0;for(f=0;f<this.m_bodyCount;++f)d=this.m_bodies[f],d.GetType()==b2Body.b2_dynamicBody&&(d.m_linearVelocity.x+=a.dt*(b.x+d.m_invMass*d.m_force.x),d.m_linearVelocity.y+=a.dt*(b.y+d.m_invMass*d.m_force.y),d.m_angularVelocity+=a.dt*d.m_invI*d.m_torque,d.m_linearVelocity.Multiply(b2Math.Clamp(1-a.dt*d.m_linearDamping,0,1)),d.m_angularVelocity*=b2Math.Clamp(1-a.dt*d.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var h=this.m_contactSolver;for(h.InitVelocityConstraints(a),f=0;f<this.m_jointCount;++f)e=this.m_joints[f],e.InitVelocityConstraints(a);for(f=0;f<a.velocityIterations;++f){for(g=0;g<this.m_jointCount;++g)e=this.m_joints[g],e.SolveVelocityConstraints(a);h.SolveVelocityConstraints()}for(f=0;f<this.m_jointCount;++f)e=this.m_joints[f],e.FinalizeVelocityConstraints();for(h.FinalizeVelocityConstraints(),f=0;f<this.m_bodyCount;++f)if(d=this.m_bodies[f],d.GetType()!=b2Body.b2_staticBody){var i=a.dt*d.m_linearVelocity.x,j=a.dt*d.m_linearVelocity.y;i*i+j*j>b2Settings.b2_maxTranslationSquared&&(d.m_linearVelocity.Normalize(),d.m_linearVelocity.x*=b2Settings.b2_maxTranslation*a.inv_dt,d.m_linearVelocity.y*=b2Settings.b2_maxTranslation*a.inv_dt);var k=a.dt*d.m_angularVelocity;k*k>b2Settings.b2_maxRotationSquared&&(d.m_angularVelocity<0?d.m_angularVelocity=-b2Settings.b2_maxRotation*a.inv_dt:d.m_angularVelocity=b2Settings.b2_maxRotation*a.inv_dt),d.m_sweep.c0.SetV(d.m_sweep.c),d.m_sweep.a0=d.m_sweep.a,d.m_sweep.c.x+=a.dt*d.m_linearVelocity.x,d.m_sweep.c.y+=a.dt*d.m_linearVelocity.y,d.m_sweep.a+=a.dt*d.m_angularVelocity,d.SynchronizeTransform()}for(f=0;f<a.positionIterations;++f){var l=h.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),m=!0;for(g=0;g<this.m_jointCount;++g){e=this.m_joints[g];var n=e.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);m=m&&n}if(l&&m)break}if(this.Report(h.m_constraints),c){var o=Number.MAX_VALUE,p=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,q=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(f=0;f<this.m_bodyCount;++f)d=this.m_bodies[f],d.GetType()!=b2Body.b2_staticBody&&(0==(d.m_flags&b2Body.e_allowSleepFlag)&&(d.m_sleepTime=0,o=0),0==(d.m_flags&b2Body.e_allowSleepFlag)||d.m_angularVelocity*d.m_angularVelocity>q||b2Math.Dot(d.m_linearVelocity,d.m_linearVelocity)>p?(d.m_sleepTime=0,o=0):(d.m_sleepTime+=a.dt,o=b2Math.Min(o,d.m_sleepTime)));if(o>=b2Settings.b2_timeToSleep)for(f=0;f<this.m_bodyCount;++f)d=this.m_bodies[f],d.SetAwake(!1)}},b2Island.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var d=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(d.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b){var e=this.m_bodies[b];if(e.GetType()!=b2Body.b2_staticBody){var f=a.dt*e.m_linearVelocity.x,g=a.dt*e.m_linearVelocity.y;f*f+g*g>b2Settings.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=b2Settings.b2_maxTranslation*a.inv_dt,e.m_linearVelocity.y*=b2Settings.b2_maxTranslation*a.inv_dt);var h=a.dt*e.m_angularVelocity;h*h>b2Settings.b2_maxRotationSquared&&(e.m_angularVelocity<0?e.m_angularVelocity=-b2Settings.b2_maxRotation*a.inv_dt:e.m_angularVelocity=b2Settings.b2_maxRotation*a.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=a.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=a.dt*e.m_linearVelocity.y,e.m_sweep.a+=a.dt*e.m_angularVelocity,e.SynchronizeTransform()}}var i=.75;for(b=0;b<a.positionIterations;++b){var j=d.SolvePositionConstraints(i),k=!0;for(c=0;c<this.m_jointCount;++c){var l=this.m_joints[c].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);k=k&&l}if(j&&k)break}this.Report(d.m_constraints)},b2Island.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],e=0;e<d.pointCount;++e)b2Island.s_impulse.normalImpulses[e]=d.points[e].normalImpulse,b2Island.s_impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,b2Island.s_impulse)}},b2Island.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=a},b2Island.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a},b2Island.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a},b2Island.prototype.m_allocator=null,b2Island.prototype.m_listener=null,b2Island.prototype.m_contactSolver=null,b2Island.prototype.m_bodies=null,b2Island.prototype.m_contacts=null,b2Island.prototype.m_joints=null,b2Island.prototype.m_bodyCount=0,b2Island.prototype.m_jointCount=0,b2Island.prototype.m_contactCount=0,b2Island.prototype.m_bodyCapacity=0,b2Island.prototype.m_contactCapacity=0,b2Island.prototype.m_jointCapacity=0;var b2PolyAndEdgeContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndEdgeContact.prototype,b2Contact.prototype),b2PolyAndEdgeContact.prototype._super=b2Contact.prototype,b2PolyAndEdgeContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndEdgeContact.prototype.__varz=function(){},b2PolyAndEdgeContact.Create=function(a){return new b2PolyAndEdgeContact},b2PolyAndEdgeContact.Destroy=function(a,b){},b2PolyAndEdgeContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(a,b,c,d,e){},b2PolyAndEdgeContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b]),b2Settings.b2Assert(a.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(b.GetType()==b2Shape.e_edgeShape)};var b2Collision=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){},b2Collision.prototype.__varz=function(){},b2Collision.MakeClipPointVector=function(){var a=new Array(2);return a[0]=new ClipVertex,a[1]=new ClipVertex,a},b2Collision.ClipSegmentToLine=function(a,b,c,d){var e,f=0;e=b[0];var g=e.v;e=b[1];var h=e.v,i=c.x*g.x+c.y*g.y-d,j=c.x*h.x+c.y*h.y-d;if(0>=i&&a[f++].Set(b[0]),0>=j&&a[f++].Set(b[1]),0>i*j){var k=i/(i-j);e=a[f];var l=e.v;l.x=g.x+k*(h.x-g.x),l.y=g.y+k*(h.y-g.y),e=a[f];var m;i>0?(m=b[0],e.id=m.id):(m=b[1],e.id=m.id),++f}return f},b2Collision.EdgeSeparation=function(a,b,c,d,e){var f,g,h=(a.m_vertexCount,a.m_vertices),i=a.m_normals,j=d.m_vertexCount,k=d.m_vertices;f=b.R,g=i[c];var l=f.col1.x*g.x+f.col2.x*g.y,m=f.col1.y*g.x+f.col2.y*g.y;f=e.R;for(var n=f.col1.x*l+f.col1.y*m,o=f.col2.x*l+f.col2.y*m,p=0,q=Number.MAX_VALUE,r=0;j>r;++r){g=k[r];var s=g.x*n+g.y*o;q>s&&(q=s,p=r)}g=h[c],f=b.R;var t=b.position.x+(f.col1.x*g.x+f.col2.x*g.y),u=b.position.y+(f.col1.y*g.x+f.col2.y*g.y);g=k[p],f=e.R;var v=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),w=e.position.y+(f.col1.y*g.x+f.col2.y*g.y);v-=t,w-=u;var x=v*l+w*m;return x},b2Collision.FindMaxSeparation=function(a,b,c,d,e){var f,g,h=b.m_vertexCount,i=b.m_normals;g=e.R,f=d.m_centroid;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),k=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);g=c.R,f=b.m_centroid,j-=c.position.x+(g.col1.x*f.x+g.col2.x*f.y),k-=c.position.y+(g.col1.y*f.x+g.col2.y*f.y);for(var l=j*c.R.col1.x+k*c.R.col1.y,m=j*c.R.col2.x+k*c.R.col2.y,n=0,o=-Number.MAX_VALUE,p=0;h>p;++p){f=i[p];var q=f.x*l+f.y*m;q>o&&(o=q,n=p)}var r,s=b2Collision.EdgeSeparation(b,c,n,d,e),t=n-1>=0?n-1:h-1,u=b2Collision.EdgeSeparation(b,c,t,d,e),v=h>n+1?n+1:0,w=b2Collision.EdgeSeparation(b,c,v,d,e),x=0,y=0;if(u>s&&u>w)y=-1,x=t,r=u;else{if(!(w>s))return a[0]=n,s;y=1,x=v,r=w}for(;;){if(n=-1==y?x-1>=0?x-1:h-1:h>x+1?x+1:0,s=b2Collision.EdgeSeparation(b,c,n,d,e),!(s>r))break;x=n,r=s}return a[0]=x,r},b2Collision.FindIncidentEdge=function(a,b,c,d,e,f){var g,h,i=(b.m_vertexCount,b.m_normals),j=e.m_vertexCount,k=e.m_vertices,l=e.m_normals;g=c.R,h=i[d];var m=g.col1.x*h.x+g.col2.x*h.y,n=g.col1.y*h.x+g.col2.y*h.y;g=f.R;var o=g.col1.x*m+g.col1.y*n;n=g.col2.x*m+g.col2.y*n,m=o;for(var p=0,q=Number.MAX_VALUE,r=0;j>r;++r){h=l[r];var s=m*h.x+n*h.y;q>s&&(q=s,p=r)}var t,u=p,v=j>u+1?u+1:0;t=a[0],h=k[u],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=u,t.id.features.incidentVertex=0,t=a[1],h=k[v],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=v,t.id.features.incidentVertex=1},b2Collision.CollidePolygons=function(a,b,c,d,e){var f;a.m_pointCount=0;var g=b.m_radius+d.m_radius,h=0;b2Collision.s_edgeAO[0]=h;var i=b2Collision.FindMaxSeparation(b2Collision.s_edgeAO,b,c,d,e);if(h=b2Collision.s_edgeAO[0],!(i>g)){var j=0;b2Collision.s_edgeBO[0]=j;var k=b2Collision.FindMaxSeparation(b2Collision.s_edgeBO,d,e,b,c);if(j=b2Collision.s_edgeBO[0],!(k>g)){var l,m,n,o,p,q=0,r=0,s=.98,t=.001;k>s*i+t?(l=d,m=b,n=e,o=c,q=j,a.m_type=b2Manifold.e_faceB,r=1):(l=b,m=d,n=c,o=e,q=h,a.m_type=b2Manifold.e_faceA,r=0);var u=b2Collision.s_incidentEdge;b2Collision.FindIncidentEdge(u,l,n,q,m,o);var v,w=l.m_vertexCount,x=l.m_vertices,y=x[q];v=w>q+1?x[parseInt(q+1)]:x[0];var z=b2Collision.s_localTangent;z.Set(v.x-y.x,v.y-y.y),z.Normalize();var A=b2Collision.s_localNormal;A.x=z.y,A.y=-z.x;var B=b2Collision.s_planePoint;B.Set(.5*(y.x+v.x),.5*(y.y+v.y));var C=b2Collision.s_tangent;p=n.R,C.x=p.col1.x*z.x+p.col2.x*z.y,C.y=p.col1.y*z.x+p.col2.y*z.y;var D=b2Collision.s_tangent2;D.x=-C.x,D.y=-C.y;var E=b2Collision.s_normal;E.x=C.y,E.y=-C.x;var F=b2Collision.s_v11,G=b2Collision.s_v12;F.x=n.position.x+(p.col1.x*y.x+p.col2.x*y.y),F.y=n.position.y+(p.col1.y*y.x+p.col2.y*y.y),G.x=n.position.x+(p.col1.x*v.x+p.col2.x*v.y),G.y=n.position.y+(p.col1.y*v.x+p.col2.y*v.y);var H=E.x*F.x+E.y*F.y,I=-C.x*F.x-C.y*F.y+g,J=C.x*G.x+C.y*G.y+g,K=b2Collision.s_clipPoints1,L=b2Collision.s_clipPoints2,M=0;if(M=b2Collision.ClipSegmentToLine(K,u,D,I),!(2>M||(M=b2Collision.ClipSegmentToLine(L,K,C,J),2>M))){a.m_localPlaneNormal.SetV(A),a.m_localPoint.SetV(B);for(var N=0,O=0;O<b2Settings.b2_maxManifoldPoints;++O){f=L[O];var P=E.x*f.v.x+E.y*f.v.y-H;if(g>=P){var Q=a.m_points[N];p=o.R;var R=f.v.x-o.position.x,S=f.v.y-o.position.y;Q.m_localPoint.x=R*p.col1.x+S*p.col1.y,Q.m_localPoint.y=R*p.col2.x+S*p.col2.y,Q.m_id.Set(f.id),Q.m_id.features.flip=r,++N}}a.m_pointCount=N}}}},b2Collision.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f,g;f=c.R,g=b.m_p;var h=c.position.x+(f.col1.x*g.x+f.col2.x*g.y),i=c.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=e.R,g=d.m_p;var j=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),k=e.position.y+(f.col1.y*g.x+f.col2.y*g.y),l=j-h,m=k-i,n=l*l+m*m,o=b.m_radius+d.m_radius;n>o*o||(a.m_type=b2Manifold.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0)},b2Collision.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;var f,g,h,i;i=e.R,h=d.m_p;var j=e.position.x+(i.col1.x*h.x+i.col2.x*h.y),k=e.position.y+(i.col1.y*h.x+i.col2.y*h.y);f=j-c.position.x,g=k-c.position.y,i=c.R;for(var l=f*i.col1.x+g*i.col1.y,m=f*i.col2.x+g*i.col2.y,n=0,o=-Number.MAX_VALUE,p=b.m_radius+d.m_radius,q=b.m_vertexCount,r=b.m_vertices,s=b.m_normals,t=0;q>t;++t){h=r[t],f=l-h.x,g=m-h.y,h=s[t];var u=h.x*f+h.y*g;if(u>p)return;u>o&&(o=u,n=t)}var v=n,w=q>v+1?v+1:0,x=r[v],y=r[w];if(o<Number.MIN_VALUE)return a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.SetV(s[n]),a.m_localPoint.x=.5*(x.x+y.x),a.m_localPoint.y=.5*(x.y+y.y),a.m_points[0].m_localPoint.SetV(d.m_p),void(a.m_points[0].m_id.key=0);var z=(l-x.x)*(y.x-x.x)+(m-x.y)*(y.y-x.y),A=(l-y.x)*(x.x-y.x)+(m-y.y)*(x.y-y.y);if(0>=z){if((l-x.x)*(l-x.x)+(m-x.y)*(m-x.y)>p*p)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=l-x.x,a.m_localPlaneNormal.y=m-x.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(x),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else if(0>=A){if((l-y.x)*(l-y.x)+(m-y.y)*(m-y.y)>p*p)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=l-y.x,a.m_localPlaneNormal.y=m-y.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(y),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else{var B=.5*(x.x+y.x),C=.5*(x.y+y.y);if(o=(l-B)*s[v].x+(m-C)*s[v].y,o>p)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=s[v].x,a.m_localPlaneNormal.y=s[v].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(B,C),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}},b2Collision.TestOverlap=function(a,b){var c=b.lowerBound,d=a.upperBound,e=c.x-d.x,f=c.y-d.y;c=a.lowerBound,d=b.upperBound;var g=c.x-d.x,h=c.y-d.y;return e>0||f>0?!1:g>0||h>0?!1:!0},b2Collision.b2_nullFeature=255,b2Collision.s_incidentEdge=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints1=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints2=b2Collision.MakeClipPointVector(),b2Collision.s_edgeAO=new Array(1),b2Collision.s_edgeBO=new Array(1),b2Collision.s_localTangent=new b2Vec2,b2Collision.s_localNormal=new b2Vec2,b2Collision.s_planePoint=new b2Vec2,b2Collision.s_normal=new b2Vec2,b2Collision.s_tangent=new b2Vec2,b2Collision.s_tangent2=new b2Vec2,b2Collision.s_v11=new b2Vec2,b2Collision.s_v12=new b2Vec2,b2Collision.b2CollidePolyTempVec=new b2Vec2;var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype),b2PolyAndCircleContact.prototype._super=b2Contact.prototype,b2PolyAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndCircleContact.prototype.__varz=function(){},b2PolyAndCircleContact.Create=function(a){return new b2PolyAndCircleContact},b2PolyAndCircleContact.Destroy=function(a,b){},b2PolyAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolyAndCircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b]),b2Settings.b2Assert(a.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(b.GetType()==b2Shape.e_circleShape)};var b2ContactPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactPoint.prototype.__constructor=function(){},b2ContactPoint.prototype.__varz=function(){this.position=new b2Vec2,this.velocity=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactPoint.prototype.shape1=null,b2ContactPoint.prototype.shape2=null,b2ContactPoint.prototype.position=new b2Vec2,b2ContactPoint.prototype.velocity=new b2Vec2,b2ContactPoint.prototype.normal=new b2Vec2,b2ContactPoint.prototype.separation=null,b2ContactPoint.prototype.friction=null,b2ContactPoint.prototype.restitution=null,b2ContactPoint.prototype.id=new b2ContactID;var b2CircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype),b2CircleContact.prototype._super=b2Contact.prototype,b2CircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2CircleContact.prototype.__varz=function(){},b2CircleContact.Create=function(a){return new b2CircleContact},b2CircleContact.Destroy=function(a,b){},b2CircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2CircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var b2EdgeAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeAndCircleContact.prototype,b2Contact.prototype),b2EdgeAndCircleContact.prototype._super=b2Contact.prototype,b2EdgeAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2EdgeAndCircleContact.prototype.__varz=function(){},b2EdgeAndCircleContact.Create=function(a){return new b2EdgeAndCircleContact},b2EdgeAndCircleContact.Destroy=function(a,b){},b2EdgeAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(a,b,c,d,e){},b2EdgeAndCircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var b2ContactManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactManager.prototype.__constructor=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory(this.m_allocator),this.m_broadPhase=new b2DynamicTreeBroadPhase},b2ContactManager.prototype.__varz=function(){},b2ContactManager.s_evalCP=new b2ContactPoint,b2ContactManager.prototype.AddPair=function(a,b){var c=a,d=b,e=c.GetBody(),f=d.GetBody();if(e!=f){for(var g=f.GetContactList();g;){if(g.other==e){var h=g.contact.GetFixtureA(),i=g.contact.GetFixtureB();if(h==c&&i==d)return;if(h==d&&i==c)return}g=g.next}if(0!=f.ShouldCollide(e)&&0!=this.m_contactFilter.ShouldCollide(c,d)){var j=this.m_contactFactory.Create(c,d);c=j.GetFixtureA(),d=j.GetFixtureB(),e=c.m_body,f=d.m_body,j.m_prev=null,j.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=j),this.m_world.m_contactList=j,j.m_nodeA.contact=j,j.m_nodeA.other=f,j.m_nodeA.prev=null,j.m_nodeA.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=j.m_nodeA),e.m_contactList=j.m_nodeA,j.m_nodeB.contact=j,j.m_nodeB.other=e,j.m_nodeB.prev=null,j.m_nodeB.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=j.m_nodeB),f.m_contactList=j.m_nodeB,++this.m_world.m_contactCount}}},b2ContactManager.prototype.FindNewContacts=function(){var a=this;this.m_broadPhase.UpdatePairs(function(b,c){return a.AddPair(b,c)})},b2ContactManager.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a),a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next),a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next),a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev),a.m_nodeA==d.m_contactList&&(d.m_contactList=a.m_nodeA.next),a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next),a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev),a.m_nodeB==e.m_contactList&&(e.m_contactList=a.m_nodeB.next),this.m_contactFactory.Destroy(a),--this.m_contactCount},b2ContactManager.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();if(0!=d.IsAwake()||0!=e.IsAwake()){if(a.m_flags&b2Contact.e_filterFlag){if(0==e.ShouldCollide(d)){var f=a;a=f.GetNext(),this.Destroy(f);continue}if(0==this.m_contactFilter.ShouldCollide(b,c)){f=a,a=f.GetNext(),this.Destroy(f);continue}a.m_flags&=~b2Contact.e_filterFlag}var g=b.m_proxy,h=c.m_proxy,i=this.m_broadPhase.TestOverlap(g,h);0!=i?(a.Update(this.m_contactListener),a=a.GetNext()):(f=a,a=f.GetNext(),this.Destroy(f))}else a=a.GetNext()}},b2ContactManager.prototype.m_world=null,b2ContactManager.prototype.m_broadPhase=null,b2ContactManager.prototype.m_contactList=null,b2ContactManager.prototype.m_contactCount=0,b2ContactManager.prototype.m_contactFilter=null,b2ContactManager.prototype.m_contactListener=null,b2ContactManager.prototype.m_contactFactory=null,
b2ContactManager.prototype.m_allocator=null;var b2World=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2World.prototype.__constructor=function(a,b){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,b2World.m_warmStarting=!0,b2World.m_continuousPhysics=!0,this.m_allowSleep=b,this.m_gravity=a,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var c=new b2BodyDef;this.m_groundBody=this.CreateBody(c)},b2World.prototype.__varz=function(){this.s_stack=new Array,this.m_contactManager=new b2ContactManager,this.m_contactSolver=new b2ContactSolver,this.m_island=new b2Island},b2World.s_timestep2=new b2TimeStep,b2World.s_backupA=new b2Sweep,b2World.s_backupB=new b2Sweep,b2World.s_timestep=new b2TimeStep,b2World.s_queue=new Array,b2World.e_newFixture=1,b2World.e_locked=2,b2World.s_xf=new b2Transform,b2World.s_jointColor=new b2Color(.5,.8,.8),b2World.m_warmStarting=null,b2World.m_continuousPhysics=null,b2World.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);var d=this.m_island;for(d.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~b2Contact.e_islandFlag;for(var f=this.m_jointList;f;f=f.m_next)f.m_islandFlag=!1;for(var g=(this.m_bodyCount,this.s_stack),h=this.m_bodyList;h;h=h.m_next)if(!(h.m_flags&b2Body.e_islandFlag)&&0!=h.IsAwake()&&0!=h.IsActive()&&h.GetType()!=b2Body.b2_staticBody){d.Clear();var i=0;for(g[i++]=h,h.m_flags|=b2Body.e_islandFlag;i>0;)if(b=g[--i],d.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=b2Body.b2_staticBody){for(var j,k=b.m_contactList;k;k=k.next)k.contact.m_flags&b2Contact.e_islandFlag||1!=k.contact.IsSensor()&&0!=k.contact.IsEnabled()&&0!=k.contact.IsTouching()&&(d.AddContact(k.contact),k.contact.m_flags|=b2Contact.e_islandFlag,j=k.other,j.m_flags&b2Body.e_islandFlag||(g[i++]=j,j.m_flags|=b2Body.e_islandFlag));for(var l=b.m_jointList;l;l=l.next)1!=l.joint.m_islandFlag&&(j=l.other,0!=j.IsActive()&&(d.AddJoint(l.joint),l.joint.m_islandFlag=!0,j.m_flags&b2Body.e_islandFlag||(g[i++]=j,j.m_flags|=b2Body.e_islandFlag)))}d.Solve(a,this.m_gravity,this.m_allowSleep);for(var m=0;m<d.m_bodyCount;++m)b=d.m_bodies[m],b.GetType()==b2Body.b2_staticBody&&(b.m_flags&=~b2Body.e_islandFlag)}for(m=0;m<g.length&&g[m];++m)g[m]=null;for(b=this.m_bodyList;b;b=b.m_next)0!=b.IsAwake()&&0!=b.IsActive()&&b.GetType()!=b2Body.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},b2World.prototype.SolveTOI=function(a){var b,c,d,e,f,g,h,i=this.m_island;i.Initialize(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,b2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var j=b2World.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag,b.m_sweep.t0=0;var k;for(k=this.m_contactList;k;k=k.m_next)k.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(h=this.m_jointList;h;h=h.m_next)h.m_islandFlag=!1;for(;;){var l=null,m=1;for(k=this.m_contactList;k;k=k.m_next)if(1!=k.IsSensor()&&0!=k.IsEnabled()&&0!=k.IsContinuous()){var n=1;if(k.m_flags&b2Contact.e_toiFlag)n=k.m_toi;else{if(c=k.m_fixtureA,d=k.m_fixtureB,e=c.m_body,f=d.m_body,!(e.GetType()==b2Body.b2_dynamicBody&&0!=e.IsAwake()||f.GetType()==b2Body.b2_dynamicBody&&0!=f.IsAwake()))continue;var o=e.m_sweep.t0;e.m_sweep.t0<f.m_sweep.t0?(o=f.m_sweep.t0,e.m_sweep.Advance(o)):f.m_sweep.t0<e.m_sweep.t0&&(o=e.m_sweep.t0,f.m_sweep.Advance(o)),n=k.ComputeTOI(e.m_sweep,f.m_sweep),b2Settings.b2Assert(n>=0&&1>=n),n>0&&1>n&&(n=(1-n)*o+n,n>1&&(n=1)),k.m_toi=n,k.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<n&&m>n&&(l=k,m=n)}if(null==l||1-100*Number.MIN_VALUE<m)break;if(c=l.m_fixtureA,d=l.m_fixtureB,e=c.m_body,f=d.m_body,b2World.s_backupA.Set(e.m_sweep),b2World.s_backupB.Set(f.m_sweep),e.Advance(m),f.Advance(m),l.Update(this.m_contactManager.m_contactListener),l.m_flags&=~b2Contact.e_toiFlag,1!=l.IsSensor()&&0!=l.IsEnabled()){if(0!=l.IsTouching()){var p=e;p.GetType()!=b2Body.b2_dynamicBody&&(p=f),i.Clear();var q=0,r=0;for(j[q+r++]=p,p.m_flags|=b2Body.e_islandFlag;r>0;)if(b=j[q++],--r,i.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==b2Body.b2_dynamicBody){for(g=b.m_contactList;g&&i.m_contactCount!=i.m_contactCapacity;g=g.next)if(!(g.contact.m_flags&b2Contact.e_islandFlag)&&1!=g.contact.IsSensor()&&0!=g.contact.IsEnabled()&&0!=g.contact.IsTouching()){i.AddContact(g.contact),g.contact.m_flags|=b2Contact.e_islandFlag;var s=g.other;s.m_flags&b2Body.e_islandFlag||(s.GetType()!=b2Body.b2_staticBody&&(s.Advance(m),s.SetAwake(!0)),j[q+r]=s,++r,s.m_flags|=b2Body.e_islandFlag)}for(var t=b.m_jointList;t;t=t.next)i.m_jointCount!=i.m_jointCapacity&&1!=t.joint.m_islandFlag&&(s=t.other,0!=s.IsActive()&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,s.m_flags&b2Body.e_islandFlag||(s.GetType()!=b2Body.b2_staticBody&&(s.Advance(m),s.SetAwake(!0)),j[q+r]=s,++r,s.m_flags|=b2Body.e_islandFlag)))}var u=b2World.s_timestep;u.warmStarting=!1,u.dt=(1-m)*a.dt,u.inv_dt=1/u.dt,u.dtRatio=0,u.velocityIterations=a.velocityIterations,u.positionIterations=a.positionIterations,i.SolveTOI(u);var v=0;for(v=0;v<i.m_bodyCount;++v)if(b=i.m_bodies[v],b.m_flags&=~b2Body.e_islandFlag,0!=b.IsAwake()&&b.GetType()==b2Body.b2_dynamicBody)for(b.SynchronizeFixtures(),g=b.m_contactList;g;g=g.next)g.contact.m_flags&=~b2Contact.e_toiFlag;for(v=0;v<i.m_contactCount;++v)k=i.m_contacts[v],k.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(v=0;v<i.m_jointCount;++v)h=i.m_joints[v],h.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else e.m_sweep.Set(b2World.s_backupA),f.m_sweep.Set(b2World.s_backupB),e.SynchronizeTransform(),f.SynchronizeTransform()}},b2World.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf,e=c.m_xf,f=d.position,g=e.position,h=a.GetAnchorA(),i=a.GetAnchorB(),j=b2World.s_jointColor;switch(a.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(h,i,j);break;case b2Joint.e_pulleyJoint:var k=a,l=k.GetGroundAnchorA(),m=k.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,h,j),this.m_debugDraw.DrawSegment(m,i,j),this.m_debugDraw.DrawSegment(l,m,j);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(h,i,j);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,j),this.m_debugDraw.DrawSegment(h,i,j),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(g,i,j)}},b2World.prototype.DrawShape=function(a,b,c){switch(a.m_type){case b2Shape.e_circleShape:var d=a,e=b2Math.MulX(b,d.m_p),f=d.m_radius,g=b.R.col1;this.m_debugDraw.DrawSolidCircle(e,f,g,c);break;case b2Shape.e_polygonShape:var h=0,i=a,j=i.GetVertexCount(),k=i.GetVertices(),l=new Array(j);for(h=0;j>h;++h)l[h]=b2Math.MulX(b,k[h]);this.m_debugDraw.DrawSolidPolygon(l,j,c);break;case b2Shape.e_edgeShape:var m=a;this.m_debugDraw.DrawSegment(b2Math.MulX(b,m.GetVertex1()),b2Math.MulX(b,m.GetVertex2()),c)}},b2World.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},b2World.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},b2World.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},b2World.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},b2World.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)},b2World.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},b2World.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;var b=new b2Body(a,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},b2World.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(var d=a.m_controllerList;d;){var e=d;d=d.nextController,e.controller.RemoveBody(a)}for(var f=a.m_contactList;f;){var g=f;f=f.next,this.m_contactManager.Destroy(g.contact)}a.m_contactList=null;for(var h=a.m_fixtureList;h;){var i=h;h=h.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i),i.DestroyProxy(this.m_contactManager.m_broadPhase),i.Destroy()}a.m_fixtureList=null,a.m_fixtureCount=0,a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_bodyList&&(this.m_bodyList=a.m_next),--this.m_bodyCount}},b2World.prototype.CreateJoint=function(a){var b=b2Joint.Create(a,null);b.m_prev=null,b.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,b.m_edgeA.next=b.m_bodyA.m_jointList,b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,b.m_edgeB.next=b.m_bodyB.m_jointList,b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(0==a.collideConnected)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next;return b},b2World.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB==d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,b2Joint.Destroy(a,null),--this.m_jointCount,0==b)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next},b2World.prototype.AddController=function(a){return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList=a,a.m_world=this,this.m_controllerCount++,a},b2World.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),this.m_controllerList==a&&(this.m_controllerList=a.m_next),this.m_controllerCount--},b2World.prototype.CreateController=function(a){if(a.m_world!=this)throw new Error("Controller can only be a member of one world");return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=a),this.m_controllerList=a,++this.m_controllerCount,a.m_world=this,a},b2World.prototype.DestroyController=function(a){a.Clear(),a.m_next&&(a.m_next.m_prev=a.m_prev),a.m_prev&&(a.m_prev.m_next=a.m_next),a==this.m_controllerList&&(this.m_controllerList=a.m_next),--this.m_controllerCount},b2World.prototype.SetWarmStarting=function(a){b2World.m_warmStarting=a},b2World.prototype.SetContinuousPhysics=function(a){b2World.m_continuousPhysics=a},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},b2World.prototype.GetJointCount=function(){return this.m_jointCount},b2World.prototype.GetContactCount=function(){return this.m_contactCount},b2World.prototype.SetGravity=function(a){this.m_gravity=a},b2World.prototype.GetGravity=function(){return this.m_gravity},b2World.prototype.GetGroundBody=function(){return this.m_groundBody},b2World.prototype.Step=function(a,b,c){this.m_flags&b2World.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b2World.e_newFixture),this.m_flags|=b2World.e_locked;var d=b2World.s_timestep2;d.dt=a,d.velocityIterations=b,d.positionIterations=c,a>0?d.inv_dt=1/a:d.inv_dt=0,d.dtRatio=this.m_inv_dt0*a,d.warmStarting=b2World.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),b2World.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~b2World.e_locked},b2World.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0},b2World.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.Clear();var a,b,c,d,e,f,g=this.m_debugDraw.GetFlags(),h=(new b2Vec2,new b2Vec2,new b2Vec2,new b2AABB,new b2AABB,[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2]),i=new b2Color(0,0,0);if(g&b2DebugDraw.e_shapeBit)for(a=this.m_bodyList;a;a=a.m_next)for(f=a.m_xf,b=a.GetFixtureList();b;b=b.m_next)c=b.GetShape(),0==a.IsActive()?(i.Set(.5,.5,.3),this.DrawShape(c,f,i)):a.GetType()==b2Body.b2_staticBody?(i.Set(.5,.9,.5),this.DrawShape(c,f,i)):a.GetType()==b2Body.b2_kinematicBody?(i.Set(.5,.5,.9),this.DrawShape(c,f,i)):0==a.IsAwake()?(i.Set(.6,.6,.6),this.DrawShape(c,f,i)):(i.Set(.9,.7,.7),this.DrawShape(c,f,i));if(g&b2DebugDraw.e_jointBit)for(d=this.m_jointList;d;d=d.m_next)this.DrawJoint(d);if(g&b2DebugDraw.e_controllerBit)for(var j=this.m_controllerList;j;j=j.m_next)j.Draw(this.m_debugDraw);if(g&b2DebugDraw.e_pairBit){i.Set(.3,.9,.9);for(var k=this.m_contactManager.m_contactList;k;k=k.GetNext()){var l=k.GetFixtureA(),m=k.GetFixtureB(),n=l.GetAABB().GetCenter(),o=m.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(n,o,i)}}if(g&b2DebugDraw.e_aabbBit)for(e=this.m_contactManager.m_broadPhase,h=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2],a=this.m_bodyList;a;a=a.GetNext())if(0!=a.IsActive())for(b=a.GetFixtureList();b;b=b.GetNext()){var p=e.GetFatAABB(b.m_proxy);h[0].Set(p.lowerBound.x,p.lowerBound.y),h[1].Set(p.upperBound.x,p.lowerBound.y),h[2].Set(p.upperBound.x,p.upperBound.y),h[3].Set(p.lowerBound.x,p.upperBound.y),this.m_debugDraw.DrawPolygon(h,4,i)}if(g&b2DebugDraw.e_centerOfMassBit)for(a=this.m_bodyList;a;a=a.m_next)f=b2World.s_xf,f.R=a.m_xf.R,f.position=a.GetWorldCenter(),this.m_debugDraw.DrawTransform(f)}},b2World.prototype.QueryAABB=function(a,b){function c(b){return a(d.GetUserData(b))}var d=this.m_contactManager.m_broadPhase;d.Query(c,b)},b2World.prototype.QueryShape=function(a,b,c){function d(d){var f=e.GetUserData(d);return b2Shape.TestOverlap(b,c,f.GetShape(),f.GetBody().GetTransform())?a(f):!0}null==c&&(c=new b2Transform,c.SetIdentity());var e=this.m_contactManager.m_broadPhase,f=new b2AABB;b.ComputeAABB(f,c),e.Query(d,f)},b2World.prototype.QueryPoint=function(a,b){function c(c){var e=d.GetUserData(c);return e.TestPoint(b)?a(e):!0}var d=this.m_contactManager.m_broadPhase,e=new b2AABB;e.lowerBound.Set(b.x-b2Settings.b2_linearSlop,b.y-b2Settings.b2_linearSlop),e.upperBound.Set(b.x+b2Settings.b2_linearSlop,b.y+b2Settings.b2_linearSlop),d.Query(c,e)},b2World.prototype.RayCast=function(a,b,c){function d(d,g){var h=e.GetUserData(g),i=h,j=i.RayCast(f,d);if(j){var k=f.fraction,l=new b2Vec2((1-k)*b.x+k*c.x,(1-k)*b.y+k*c.y);return a(i,l,f.normal,k)}return d.maxFraction}var e=this.m_contactManager.m_broadPhase,f=new b2RayCastOutput,g=new b2RayCastInput(b,c);e.RayCast(d,g)},b2World.prototype.RayCastOne=function(a,b){function c(a,b,c,e){return d=a,e}var d;return this.RayCast(c,a,b),d},b2World.prototype.RayCastAll=function(a,b){function c(a,b,c,e){return d[d.length]=a,1}var d=new Array;return this.RayCast(c,a,b),d},b2World.prototype.GetBodyList=function(){return this.m_bodyList},b2World.prototype.GetJointList=function(){return this.m_jointList},b2World.prototype.GetContactList=function(){return this.m_contactList},b2World.prototype.IsLocked=function(){return(this.m_flags&b2World.e_locked)>0},b2World.prototype.s_stack=new Array,b2World.prototype.m_flags=0,b2World.prototype.m_contactManager=new b2ContactManager,b2World.prototype.m_contactSolver=new b2ContactSolver,b2World.prototype.m_island=new b2Island,b2World.prototype.m_bodyList=null,b2World.prototype.m_jointList=null,b2World.prototype.m_contactList=null,b2World.prototype.m_bodyCount=0,b2World.prototype.m_contactCount=0,b2World.prototype.m_jointCount=0,b2World.prototype.m_controllerList=null,b2World.prototype.m_controllerCount=0,b2World.prototype.m_gravity=null,b2World.prototype.m_allowSleep=null,b2World.prototype.m_groundBody=null,b2World.prototype.m_destructionListener=null,b2World.prototype.m_debugDraw=null,b2World.prototype.m_inv_dt0=null,"undefined"!=typeof exports&&(exports.b2BoundValues=b2BoundValues,exports.b2Math=b2Math,exports.b2DistanceOutput=b2DistanceOutput,exports.b2Mat33=b2Mat33,exports.b2ContactPoint=b2ContactPoint,exports.b2PairManager=b2PairManager,exports.b2PositionSolverManifold=b2PositionSolverManifold,exports.b2OBB=b2OBB,exports.b2CircleContact=b2CircleContact,exports.b2PulleyJoint=b2PulleyJoint,exports.b2Pair=b2Pair,exports.b2TimeStep=b2TimeStep,exports.b2FixtureDef=b2FixtureDef,exports.b2World=b2World,exports.b2PrismaticJoint=b2PrismaticJoint,exports.b2Controller=b2Controller,exports.b2ContactID=b2ContactID,exports.b2RevoluteJoint=b2RevoluteJoint,exports.b2JointDef=b2JointDef,exports.b2Transform=b2Transform,exports.b2GravityController=b2GravityController,exports.b2EdgeAndCircleContact=b2EdgeAndCircleContact,exports.b2EdgeShape=b2EdgeShape,exports.b2BuoyancyController=b2BuoyancyController,exports.b2LineJointDef=b2LineJointDef,exports.b2Contact=b2Contact,exports.b2DistanceJoint=b2DistanceJoint,exports.b2Body=b2Body,exports.b2DestructionListener=b2DestructionListener,exports.b2PulleyJointDef=b2PulleyJointDef,exports.b2ContactEdge=b2ContactEdge,exports.b2ContactConstraint=b2ContactConstraint,exports.b2ContactImpulse=b2ContactImpulse,exports.b2DistanceJointDef=b2DistanceJointDef,exports.b2ContactResult=b2ContactResult,exports.b2EdgeChainDef=b2EdgeChainDef,exports.b2Vec2=b2Vec2,exports.b2Vec3=b2Vec3,exports.b2DistanceProxy=b2DistanceProxy,exports.b2FrictionJointDef=b2FrictionJointDef,exports.b2PolygonContact=b2PolygonContact,exports.b2TensorDampingController=b2TensorDampingController,exports.b2ContactFactory=b2ContactFactory,exports.b2WeldJointDef=b2WeldJointDef,exports.b2ConstantAccelController=b2ConstantAccelController,exports.b2GearJointDef=b2GearJointDef,exports.ClipVertex=ClipVertex,exports.b2SeparationFunction=b2SeparationFunction,exports.b2ManifoldPoint=b2ManifoldPoint,exports.b2Color=b2Color,exports.b2PolygonShape=b2PolygonShape,exports.b2DynamicTreePair=b2DynamicTreePair,exports.b2ContactConstraintPoint=b2ContactConstraintPoint,exports.b2FrictionJoint=b2FrictionJoint,exports.b2ContactFilter=b2ContactFilter,exports.b2ControllerEdge=b2ControllerEdge,exports.b2Distance=b2Distance,exports.b2Fixture=b2Fixture,exports.b2DynamicTreeNode=b2DynamicTreeNode,exports.b2MouseJoint=b2MouseJoint,exports.b2DistanceInput=b2DistanceInput,exports.b2BodyDef=b2BodyDef,exports.b2DynamicTreeBroadPhase=b2DynamicTreeBroadPhase,exports.b2Settings=b2Settings,exports.b2Proxy=b2Proxy,exports.b2Point=b2Point,exports.b2BroadPhase=b2BroadPhase,exports.b2Manifold=b2Manifold,exports.b2WorldManifold=b2WorldManifold,exports.b2PrismaticJointDef=b2PrismaticJointDef,exports.b2RayCastOutput=b2RayCastOutput,exports.b2ConstantForceController=b2ConstantForceController,exports.b2TimeOfImpact=b2TimeOfImpact,exports.b2CircleShape=b2CircleShape,exports.b2MassData=b2MassData,exports.b2Joint=b2Joint,exports.b2GearJoint=b2GearJoint,exports.b2DynamicTree=b2DynamicTree,exports.b2JointEdge=b2JointEdge,exports.b2LineJoint=b2LineJoint,exports.b2NullContact=b2NullContact,exports.b2ContactListener=b2ContactListener,exports.b2RayCastInput=b2RayCastInput,exports.b2TOIInput=b2TOIInput,exports.Features=Features,exports.b2FilterData=b2FilterData,exports.b2Island=b2Island,exports.b2ContactManager=b2ContactManager,exports.b2ContactSolver=b2ContactSolver,exports.b2Simplex=b2Simplex,exports.b2AABB=b2AABB,exports.b2Jacobian=b2Jacobian,exports.b2Bound=b2Bound,exports.b2RevoluteJointDef=b2RevoluteJointDef,exports.b2PolyAndEdgeContact=b2PolyAndEdgeContact,exports.b2SimplexVertex=b2SimplexVertex,exports.b2WeldJoint=b2WeldJoint,exports.b2Collision=b2Collision,exports.b2Mat22=b2Mat22,exports.b2SimplexCache=b2SimplexCache,exports.b2PolyAndCircleContact=b2PolyAndCircleContact,exports.b2MouseJointDef=b2MouseJointDef,exports.b2Shape=b2Shape,exports.b2Segment=b2Segment,exports.b2ContactRegister=b2ContactRegister,exports.b2DebugDraw=b2DebugDraw,exports.b2Sweep=b2Sweep),function(a,b,c,d,e,f,g){function h(a){var b,d,e=this,f=a.length,g=0,h=e.i=e.j=e.m=0;for(e.S=[],e.c=[],f||(a=[f++]);c>g;)e.S[g]=g++;for(g=0;c>g;g++)b=e.S[g],h=k(h+b+a[g%f]),d=e.S[h],e.S[g]=d,e.S[h]=b;e.g=function(a){var b=e.S,d=k(e.i+1),f=b[d],g=k(e.j+f),h=b[g];b[d]=h,b[g]=f;for(var i=b[k(f+h)];--a;)d=k(d+1),f=b[d],g=k(g+f),h=b[g],b[d]=h,b[g]=f,i=i*c+b[k(f+h)];return e.i=d,e.j=g,i},e.g(c)}function i(a,b,c,d){if(c=[],b&&"object"==typeof a)for(d in a)if(d.indexOf("S")<5)try{c.push(i(a[d],b-1))}catch(e){}return c.length?c:""+a}function j(a,b,c,d){for(a+="",c=0,d=0;d<a.length;d++)b[k(d)]=k((c^=19*b[k(d)])+a.charCodeAt(d));a="";for(d in b)a+=String.fromCharCode(b[d]);return a}function k(a){return a&c-1}b.seedrandom=function(k,l){var m,n=[];return k=j(i(l?[k,a]:arguments.length?k:[(new Date).getTime(),a,window],3),n),m=new h(n),j(m.S,a),b.random=function(){for(var a=m.g(d),b=g,h=0;e>a;)a=(a+h)*c,b*=c,h=m.g(1);for(;a>=f;)a/=2,b/=2,h>>>=1;return(a+h)/b},k},g=b.pow(c,d),e=b.pow(2,e),f=2*e,j(b.random(),a)}([],Math,256,6,52),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.SockJS=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(c){var d=a("./transport-list");b.exports=a("./main")(d),"_sockjs_onload"in c&&setTimeout(c._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(a,b){function c(){e.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var d=a("inherits"),e=a("./event");d(c,e),b.exports=c},{"./event":4,inherits:54}],3:[function(a,b){function c(){e.call(this)}var d=a("inherits"),e=a("./eventtarget");d(c,e),c.prototype.removeAllListeners=function(a){a?delete this._listeners[a]:this._listeners={}},c.prototype.once=function(a,b){function c(){d.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}var d=this,e=!1;this.on(a,c)},c.prototype.emit=function(a){var b=this._listeners[a];if(b)for(var c=Array.prototype.slice.call(arguments,1),d=0;d<b.length;d++)b[d].apply(this,c)},c.prototype.on=c.prototype.addListener=e.prototype.addEventListener,c.prototype.removeListener=e.prototype.removeEventListener,b.exports.EventEmitter=c},{"./eventtarget":5,inherits:54}],4:[function(a,b){function c(a){this.type=a}c.prototype.initEvent=function(a,b,c){return this.type=a,this.bubbles=b,this.cancelable=c,this.timeStamp=+new Date,this},c.prototype.stopPropagation=function(){},c.prototype.preventDefault=function(){},c.CAPTURING_PHASE=1,c.AT_TARGET=2,c.BUBBLING_PHASE=3,b.exports=c},{}],5:[function(a,b){function c(){this._listeners={}}c.prototype.addEventListener=function(a,b){a in this._listeners||(this._listeners[a]=[]);var c=this._listeners[a];-1===c.indexOf(b)&&(c=c.concat([b])),this._listeners[a]=c},c.prototype.removeEventListener=function(a,b){var c=this._listeners[a];if(c){var d=c.indexOf(b);return-1!==d?void(c.length>1?this._listeners[a]=c.slice(0,d).concat(c.slice(d+1)):delete this._listeners[a]):void 0}},c.prototype.dispatchEvent=function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);if(this["on"+b]&&this["on"+b].apply(this,c),b in this._listeners)for(var d=this._listeners[b],e=0;e<d.length;e++)d[e].apply(this,c)},b.exports=c},{}],6:[function(a,b){function c(a){e.call(this),this.initEvent("message",!1,!1),this.data=a}var d=a("inherits"),e=a("./event");d(c,e),b.exports=c},{"./event":4,inherits:54}],7:[function(a,b){function c(a){this._transport=a,a.on("message",this._transportMessage.bind(this)),a.on("close",this._transportClose.bind(this))}var d=a("json3"),e=a("./utils/iframe");c.prototype._transportClose=function(a,b){e.postMessage("c",d.stringify([a,b]))},c.prototype._transportMessage=function(a){e.postMessage("t",a)},c.prototype._send=function(a){this._transport.send(a)},c.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},b.exports=c},{"./utils/iframe":47,json3:55}],8:[function(a,b){var c=a("./utils/url"),d=a("./utils/event"),e=a("json3"),f=a("./facade"),g=a("./info-iframe-receiver"),h=a("./utils/iframe"),i=a("./location");b.exports=function(a,b){var j={};b.forEach(function(a){a.facadeTransport&&(j[a.facadeTransport.transportName]=a.facadeTransport)}),j[g.transportName]=g;var k;a.bootstrap_iframe=function(){var b;h.currentWindowId=i.hash.slice(1);var g=function(d){if(d.source===parent&&("undefined"==typeof k&&(k=d.origin),d.origin===k)){var g;try{g=e.parse(d.data)}catch(l){return}if(g.windowId===h.currentWindowId)switch(g.type){case"s":var m;try{m=e.parse(g.data)}catch(l){break}var n=m[0],o=m[1],p=m[2],q=m[3];if(n!==a.version)throw new Error('Incompatibile SockJS! Main site uses: "'+n+'", the iframe: "'+a.version+'".');if(!c.isOriginEqual(p,i.href)||!c.isOriginEqual(q,i.href))throw new Error("Can't connect to different domain from within an iframe. ("+i.href+", "+p+", "+q+")");b=new f(new j[o](p,q));break;case"m":b._send(g.data);break;case"c":b&&b._close(),b=null}}};d.attachEvent("message",g),h.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(a,b){function c(a,b){d.call(this);var c=this,e=+new Date;this.xo=new b("GET",a),this.xo.once("finish",function(a,b){var d,h;if(200===a){if(h=+new Date-e,b)try{d=f.parse(b)}catch(i){}g.isObject(d)||(d={})}c.emit("finish",d,h),c.removeAllListeners()})}var d=a("events").EventEmitter,e=a("inherits"),f=a("json3"),g=a("./utils/object");e(c,d),c.prototype.close=function(){this.removeAllListeners(),this.xo.close()},b.exports=c},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(a,b){function c(a,b){var c=this;e.call(this),this.ir=new h(b,g),this.ir.once("finish",function(a,b){c.ir=null,c.emit("message",f.stringify([a,b]))})}var d=a("inherits"),e=a("events").EventEmitter,f=a("json3"),g=a("./transport/sender/xhr-local"),h=a("./info-ajax");d(c,e),c.transportName="iframe-info-receiver",c.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},b.exports=c},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(a,b){(function(c){function d(a){var b=this;e.call(this);var d=function(){var c=b.ifr=new i(j.transportName,a,a);c.once("message",function(a){if(a){var c;try{c=g.parse(a)}catch(d){return b.emit("finish"),void b.close()}var e=c[0],f=c[1];b.emit("finish",e,f)}b.close()}),c.once("close",function(){b.emit("finish"),b.close()})};c.document.body?d():h.attachEvent("load",d)}var e=a("events").EventEmitter,f=a("inherits"),g=a("json3"),h=a("./utils/event"),i=a("./transport/iframe"),j=a("./info-iframe-receiver");f(d,e),d.enabled=function(){return i.enabled()},d.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(a,b){function c(a,b){var c=this;d.call(this),setTimeout(function(){c.doXhr(a,b)},0)}var d=a("events").EventEmitter,e=a("inherits"),f=a("./utils/url"),g=a("./transport/sender/xdr"),h=a("./transport/sender/xhr-cors"),i=a("./transport/sender/xhr-local"),j=a("./transport/sender/xhr-fake"),k=a("./info-iframe"),l=a("./info-ajax");e(c,d),c._getReceiver=function(a,b){return b.sameOrigin?new l(a,i):h.enabled?new l(a,h):g.enabled&&b.sameScheme?new l(a,g):k.enabled()?new k(a):new l(a,j)},c.prototype.doXhr=function(a,b){var d=this,e=f.addPath(a,"/info");this.xo=c._getReceiver(e,b),this.timeoutRef=setTimeout(function(){d._cleanup(!1),d.emit("finish")},c.timeout),this.xo.once("finish",function(a,b){d._cleanup(!0),d.emit("finish",a,b)})},c.prototype._cleanup=function(a){clearTimeout(this.timeoutRef),this.timeoutRef=null,!a&&this.xo&&this.xo.close(),this.xo=null},c.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},c.timeout=8e3,b.exports=c},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(a,b){(function(a){b.exports=a.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(a,b){(function(c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");s.call(this),this.readyState=d.CONNECTING,this.extensions="",this.protocol="",c=c||{},c.protocols_whitelist&&q.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=c.transports,this._server=c.server||j.numberString(1e3);var e=new g(a);if(!e.host||!e.protocol)throw new SyntaxError("The URL '"+a+"' is invalid");if(e.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==e.protocol&&"https:"!==e.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+e.protocol+"' is not allowed.");var f="https:"===e.protocol;if("https"===t.protocol&&!f)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");b?Array.isArray(b)||(b=[b]):b=[];var h=b.sort();h.forEach(function(a,b){if(!a)throw new SyntaxError("The protocols entry '"+a+"' is invalid.");if(b<h.length-1&&a===h[b+1])throw new SyntaxError("The protocols entry '"+a+"' is duplicated.")});var i=l.getOrigin(t.href);this._origin=i?i.toLowerCase():null,e.set("pathname",e.pathname.replace(/\/+$/,"")),this.url=e.href,this._urlInfo={nullOrigin:!p.hasDomain(),sameOrigin:l.isOriginEqual(this.url,t.href),sameScheme:l.isSchemeEqual(this.url,t.href)},this._ir=new w(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function e(a){return 1e3===a||a>=3e3&&4999>=a}a("./shims");var f,g=a("url-parse"),h=a("inherits"),i=a("json3"),j=a("./utils/random"),k=a("./utils/escape"),l=a("./utils/url"),m=a("./utils/event"),n=a("./utils/transport"),o=a("./utils/object"),p=a("./utils/browser"),q=a("./utils/log"),r=a("./event/event"),s=a("./event/eventtarget"),t=a("./location"),u=a("./event/close"),v=a("./event/trans-message"),w=a("./info-receiver");h(d,s),d.prototype.close=function(a,b){if(a&&!e(a))throw new Error("InvalidAccessError: Invalid code");if(b&&b.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==d.CLOSING&&this.readyState!==d.CLOSED){var c=!0;this._close(a||1e3,b||"Normal closure",c);
}},d.prototype.send=function(a){if("string"!=typeof a&&(a=""+a),this.readyState===d.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===d.OPEN&&this._transport.send(k.quote(a))},d.version=a("./version"),d.CONNECTING=0,d.OPEN=1,d.CLOSING=2,d.CLOSED=3,d.prototype._receiveInfo=function(a,b){if(this._ir=null,!a)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(b),this._transUrl=a.base_url?a.base_url:this.url,a=o.extend(a,this._urlInfo);var c=f.filterToEnabled(this._transportsWhitelist,a);this._transports=c.main,this._connect()},d.prototype._connect=function(){for(var a=this._transports.shift();a;a=this._transports.shift()){if(a.needBody&&(!c.document.body||"undefined"!=typeof c.document.readyState&&"complete"!==c.document.readyState&&"interactive"!==c.document.readyState))return this._transports.unshift(a),void m.attachEvent("load",this._connect.bind(this));var b=this._rto*a.roundTrips||5e3;this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),b);var d=l.addPath(this._transUrl,"/"+this._server+"/"+j.string(8)),e=new a(d,this._transUrl);return e.on("message",this._transportMessage.bind(this)),e.once("close",this._transportClose.bind(this)),e.transportName=a.transportName,void(this._transport=e)}this._close(2e3,"All transports failed",!1)},d.prototype._transportTimeout=function(){this.readyState===d.CONNECTING&&this._transportClose(2007,"Transport timed out")},d.prototype._transportMessage=function(a){var b,c=this,d=a.slice(0,1),e=a.slice(1);switch(d){case"o":return void this._open();case"h":return void this.dispatchEvent(new r("heartbeat"))}if(e)try{b=i.parse(e)}catch(f){}if("undefined"!=typeof b)switch(d){case"a":Array.isArray(b)&&b.forEach(function(a){c.dispatchEvent(new v(a))});break;case"m":this.dispatchEvent(new v(b));break;case"c":Array.isArray(b)&&2===b.length&&this._close(b[0],b[1],!0)}},d.prototype._transportClose=function(a,b){return this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),e(a)||2e3===a||this.readyState!==d.CONNECTING?void this._close(a,b):void this._connect()},d.prototype._open=function(){this.readyState===d.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=d.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new r("open"))):this._close(1006,"Server lost session")},d.prototype._close=function(a,b,c){var e=!1;if(this._ir&&(e=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===d.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=d.CLOSING,setTimeout(function(){this.readyState=d.CLOSED,e&&this.dispatchEvent(new r("error"));var f=new u("close");f.wasClean=c||!1,f.code=a||1e3,f.reason=b,this.dispatchEvent(f),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},d.prototype.countRTO=function(a){return a>100?4*a:300+a},b.exports=function(b){return f=n(b),a("./iframe-bootstrap")(d,b),d}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){function a(a){var b=+a;return b!==b?b=0:0!==b&&b!==1/0&&b!==-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b))),b}function b(a){return a>>>0}function c(){}var d,e=Array.prototype,f=Object.prototype,g=Function.prototype,h=String.prototype,i=e.slice,j=f.toString,k=function(a){return"[object Function]"===f.toString.call(a)},l=function(a){return"[object Array]"===j.call(a)},m=function(a){return"[object String]"===j.call(a)},n=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(a){return!1}}();d=n?function(a,b,c,d){!d&&b in a||Object.defineProperty(a,b,{configurable:!0,enumerable:!1,writable:!0,value:c})}:function(a,b,c,d){!d&&b in a||(a[b]=c)};var o=function(a,b,c){for(var e in b)f.hasOwnProperty.call(b,e)&&d(a,e,b[e],c)},p=function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return Object(a)};o(g,{bind:function(a){var b=this;if(!k(b))throw new TypeError("Function.prototype.bind called on incompatible "+b);for(var d=i.call(arguments,1),e=function(){if(this instanceof j){var c=b.apply(this,d.concat(i.call(arguments)));return Object(c)===c?c:this}return b.apply(a,d.concat(i.call(arguments)))},f=Math.max(0,b.length-d.length),g=[],h=0;f>h;h++)g.push("$"+h);var j=Function("binder","return function ("+g.join(",")+"){ return binder.apply(this, arguments); }")(e);return b.prototype&&(c.prototype=b.prototype,j.prototype=new c,c.prototype=null),j}}),o(Array,{isArray:l});var q=Object("a"),r="a"!==q[0]||!(0 in q),s=function(a){var b=!0,c=!0;return a&&(a.call("foo",function(a,c,d){"object"!=typeof d&&(b=!1)}),a.call([1],function(){c="string"==typeof this},"x")),!!a&&b&&c};o(e,{forEach:function(a){var b=p(this),c=r&&m(this)?this.split(""):b,d=arguments[1],e=-1,f=c.length>>>0;if(!k(a))throw new TypeError;for(;++e<f;)e in c&&a.call(d,c[e],e,b)}},!s(e.forEach));var t=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);o(e,{indexOf:function(b){var c=r&&m(this)?this.split(""):p(this),d=c.length>>>0;if(!d)return-1;var e=0;for(arguments.length>1&&(e=a(arguments[1])),e=e>=0?e:Math.max(0,d+e);d>e;e++)if(e in c&&c[e]===b)return e;return-1}},t);var u=h.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var a=void 0===/()??/.exec("")[1];h.split=function(c,d){var f=this;if(void 0===c&&0===d)return[];if("[object RegExp]"!==j.call(c))return u.call(this,c,d);var g,h,i,k,l=[],m=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.extended?"x":"")+(c.sticky?"y":""),n=0;for(c=new RegExp(c.source,m+"g"),f+="",a||(g=new RegExp("^"+c.source+"$(?!\\s)",m)),d=void 0===d?-1>>>0:b(d);(h=c.exec(f))&&(i=h.index+h[0].length,!(i>n&&(l.push(f.slice(n,h.index)),!a&&h.length>1&&h[0].replace(g,function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(h[a]=void 0)}),h.length>1&&h.index<f.length&&e.push.apply(l,h.slice(1)),k=h[0].length,n=i,l.length>=d)));)c.lastIndex===h.index&&c.lastIndex++;return n===f.length?(k||!c.test(""))&&l.push(""):l.push(f.slice(n)),l.length>d?l.slice(0,d):l}}():"0".split(void 0,0).length&&(h.split=function(a,b){return void 0===a&&0===b?[]:u.call(this,a,b)});var v="	\n\f\r  \u2028\u2029\ufeff",w="",x="["+v+"]",y=new RegExp("^"+x+x+"*"),z=new RegExp(x+x+"*$"),A=h.trim&&(v.trim()||!w.trim());o(h,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(y,"").replace(z,"")}},A);var B=h.substr,C="".substr&&"b"!=="0b".substr(-1);o(h,{substr:function(a,b){return B.call(this,0>a&&(a=this.length+a)<0?0:a,b)}},C)},{}],16:[function(a,b){b.exports=[a("./transport/websocket"),a("./transport/xhr-streaming"),a("./transport/xdr-streaming"),a("./transport/eventsource"),a("./transport/lib/iframe-wrap")(a("./transport/eventsource")),a("./transport/htmlfile"),a("./transport/lib/iframe-wrap")(a("./transport/htmlfile")),a("./transport/xhr-polling"),a("./transport/xdr-polling"),a("./transport/lib/iframe-wrap")(a("./transport/xhr-polling")),a("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(a,b){(function(c){function d(a,b,c,d){var f=this;e.call(this),setTimeout(function(){f._start(a,b,c,d)},0)}var e=a("events").EventEmitter,f=a("inherits"),g=a("../../utils/event"),h=a("../../utils/url"),i=c.XMLHttpRequest;f(d,e),d.prototype._start=function(a,b,c,e){var f=this;try{this.xhr=new i}catch(j){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();b=h.addQuery(b,"t="+ +new Date),this.unloadRef=g.unloadAdd(function(){f._cleanup(!0)});try{this.xhr.open(a,b,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){f.emit("finish",0,""),f._cleanup(!1)})}catch(k){return this.emit("finish",0,""),void this._cleanup(!1)}if(e&&e.noCredentials||!d.supportsCORS||(this.xhr.withCredentials="true"),e&&e.headers)for(var l in e.headers)this.xhr.setRequestHeader(l,e.headers[l]);this.xhr.onreadystatechange=function(){if(f.xhr){var a,b,c=f.xhr;switch(c.readyState){case 3:try{b=c.status,a=c.responseText}catch(d){}1223===b&&(b=204),200===b&&a&&a.length>0&&f.emit("chunk",b,a);break;case 4:b=c.status,1223===b&&(b=204),(12005===b||12029===b)&&(b=0),f.emit("finish",b,c.responseText),f._cleanup(!1)}}};try{f.xhr.send(c)}catch(k){f.emit("finish",0,""),f._cleanup(!1)}},d.prototype._cleanup=function(a){if(this.xhr){if(this.removeAllListeners(),g.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),a)try{this.xhr.abort()}catch(b){}this.unloadRef=this.xhr=null}},d.prototype.close=function(){this._cleanup(!0)},d.enabled=!!i;var j=["Active"].concat("Object").join("X");!d.enabled&&j in c&&(i=function(){try{return new c[j]("Microsoft.XMLHTTP")}catch(a){return null}},d.enabled=!!new i);var k=!1;try{k="withCredentials"in new i}catch(l){}d.supportsCORS=k,b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(a,b){(function(a){b.exports=a.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(a,b){(function(a){b.exports=a.WebSocket||a.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(a,b){function c(a){if(!c.enabled())throw new Error("Transport created when disabled");e.call(this,a,"/eventsource",f,g)}var d=a("inherits"),e=a("./lib/ajax-based"),f=a("./receiver/eventsource"),g=a("./sender/xhr-cors"),h=a("eventsource");d(c,e),c.enabled=function(){return!!h},c.transportName="eventsource",c.roundTrips=2,b.exports=c},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(a,b){function c(a){if(!e.enabled)throw new Error("Transport created when disabled");g.call(this,a,"/htmlfile",e,f)}var d=a("inherits"),e=a("./receiver/htmlfile"),f=a("./sender/xhr-local"),g=a("./lib/ajax-based");d(c,g),c.enabled=function(a){return e.enabled&&a.sameOrigin},c.transportName="htmlfile",c.roundTrips=2,b.exports=c},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(a,b){function c(a,b,d){if(!c.enabled())throw new Error("Transport created when disabled");f.call(this);var e=this;this.origin=h.getOrigin(d),this.baseUrl=d,this.transUrl=b,this.transport=a,this.windowId=k.string(8);var g=h.addPath(d,"/iframe.html")+"#"+this.windowId;this.iframeObj=i.createIframe(g,function(a){e.emit("close",1006,"Unable to load an iframe ("+a+")"),e.close()}),this.onmessageCallback=this._message.bind(this),j.attachEvent("message",this.onmessageCallback)}var d=a("inherits"),e=a("json3"),f=a("events").EventEmitter,g=a("../version"),h=a("../utils/url"),i=a("../utils/iframe"),j=a("../utils/event"),k=a("../utils/random");d(c,f),c.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){j.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(a){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},c.prototype._message=function(a){if(h.isOriginEqual(a.origin,this.origin)){var b;try{b=e.parse(a.data)}catch(c){return}if(b.windowId===this.windowId)switch(b.type){case"s":this.iframeObj.loaded(),this.postMessage("s",e.stringify([g,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",b.data);break;case"c":var d;try{d=e.parse(b.data)}catch(c){return}this.emit("close",d[0],d[1]),this.close()}}},c.prototype.postMessage=function(a,b){this.iframeObj.post(e.stringify({windowId:this.windowId,type:a,data:b||""}),this.origin)},c.prototype.send=function(a){this.postMessage("m",a)},c.enabled=function(){return i.iframeEnabled},c.transportName="iframe",c.roundTrips=2,b.exports=c},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(a,b){(function(c){function d(a){if(!d.enabled())throw new Error("Transport created when disabled");f.call(this,a,"/jsonp",h,g)}var e=a("inherits"),f=a("./lib/sender-receiver"),g=a("./receiver/jsonp"),h=a("./sender/jsonp");e(d,f),d.enabled=function(){return!!c.document},d.transportName="jsonp-polling",d.roundTrips=1,d.needBody=!0,b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(a,b){function c(a){return function(b,c,d){var e={};"string"==typeof c&&(e.headers={"Content-type":"text/plain"});var g=f.addPath(b,"/xhr_send"),h=new a("POST",g,c,e);return h.once("finish",function(a){return h=null,200!==a&&204!==a?d(new Error("http status "+a)):void d()}),function(){h.close(),h=null;var a=new Error("Aborted");a.code=1e3,d(a)}}}function d(a,b,d,e){g.call(this,a,b,c(e),d,e)}var e=a("inherits"),f=a("../../utils/url"),g=a("./sender-receiver");e(d,g),b.exports=d},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(a,b){function c(a,b){e.call(this),this.sendBuffer=[],this.sender=b,this.url=a}var d=a("inherits"),e=a("events").EventEmitter;d(c,e),c.prototype.send=function(a){this.sendBuffer.push(a),this.sendStop||this.sendSchedule()},c.prototype.sendScheduleWait=function(){var a,b=this;this.sendStop=function(){b.sendStop=null,clearTimeout(a)},a=setTimeout(function(){b.sendStop=null,b.sendSchedule()},25)},c.prototype.sendSchedule=function(){var a=this;if(this.sendBuffer.length>0){var b="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,b,function(b){a.sendStop=null,b?(a.emit("close",b.code||1006,"Sending error: "+b),a._cleanup()):a.sendScheduleWait()}),this.sendBuffer=[]}},c.prototype._cleanup=function(){this.removeAllListeners()},c.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},b.exports=c},{debug:void 0,events:3,inherits:54}],26:[function(a,b){(function(c){var d=a("inherits"),e=a("../iframe"),f=a("../../utils/object");b.exports=function(a){function b(b,c){e.call(this,a.transportName,b,c)}return d(b,e),b.enabled=function(b,d){if(!c.document)return!1;var g=f.extend({},d);return g.sameOrigin=!0,a.enabled(g)&&e.enabled()},b.transportName="iframe-"+a.transportName,b.needBody=!0,b.roundTrips=e.roundTrips+a.roundTrips-1,b.facadeTransport=a,b}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(a,b){function c(a,b,c){e.call(this),this.Receiver=a,this.receiveUrl=b,this.AjaxObject=c,this._scheduleReceiver()}var d=a("inherits"),e=a("events").EventEmitter;d(c,e),c.prototype._scheduleReceiver=function(){var a=this,b=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);b.on("message",function(b){a.emit("message",b)}),b.once("close",function(c,d){a.poll=b=null,a.pollIsClosing||("network"===d?a._scheduleReceiver():(a.emit("close",c||1006,d),a.removeAllListeners()))})},c.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},b.exports=c},{debug:void 0,events:3,inherits:54}],28:[function(a,b){function c(a,b,c,d,h){var i=e.addPath(a,b),j=this;f.call(this,a,c),this.poll=new g(d,i,h),this.poll.on("message",function(a){j.emit("message",a)}),this.poll.once("close",function(a,b){j.poll=null,j.emit("close",a,b),j.close()})}var d=a("inherits"),e=a("../../utils/url"),f=a("./buffered-sender"),g=a("./polling");d(c,f),c.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},b.exports=c},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(a,b){function c(a){e.call(this);var b=this,c=this.es=new f(a);c.onmessage=function(a){b.emit("message",decodeURI(a.data))},c.onerror=function(a){var d=2!==c.readyState?"network":"permanent";b._cleanup(),b._close(d)}}var d=a("inherits"),e=a("events").EventEmitter,f=a("eventsource");d(c,e),c.prototype.abort=function(){this._cleanup(),this._close("user")},c.prototype._cleanup=function(){var a=this.es;a&&(a.onmessage=a.onerror=null,a.close(),this.es=null)},c.prototype._close=function(a){var b=this;setTimeout(function(){b.emit("close",null,a),b.removeAllListeners()},200)},b.exports=c},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(a,b){(function(c){function d(a){h.call(this);var b=this;f.polluteGlobalNamespace(),this.id="a"+i.string(6),a=g.addQuery(a,"c="+decodeURIComponent(f.WPrefix+"."+this.id));var e=d.htmlfileEnabled?f.createHtmlfile:f.createIframe;c[f.WPrefix][this.id]={start:function(){b.iframeObj.loaded()},message:function(a){b.emit("message",a)},stop:function(){b._cleanup(),b._close("network")}},this.iframeObj=e(a,function(){b._cleanup(),b._close("permanent")})}var e=a("inherits"),f=a("../../utils/iframe"),g=a("../../utils/url"),h=a("events").EventEmitter,i=a("../../utils/random");e(d,h),d.prototype.abort=function(){this._cleanup(),this._close("user")},d.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete c[f.WPrefix][this.id]},d.prototype._close=function(a){this.emit("close",null,a),this.removeAllListeners()},d.htmlfileEnabled=!1;var j=["Active"].concat("Object").join("X");if(j in c)try{d.htmlfileEnabled=!!new c[j]("htmlfile")}catch(k){}d.enabled=d.htmlfileEnabled||f.iframeEnabled,b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(a,b){(function(c){function d(a){var b=this;j.call(this),e.polluteGlobalNamespace(),this.id="a"+f.string(6);var g=h.addQuery(a,"c="+encodeURIComponent(e.WPrefix+"."+this.id));c[e.WPrefix][this.id]=this._callback.bind(this),this._createScript(g),this.timeoutId=setTimeout(function(){b._abort(new Error("JSONP script loaded abnormally (timeout)"))},d.timeout)}var e=a("../../utils/iframe"),f=a("../../utils/random"),g=a("../../utils/browser"),h=a("../../utils/url"),i=a("inherits"),j=a("events").EventEmitter;i(d,j),d.prototype.abort=function(){if(c[e.WPrefix][this.id]){var a=new Error("JSONP user aborted read");a.code=1e3,this._abort(a)}},d.timeout=35e3,d.scriptErrorTimeout=1e3,d.prototype._callback=function(a){this._cleanup(),this.aborting||(a&&this.emit("message",a),this.emit("close",null,"network"),this.removeAllListeners())},d.prototype._abort=function(a){this._cleanup(),this.aborting=!0,this.emit("close",a.code,a.message),this.removeAllListeners()},d.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var a=this.script;a.parentNode.removeChild(a),a.onreadystatechange=a.onerror=a.onload=a.onclick=null,this.script=null}delete c[e.WPrefix][this.id]},d.prototype._scriptError=function(){var a=this;this.errorTimer||(this.errorTimer=setTimeout(function(){a.loadedOkay||a._abort(new Error("JSONP script loaded abnormally (onerror)"))},d.scriptErrorTimeout))},d.prototype._createScript=function(a){var b,d=this,e=this.script=c.document.createElement("script");if(e.id="a"+f.string(8),e.src=a,e.type="text/javascript",e.charset="UTF-8",e.onerror=this._scriptError.bind(this),e.onload=function(){d._abort(new Error("JSONP script loaded abnormally (onload)"))},e.onreadystatechange=function(){if(/loaded|closed/.test(e.readyState)){if(e&&e.htmlFor&&e.onclick){d.loadedOkay=!0;try{e.onclick()}catch(a){}}e&&d._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof e.async&&c.document.attachEvent)if(g.isOpera())b=this.script2=c.document.createElement("script"),b.text="try{var a = document.getElementById('"+e.id+"'); if(a)a.onerror();}catch(x){};",e.async=b.async=!1;else{try{e.htmlFor=e.id,e.event="onclick"}catch(h){}e.async=!0}"undefined"!=typeof e.async&&(e.async=!0);var i=c.document.getElementsByTagName("head")[0];i.insertBefore(e,i.firstChild),b&&i.insertBefore(b,i.firstChild)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(a,b){function c(a,b){e.call(this);var c=this;this.bufferPosition=0,this.xo=new b("POST",a,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(a,b){c._chunkHandler(a,b),c.xo=null;var d=200===a?"network":"permanent";c.emit("close",null,d),c._cleanup()})}var d=a("inherits"),e=a("events").EventEmitter;d(c,e),c.prototype._chunkHandler=function(a,b){if(200===a&&b)for(var c=-1;;this.bufferPosition+=c+1){var d=b.slice(this.bufferPosition);if(c=d.indexOf("\n"),-1===c)break;var e=d.slice(0,c);e&&this.emit("message",e)}},c.prototype._cleanup=function(){this.removeAllListeners()},c.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},b.exports=c},{debug:void 0,events:3,inherits:54}],33:[function(a,b){(function(c){function d(a){try{return c.document.createElement('<iframe name="'+a+'">')}catch(b){var d=c.document.createElement("iframe");return d.name=a,d}}function e(){f=c.document.createElement("form"),f.style.display="none",f.style.position="absolute",f.method="POST",f.enctype="application/x-www-form-urlencoded",f.acceptCharset="UTF-8",g=c.document.createElement("textarea"),g.name="d",f.appendChild(g),c.document.body.appendChild(f)}var f,g,h=a("../../utils/random"),i=a("../../utils/url");b.exports=function(a,b,c){f||e();var j="a"+h.string(8);f.target=j,f.action=i.addQuery(i.addPath(a,"/jsonp_send"),"i="+j);var k=d(j);k.id=j,k.style.display="none",f.appendChild(k);try{g.value=b}catch(l){}f.submit();var m=function(a){k.onerror&&(k.onreadystatechange=k.onerror=k.onload=null,setTimeout(function(){k.parentNode.removeChild(k),k=null},500),g.value="",c(a))};return k.onerror=function(){m()},k.onload=function(){m()},k.onreadystatechange=function(a){"complete"===k.readyState&&m()},function(){m(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(a,b){(function(c){function d(a,b,c){var d=this;e.call(this),setTimeout(function(){d._start(a,b,c)},0)}var e=a("events").EventEmitter,f=a("inherits"),g=a("../../utils/event"),h=a("../../utils/browser"),i=a("../../utils/url");f(d,e),d.prototype._start=function(a,b,d){var e=this,f=new c.XDomainRequest;b=i.addQuery(b,"t="+ +new Date),f.onerror=function(){e._error()},f.ontimeout=function(){e._error()},f.onprogress=function(){e.emit("chunk",200,f.responseText)},f.onload=function(){e.emit("finish",200,f.responseText),e._cleanup(!1)},this.xdr=f,this.unloadRef=g.unloadAdd(function(){e._cleanup(!0)});try{this.xdr.open(a,b),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(d)}catch(h){this._error()}},d.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},d.prototype._cleanup=function(a){if(this.xdr){if(this.removeAllListeners(),g.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,a)try{this.xdr.abort()}catch(b){}this.unloadRef=this.xdr=null}},d.prototype.close=function(){this._cleanup(!0)},d.enabled=!(!c.XDomainRequest||!h.hasDomain()),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(a,b){function c(a,b,c,d){e.call(this,a,b,c,d)}var d=a("inherits"),e=a("../driver/xhr");d(c,e),c.enabled=e.enabled&&e.supportsCORS,b.exports=c},{"../driver/xhr":17,inherits:54}],36:[function(a,b){function c(){var a=this;d.call(this),this.to=setTimeout(function(){a.emit("finish",200,"{}")},c.timeout)}var d=a("events").EventEmitter,e=a("inherits");e(c,d),c.prototype.close=function(){clearTimeout(this.to)},c.timeout=2e3,b.exports=c},{events:3,inherits:54}],37:[function(a,b){function c(a,b,c){e.call(this,a,b,c,{noCredentials:!0})}var d=a("inherits"),e=a("../driver/xhr");d(c,e),c.enabled=e.enabled,b.exports=c},{"../driver/xhr":17,inherits:54}],38:[function(a,b){function c(a){if(!c.enabled())throw new Error("Transport created when disabled");g.call(this);var b=this,f=e.addPath(a,"/websocket");f="https"===f.slice(0,5)?"wss"+f.slice(5):"ws"+f.slice(4),this.url=f,this.ws=new h(this.url),this.ws.onmessage=function(a){b.emit("message",a.data)},this.unloadRef=d.unloadAdd(function(){b.ws.close()}),this.ws.onclose=function(a){b.emit("close",a.code,a.reason),b._cleanup()},this.ws.onerror=function(a){b.emit("close",1006,"WebSocket connection broken"),b._cleanup()}}var d=a("../utils/event"),e=a("../utils/url"),f=a("inherits"),g=a("events").EventEmitter,h=a("./driver/websocket");f(c,g),c.prototype.send=function(a){var b="["+a+"]";this.ws.send(b)},c.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},c.prototype._cleanup=function(){var a=this.ws;a&&(a.onmessage=a.onclose=a.onerror=null),d.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},c.enabled=function(){return!!h},c.transportName="websocket",c.roundTrips=2,b.exports=c},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(a,b){function c(a){if(!h.enabled)throw new Error("Transport created when disabled");e.call(this,a,"/xhr",g,h)}var d=a("inherits"),e=a("./lib/ajax-based"),f=a("./xdr-streaming"),g=a("./receiver/xhr"),h=a("./sender/xdr");d(c,e),c.enabled=f.enabled,c.transportName="xdr-polling",c.roundTrips=2,b.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(a,b){function c(a){if(!g.enabled)throw new Error("Transport created when disabled");e.call(this,a,"/xhr_streaming",f,g)}var d=a("inherits"),e=a("./lib/ajax-based"),f=a("./receiver/xhr"),g=a("./sender/xdr");d(c,e),c.enabled=function(a){return a.cookie_needed||a.nullOrigin?!1:g.enabled&&a.sameScheme},c.transportName="xdr-streaming",c.roundTrips=2,b.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(a,b){function c(a){if(!h.enabled&&!g.enabled)throw new Error("Transport created when disabled");e.call(this,a,"/xhr",f,g)}var d=a("inherits"),e=a("./lib/ajax-based"),f=a("./receiver/xhr"),g=a("./sender/xhr-cors"),h=a("./sender/xhr-local");d(c,e),c.enabled=function(a){return a.nullOrigin?!1:h.enabled&&a.sameOrigin?!0:g.enabled},c.transportName="xhr-polling",c.roundTrips=2,b.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(a,b){(function(c){function d(a){if(!i.enabled&&!h.enabled)throw new Error("Transport created when disabled");f.call(this,a,"/xhr_streaming",g,h)}var e=a("inherits"),f=a("./lib/ajax-based"),g=a("./receiver/xhr"),h=a("./sender/xhr-cors"),i=a("./sender/xhr-local"),j=a("../utils/browser");e(d,f),d.enabled=function(a){return a.nullOrigin?!1:j.isOpera()?!1:h.enabled},d.transportName="xhr-streaming",d.roundTrips=2,d.needBody=!!c.document,b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(a,b){(function(a){b.exports.randomBytes=a.crypto&&a.crypto.getRandomValues?function(b){var c=new Uint8Array(b);return a.crypto.getRandomValues(c),c}:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=Math.floor(256*Math.random());return b}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(a,b){(function(a){b.exports={isOpera:function(){return a.navigator&&/opera/i.test(a.navigator.userAgent)},isKonqueror:function(){return a.navigator&&/konqueror/i.test(a.navigator.userAgent)},hasDomain:function(){if(!a.document)return!0;try{return!!a.document.domain}catch(b){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(a,b){var c,d=a("json3"),e=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,f=function(a){var b,c={},d=[];for(b=0;65536>b;b++)d.push(String.fromCharCode(b));return a.lastIndex=0,d.join("").replace(a,function(a){return c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,c};b.exports={quote:function(a){var b=d.stringify(a);return e.lastIndex=0,e.test(b)?(c||(c=f(e)),b.replace(e,function(a){return c[a]})):b}}},{json3:55}],46:[function(a,b){(function(c){var d=a("./random"),e={},f=!1;b.exports={attachEvent:function(a,b){"undefined"!=typeof c.addEventListener?c.addEventListener(a,b,!1):c.document&&c.attachEvent&&(c.document.attachEvent("on"+a,b),c.attachEvent("on"+a,b))},detachEvent:function(a,b){"undefined"!=typeof c.addEventListener?c.removeEventListener(a,b,!1):c.document&&c.detachEvent&&(c.document.detachEvent("on"+a,b),c.detachEvent("on"+a,b))},unloadAdd:function(a){var b=d.string(8);return e[b]=a,f&&setTimeout(this.triggerUnloadCallbacks,0),b},unloadDel:function(a){a in e&&delete e[a]},triggerUnloadCallbacks:function(){for(var a in e)e[a](),delete e[a]}};var g=function(){f||(f=!0,b.exports.triggerUnloadCallbacks())};b.exports.attachEvent("unload",g)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(a,b){(function(c){var d=a("./event"),e=a("json3"),f=a("./browser");b.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){b.exports.WPrefix in c||(c[b.exports.WPrefix]={})},postMessage:function(a,d){
c.parent!==c&&c.parent.postMessage(e.stringify({windowId:b.exports.currentWindowId,type:a,data:d||""}),"*")},createIframe:function(a,b){var e,f,g=c.document.createElement("iframe"),h=function(){clearTimeout(e);try{g.onload=null}catch(a){}g.onerror=null},i=function(){g&&(h(),setTimeout(function(){g&&g.parentNode.removeChild(g),g=null},0),d.unloadDel(f))},j=function(a){g&&(i(),b(a))},k=function(a,b){try{g&&g.contentWindow&&setTimeout(function(){g.contentWindow.postMessage(a,b)},0)}catch(c){}};return g.src=a,g.style.display="none",g.style.position="absolute",g.onerror=function(){j("onerror")},g.onload=function(){clearTimeout(e),e=setTimeout(function(){j("onload timeout")},2e3)},c.document.body.appendChild(g),e=setTimeout(function(){j("timeout")},15e3),f=d.unloadAdd(i),{post:k,cleanup:i,loaded:h}},createHtmlfile:function(a,e){var f,g,h,i=["Active"].concat("Object").join("X"),j=new c[i]("htmlfile"),k=function(){clearTimeout(f),h.onerror=null},l=function(){j&&(k(),d.unloadDel(g),h.parentNode.removeChild(h),h=j=null,CollectGarbage())},m=function(a){j&&(l(),e(a))},n=function(a,b){try{h&&h.contentWindow&&setTimeout(function(){h.contentWindow.postMessage(a,b)},0)}catch(c){}};j.open(),j.write('<html><script>document.domain="'+c.document.domain+'";</script></html>'),j.close(),j.parentWindow[b.exports.WPrefix]=c[b.exports.WPrefix];var o=j.createElement("div");return j.body.appendChild(o),h=j.createElement("iframe"),o.appendChild(h),h.src=a,h.onerror=function(){m("onerror")},f=setTimeout(function(){m("timeout")},15e3),g=d.unloadAdd(l),{post:n,cleanup:l,loaded:k}}},b.exports.iframeEnabled=!1,c.document&&(b.exports.iframeEnabled=("function"==typeof c.postMessage||"object"==typeof c.postMessage)&&!f.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(a,b){(function(a){var c={};["log","debug","warn"].forEach(function(b){var d=a.console&&a.console[b]&&a.console[b].apply;c[b]=d?function(){return a.console[b].apply(a.console,arguments)}:"log"===b?function(){}:c.log}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(a,b){b.exports={isObject:function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},extend:function(a){if(!this.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a}}},{}],50:[function(a,b){var c=a("crypto"),d="abcdefghijklmnopqrstuvwxyz012345";b.exports={string:function(a){for(var b=d.length,e=c.randomBytes(a),f=[],g=0;a>g;g++)f.push(d.substr(e[g]%b,1));return f.join("")},number:function(a){return Math.floor(Math.random()*a)},numberString:function(a){var b=(""+(a-1)).length,c=new Array(b+1).join("0");return(c+this.number(a)).slice(-b)}}},{crypto:43}],51:[function(a,b){b.exports=function(a){return{filterToEnabled:function(b,c){var d={main:[],facade:[]};return b?"string"==typeof b&&(b=[b]):b=[],a.forEach(function(a){a&&("websocket"!==a.transportName||c.websocket!==!1)&&(b.length&&-1===b.indexOf(a.transportName)||a.enabled(c)&&(d.main.push(a),a.facadeTransport&&d.facade.push(a.facadeTransport)))}),d}}}},{debug:void 0}],52:[function(a,b){var c=a("url-parse");b.exports={getOrigin:function(a){if(!a)return null;var b=new c(a);if("file:"===b.protocol)return null;var d=b.port;return d||(d="https:"===b.protocol?"443":"80"),b.protocol+"//"+b.hostname+":"+d},isOriginEqual:function(a,b){var c=this.getOrigin(a)===this.getOrigin(b);return c},isSchemeEqual:function(a,b){return a.split(":")[0]===b.split(":")[0]},addPath:function(a,b){var c=a.split("?");return c[0]+b+(c[1]?"?"+c[1]:"")},addQuery:function(a,b){return a+(-1===a.indexOf("?")?"?"+b:"&"+b)}}},{debug:void 0,"url-parse":56}],53:[function(a,b){b.exports="1.0.0"},{}],54:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],55:[function(b,c,d){(function(b){(function(){function e(a,b){function c(a){if(c[a]!==q)return c[a];var e;if("bug-string-char-index"==a)e="a"!="a"[0];else if("json"==a)e=c("json-stringify")&&c("json-parse");else{var g,h='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=b.stringify,k="function"==typeof i&&t;if(k){(g=function(){return 1}).toJSON=g;try{k="0"===i(0)&&"0"===i(new d)&&'""'==i(new f)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(g)&&"[1]"==i([g])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[g,!0,!1,null,"\x00\b\n\f\r	"]})==h&&"1"===i(null,g)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new j(-1))}catch(l){k=!1}}e=k}if("json-parse"==a){var m=b.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){g=m(h);var n=5==g.a.length&&1===g.a[0];if(n){try{n=!m('"	"')}catch(l){}if(n)try{n=1!==m("01")}catch(l){}if(n)try{n=1!==m("1.")}catch(l){}}}}catch(l){n=!1}e=n}}return c[a]=!!e}a||(a=i.Object()),b||(b=i.Object());var d=a.Number||i.Number,f=a.String||i.String,h=a.Object||i.Object,j=a.Date||i.Date,k=a.SyntaxError||i.SyntaxError,l=a.TypeError||i.TypeError,m=a.Math||i.Math,n=a.JSON||i.JSON;"object"==typeof n&&n&&(b.stringify=n.stringify,b.parse=n.parse);var o,p,q,r=h.prototype,s=r.toString,t=new j(-0xc782b5b800cec);try{t=-109252==t.getUTCFullYear()&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(u){}if(!c("json")){var v="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",z="[object Array]",A="[object Boolean]",B=c("bug-string-char-index");if(!t)var C=m.floor,D=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(a,b){return D[b]+365*(a-1970)+C((a-1969+(b=+(b>1)))/4)-C((a-1901+b)/100)+C((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var c,d,e,f=0;(c=function(){this.valueOf=0}).prototype.valueOf=0,d=new c;for(e in d)o.call(d,e)&&f++;return c=d=null,f?p=2==f?function(a,b){var c,d={},e=s.call(a)==v;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==v;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(d=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var c,e,f=s.call(a)==v,h=!f&&"function"!=typeof a.constructor&&g[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(c in a)f&&"prototype"==c||!h.call(a,c)||b(c);for(e=d.length;c=d[--e];h.call(a,c)&&b(c));}),p(a,b)},!c("json-stringify")){var F={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},G="000000",H=function(a,b){return(G+(b||0)).slice(-a)},I="\\u00",J=function(a){for(var b='"',c=0,d=a.length,e=!B||d>10,f=e&&(B?a.split(""):a);d>c;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=F[g];break;default:if(32>g){b+=I+H(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},K=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,v,B,D,F,G,I,L;try{h=b[a]}catch(M){}if("object"==typeof h&&h)if(i=s.call(h),i!=w||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=x&&i!=y&&i!=z||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&1/0>h){if(E){for(m=C(h/864e5),j=C(m/365.2425)+1970-1;E(j+1,0)<=m;j++);for(k=C((m-E(j,0))/30.42);E(j,k+1)<=m;k++);m=1+m-E(j,k),n=(h%864e5+864e5)%864e5,r=C(n/36e5)%24,t=C(n/6e4)%60,u=C(n/1e3)%60,v=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),v=h.getUTCMilliseconds();h=(0>=j||j>=1e4?(0>j?"-":"+")+H(6,0>j?-j:j):H(4,j))+"-"+H(2,k+1)+"-"+H(2,m)+"T"+H(2,r)+":"+H(2,t)+":"+H(2,u)+"."+H(3,v)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if(i=s.call(h),i==A)return""+h;if(i==x)return h>-1/0&&1/0>h?""+h:"null";if(i==y)return J(""+h);if("object"==typeof h){for(G=g.length;G--;)if(g[G]===h)throw l();if(g.push(h),B=[],I=f,f+=e,i==z){for(F=0,G=h.length;G>F;F++)D=K(F,h,c,d,e,f,g),B.push(D===q?"null":D);L=B.length?e?"[\n"+f+B.join(",\n"+f)+"\n"+I+"]":"["+B.join(",")+"]":"[]"}else p(d||h,function(a){var b=K(a,h,c,d,e,f,g);b!==q&&B.push(J(a)+":"+(e?" ":"")+b)}),L=B.length?e?"{\n"+f+B.join(",\n"+f)+"\n"+I+"}":"{"+B.join(",")+"}":"{}";return g.pop(),L}};b.stringify=function(a,b,c){var d,e,f,h;if(g[typeof b]&&b)if((h=s.call(b))==v)e=b;else if(h==z){f={};for(var i,j=0,k=b.length;k>j;i=b[j++],h=s.call(i),(h==y||h==x)&&(f[i]=1));}if(c)if((h=s.call(c))==x){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else h==y&&(d=c.length<=10?c:c.slice(0,10));return K("",(i={},i[""]=a,i),e,f,d,"",[])}}if(!c("json-parse")){var L,M,N=f.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw L=M=null,k()},Q=function(){for(var a,b,c,d,e,f=M,g=f.length;g>L;)switch(e=f.charCodeAt(L)){case 9:case 10:case 13:case 32:L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=B?f.charAt(L):f[L],L++,a;case 34:for(a="@",L++;g>L;)if(e=f.charCodeAt(L),32>e)P();else if(92==e)switch(e=f.charCodeAt(++L)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=O[e],L++;break;case 117:for(b=++L,c=L+4;c>L;L++)e=f.charCodeAt(L),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||P();a+=N("0x"+f.slice(b,L));break;default:P()}else{if(34==e)break;for(e=f.charCodeAt(L),b=L;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++L);a+=f.slice(b,L)}if(34==f.charCodeAt(L))return L++,a;P();default:if(b=L,45==e&&(d=!0,e=f.charCodeAt(++L)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(L+1),e>=48&&57>=e)&&P(),d=!1;g>L&&(e=f.charCodeAt(L),e>=48&&57>=e);L++);if(46==f.charCodeAt(L)){for(c=++L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}if(e=f.charCodeAt(L),101==e||69==e){for(e=f.charCodeAt(++L),(43==e||45==e)&&L++,c=L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}return+f.slice(b,L)}if(d&&P(),"true"==f.slice(L,L+4))return L+=4,!0;if("false"==f.slice(L,L+5))return L+=5,!1;if("null"==f.slice(L,L+4))return L+=4,null;P()}return"$"},R=function(a){var b,c;if("$"==a&&P(),"string"==typeof a){if("@"==(B?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=Q(),"]"!=a;c||(c=!0))c&&(","==a?(a=Q(),"]"==a&&P()):P()),","==a&&P(),b.push(R(a));return b}if("{"==a){for(b={};a=Q(),"}"!=a;c||(c=!0))c&&(","==a?(a=Q(),"}"==a&&P()):P()),(","==a||"string"!=typeof a||"@"!=(B?a.charAt(0):a[0])||":"!=Q())&&P(),b[a.slice(1)]=R(Q());return b}P()}return a},S=function(a,b,c){var d=T(a,b,c);d===q?delete a[b]:a[b]=d},T=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==z)for(d=e.length;d--;)S(e,d,c);else p(e,function(a){S(e,a,c)});return c.call(a,b,e)};b.parse=function(a,b){var c,d;return L=0,M=""+a,c=R(Q()),"$"!=Q()&&P(),L=M=null,b&&s.call(b)==v?T((d={},d[""]=c,d),"",b):c}}}return b.runInContext=e,b}var f="function"==typeof a&&a.amd,g={"function":!0,object:!0},h=g[typeof d]&&d&&!d.nodeType&&d,i=g[typeof window]&&window||this,j=h&&g[typeof c]&&c&&!c.nodeType&&"object"==typeof b&&b;if(!j||j.global!==j&&j.window!==j&&j.self!==j||(i=j),h&&!f)e(i,h);else{var k=i.JSON,l=i.JSON3,m=!1,n=e(i,i.JSON3={noConflict:function(){return m||(m=!0,i.JSON=k,i.JSON3=l,k=l=null),n}});i.JSON={parse:n.parse,stringify:n.stringify}}f&&a(function(){return n})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(a,b){function c(a,b,i){if(!(this instanceof c))return new c(a,b,i);var j,k,l,m,n=g.test(a),o=typeof b,p=this,q=0;for("object"!==o&&"string"!==o&&(i=b,b=null),i&&"function"!=typeof i&&(i=f.parse),b=e(b);q<h.length;q++)k=h[q],j=k[0],m=k[1],j!==j?p[m]=a:"string"==typeof j?~(l=a.indexOf(j))&&("number"==typeof k[2]?(p[m]=a.slice(0,l),a=a.slice(l+k[2])):(p[m]=a.slice(l),a=a.slice(0,l))):(l=j.exec(a))&&(p[m]=l[1],a=a.slice(0,a.length-l[0].length)),p[m]=p[m]||(k[3]||"port"===m&&n?b[m]||"":""),k[4]&&(p[m]=p[m].toLowerCase());i&&(p.query=i(p.query)),d(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(k=p.auth.split(":"),p.username=k[0]||"",p.password=k[1]||""),p.href=p.toString()}var d=a("requires-port"),e=a("./lolcation"),f=a("querystringify"),g=/^\/(?!\/)/,h=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];c.prototype.set=function(a,b,c){var e=this;return"query"===a?("string"==typeof b&&(b=(c||f.parse)(b)),e[a]=b):"port"===a?(e[a]=b,d(b,e.protocol)?b&&(e.host=e.hostname+":"+b):(e.host=e.hostname,e[a]="")):"hostname"===a?(e[a]=b,e.port&&(b+=":"+e.port),e.host=b):"host"===a?(e[a]=b,/\:\d+/.test(b)&&(b=b.split(":"),e.hostname=b[0],e.port=b[1])):e[a]=b,e.href=e.toString(),e},c.prototype.toString=function(a){a&&"function"==typeof a||(a=f.stringify);var b,c=this,d=c.protocol+"//";return c.username&&(d+=c.username,c.password&&(d+=":"+c.password),d+="@"),d+=c.hostname,c.port&&(d+=":"+c.port),d+=c.pathname,c.query&&(b="object"==typeof c.query?a(c.query):c.query,d+=("?"===b.charAt(0)?"":"?")+b),c.hash&&(d+=c.hash),d},c.qs=f,c.location=e,b.exports=c},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(a,b){(function(c){var d,e={hash:1,query:1};b.exports=function(b){b=b||c.location||{},d=d||a("./");var f,g={},h=typeof b;if("blob:"===b.protocol)g=new d(unescape(b.pathname),{});else if("string"===h){g=new d(b,{});for(f in e)delete g[f]}else if("object"===h)for(f in b)f in e||(g[f]=b[f]);return g}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":56}],58:[function(a,b,c){function d(a){for(var b,c=/([^=?&]+)=([^&]*)/g,d={};b=c.exec(a);d[decodeURIComponent(b[1])]=decodeURIComponent(b[2]));return d}function e(a,b){b=b||"";var c=[];"string"!=typeof b&&(b="?");for(var d in a)f.call(a,d)&&c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.length?b+c.join("&"):""}var f=Object.prototype.hasOwnProperty;c.stringify=e,c.parse=d},{}],59:[function(a,b){b.exports=function(a,b){if(b=b.split(":")[0],a=+a,!a)return!1;switch(b){case"http":case"ws":return 80!==a;case"https":case"wss":return 443!==a;case"ftp":return 22!==a;case"gopher":return 70!==a;case"file":return!1}return 0!==a}},{}]},{},[1])(1)}),function(){var a,b,c,d,e={}.hasOwnProperty,f=[].slice;a={LF:"\n",NULL:"\x00"},c=function(){function b(a,b,c){this.command=a,this.headers=null!=b?b:{},this.body=null!=c?c:""}var c;return b.prototype.toString=function(){var c,d,f,g,h;c=[this.command],f=this.headers["content-length"]===!1?!0:!1,f&&delete this.headers["content-length"],h=this.headers;for(d in h)e.call(h,d)&&(g=h[d],c.push(""+d+":"+g));return this.body&&!f&&c.push("content-length:"+b.sizeOfUTF8(this.body)),c.push(a.LF+this.body),c.join(a.LF)},b.sizeOfUTF8=function(a){return a?encodeURI(a).match(/%..|./g).length:0},c=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(g=c.search(RegExp(""+a.LF+a.LF)),h=c.substring(0,g).split(a.LF),f=h.shift(),i={},o=function(a){return a.replace(/^\s+|\s+$/g,"")},s=h.reverse(),p=0,r=s.length;r>p;p++)m=s[p],k=m.indexOf(":"),i[o(m.substring(0,k))]=o(m.substring(k+1));if(d="",n=g+2,i["content-length"])l=parseInt(i["content-length"]),d=(""+c).substring(n,n+l);else for(e=null,j=q=n,t=c.length;(t>=n?t>q:q>t)&&(e=c.charAt(j),e!==a.NULL);j=t>=n?++q:--q)d+=e;return new b(f,i,d)},b.unmarshall=function(b){var d;return function(){var e,f,g,h;for(g=b.split(RegExp(""+a.NULL+a.LF+"*")),h=[],e=0,f=g.length;f>e;e++)d=g[e],(null!=d?d.length:void 0)>0&&h.push(c(d));return h}()},b.marshall=function(c,d,e){var f;return f=new b(c,d,e),f.toString()+a.NULL},b}(),b=function(){function b(a){this.ws=a,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var e;return b.prototype.debug=function(a){var b;return"undefined"!=typeof window&&null!==window&&null!=(b=window.console)?b.log(a):void 0},e=function(){return Date.now?Date.now():(new Date).valueOf},b.prototype._transmit=function(a,b,d){var e;for(e=c.marshall(a,b,d),"function"==typeof this.debug&&this.debug(">>> "+e);;){if(!(e.length>this.maxWebSocketFrameSize))return this.ws.send(e);this.ws.send(e.substring(0,this.maxWebSocketFrameSize)),e=e.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+e.length)}},b.prototype._setupHeartbeat=function(b){var c,f,g,h,i,j;if((i=b.version)===d.VERSIONS.V1_1||i===d.VERSIONS.V1_2)return j=function(){var a,c,d,e;for(d=b["heart-beat"].split(","),e=[],a=0,c=d.length;c>a;a++)h=d[a],e.push(parseInt(h));return e}(),f=j[0],c=j[1],0!==this.heartbeat.outgoing&&0!==c&&(g=Math.max(this.heartbeat.outgoing,c),"function"==typeof this.debug&&this.debug("send PING every "+g+"ms"),this.pinger=d.setInterval(g,function(b){return function(){return b.ws.send(a.LF),"function"==typeof b.debug?b.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==f?(g=Math.max(this.heartbeat.incoming,f),"function"==typeof this.debug&&this.debug("check PONG every "+g+"ms"),this.ponger=d.setInterval(g,function(a){return function(){var b;return b=e()-a.serverActivity,b>2*g?("function"==typeof a.debug&&a.debug("did not receive server activity for the last "+b+"ms"),a.ws.close()):void 0}}(this))):void 0},b.prototype._parseConnect=function(){var a,b,c,d;switch(a=1<=arguments.length?f.call(arguments,0):[],d={},a.length){case 2:d=a[0],b=a[1];break;case 3:a[1]instanceof Function?(d=a[0],b=a[1],c=a[2]):(d.login=a[0],d.passcode=a[1],b=a[2]);break;case 4:d.login=a[0],d.passcode=a[1],b=a[2],c=a[3];break;default:d.login=a[0],d.passcode=a[1],b=a[2],c=a[3],d.host=a[4]}return[d,b,c]},b.prototype.connect=function(){var b,g,h,i;return b=1<=arguments.length?f.call(arguments,0):[],i=this._parseConnect.apply(this,b),h=i[0],this.connectCallback=i[1],g=i[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(b){return function(d){var f,h,i,j,k,l,m,n,o,p,q,r;if(j="undefined"!=typeof ArrayBuffer&&d.data instanceof ArrayBuffer?(f=new Uint8Array(d.data),"function"==typeof b.debug?b.debug("--- got data length: "+f.length):void 0,function(){var a,b,c;for(c=[],a=0,b=f.length;b>a;a++)h=f[a],c.push(String.fromCharCode(h));return c}().join("")):d.data,b.serverActivity=e(),j===a.LF)return void("function"==typeof b.debug&&b.debug("<<< PONG"));for("function"==typeof b.debug&&b.debug("<<< "+j),q=c.unmarshall(j),r=[],o=0,p=q.length;p>o;o++)switch(k=q[o],k.command){case"CONNECTED":"function"==typeof b.debug&&b.debug("connected to server "+k.headers.server),b.connected=!0,b._setupHeartbeat(k.headers),r.push("function"==typeof b.connectCallback?b.connectCallback(k):void 0);break;case"MESSAGE":n=k.headers.subscription,m=b.subscriptions[n]||b.onreceive,m?(i=b,l=k.headers["message-id"],k.ack=function(a){return null==a&&(a={}),i.ack(l,n,a)},k.nack=function(a){return null==a&&(a={}),i.nack(l,n,a)},r.push(m(k))):r.push("function"==typeof b.debug?b.debug("Unhandled received MESSAGE: "+k):void 0);break;case"RECEIPT":r.push("function"==typeof b.onreceipt?b.onreceipt(k):void 0);break;case"ERROR":r.push("function"==typeof g?g(k):void 0);break;default:r.push("function"==typeof b.debug?b.debug("Unhandled frame: "+k):void 0)}return r}}(this),this.ws.onclose=function(a){return function(){var b;return b="Whoops! Lost connection to "+a.ws.url,"function"==typeof a.debug&&a.debug(b),a._cleanUp(),"function"==typeof g?g(b):void 0}}(this),this.ws.onopen=function(a){return function(){return"function"==typeof a.debug&&a.debug("Web Socket Opened..."),h["accept-version"]=d.VERSIONS.supportedVersions(),h["heart-beat"]=[a.heartbeat.outgoing,a.heartbeat.incoming].join(","),a._transmit("CONNECT",h)}}(this)},b.prototype.disconnect=function(a,b){return null==b&&(b={}),this._transmit("DISCONNECT",b),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof a?a():void 0},b.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&d.clearInterval(this.pinger),this.ponger?d.clearInterval(this.ponger):void 0},b.prototype.send=function(a,b,c){return null==b&&(b={}),null==c&&(c=""),b.destination=a,this._transmit("SEND",b,c)},b.prototype.subscribe=function(a,b,c){var d;return null==c&&(c={}),c.id||(c.id="sub-"+this.counter++),c.destination=a,this.subscriptions[c.id]=b,this._transmit("SUBSCRIBE",c),d=this,{id:c.id,unsubscribe:function(){return d.unsubscribe(c.id)}}},b.prototype.unsubscribe=function(a){return delete this.subscriptions[a],this._transmit("UNSUBSCRIBE",{id:a})},b.prototype.begin=function(a){var b,c;return c=a||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:c}),b=this,{id:c,commit:function(){return b.commit(c)},abort:function(){return b.abort(c)}}},b.prototype.commit=function(a){return this._transmit("COMMIT",{transaction:a})},b.prototype.abort=function(a){return this._transmit("ABORT",{transaction:a})},b.prototype.ack=function(a,b,c){return null==c&&(c={}),c["message-id"]=a,c.subscription=b,this._transmit("ACK",c)},b.prototype.nack=function(a,b,c){return null==c&&(c={}),c["message-id"]=a,c.subscription=b,this._transmit("NACK",c)},b}(),d={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(a,c){var e,f;return null==c&&(c=["v10.stomp","v11.stomp"]),e=d.WebSocketClass||WebSocket,f=new e(a,c),new b(f)},over:function(a){return new b(a)},Frame:c},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=d),"undefined"!=typeof window&&null!==window?(d.setInterval=function(a,b){return window.setInterval(b,a)},d.clearInterval=function(a){return window.clearInterval(a)},window.Stomp=d):exports||(self.Stomp=d)}.call(this);